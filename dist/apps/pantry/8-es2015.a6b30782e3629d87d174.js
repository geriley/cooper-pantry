(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{"+fds":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class r{constructor(e){this.data=e}get uri(){return this.data.uri}get revision(){return this.data.revision}get lastEventId(){return this.data.lastEventId}get dateUpdated(){return this.data.dateUpdated}get dateExpires(){return this.data.dateExpires}get index(){return this.data.index}get value(){return this.data.value}update(e,t,n,r){return this.data.lastEventId=e,this.data.revision=t,this.data.value=n,this.data.dateUpdated=r,this}updateDateExpires(e){this.data.dateExpires=e}}t.ListItem=r,t.default=r},"+ozH":function(e,t,n){e.exports={default:n("6XsV"),__esModule:!0}},"+t7B":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n("r2q8"),i=n("F8DB"),s=n("v9mA"),a=n("qlDM"),o=n("sc67"),u=n("lKIr"),c=n("LYxL"),l=n("lgJq"),d=n("sRV3"),h=n("2E5e"),f=n("LBb3"),p=n("tcGR"),m=n("W27V"),y=n("B3fw"),v=n("1eRg"),g=n("wlIO"),b=n("BxSP"),w=n("upa/"),_=n("4RHC"),k=n("4RHC"),x=n("1rCL").version;function S(e){if(e){if("string"==typeof e)return{id:e,mode:"open_or_create"};{u.validateOptionalTtl(e.ttl);let t=e.mode||(e.id?"open_or_create":"create_new");return Object.assign(Object.assign({},e),{mode:t})}}return{mode:"create_new"}}class C extends r.EventEmitter{constructor(e,t={}){if(super(),!e)throw new Error("Sync library needs a valid Twilio token to be passed");t.hasOwnProperty("logLevel")?c.default.setLevel(t.logLevel):c.default.setLevel("silent");const n=t.productId=t.productId||"data_sync";let r=t.twilsockClient=t.twilsockClient||new i.Twilsock(e,n,t);r.on("tokenAboutToExpire",e=>this.emit("tokenAboutToExpire",e)),r.on("tokenExpired",()=>this.emit("tokenExpired")),r.on("connectionError",e=>this.emit("connectionError",e));let a=t.notificationsClient=t.notificationsClient||new s.Notifications(e,t),o=new l.Configuration(t),u=new f.NetworkService(new v.ClientInfo(x),o,r),p=new b.SessionStorage(o);this.localStorageId=null,r.connect(),this.services={config:o,twilsock:r,notifications:a,network:u,storage:p,router:null,subscriptions:null};let m=new d.Subscriptions(this.services),y=new h.Router({config:o,subscriptions:m,notifications:a});this.services.router=y,this.services.subscriptions=m,this.entities=new g.EntitiesCache,a.on("connectionStateChanged",()=>{this.emit("connectionStateChanged",this.services.notifications.connectionState)})}static get version(){return x}get connectionState(){return this.services.notifications.connectionState}async ensureReady(){if(this.services.config.sessionStorageEnabled)try{let e=await this.services.twilsock.storageId();this.services.storage.updateStorageId(e.id)}catch(e){c.default.warn("Failed to initialize storage",e)}}storeRootInSessionCache(e,t,n){if(!this.services.config.sessionStorageEnabled||!t)return;let r=u.deepClone(n);e!==m.SyncList.type&&e!==y.SyncMap.type||(r.last_event_id=null,delete r.items),this.services.storage.store(e,t,r)}readRootFromSessionCache(e,t){return this.services.config.sessionStorageEnabled&&t?this.services.storage.read(e,t):null}async _get(e,t,n=!1){if(!t)throw new o.SyncError("Cannot get entity without id",404);const r=new a.UriBuilder(e).pathSegment(t).queryParam("Include",n?"items":void 0).build();return(await this.services.network.get(r)).body}_createDocument(e,t,n){let r={unique_name:e,data:t||{}};return"number"==typeof n&&(r.ttl=n),this.services.network.post(this.services.config.documentsUri,r).then(e=>(e.body.data=r.data,e.body))}async _getDocument(e){return this.readRootFromSessionCache(p.SyncDocument.type,e)||this._get(this.services.config.documentsUri,e)}_createList(e,t,n,r){const i={unique_name:e,purpose:t,context:n};return"number"==typeof r&&(i.ttl=r),this.services.network.post(this.services.config.listsUri,i).then(e=>e.body)}async _getList(e){return this.readRootFromSessionCache(m.SyncList.type,e)||this._get(this.services.config.listsUri,e)}_createMap(e,t){let n={unique_name:e};return"number"==typeof t&&(n.ttl=t),this.services.network.post(this.services.config.mapsUri,n).then(e=>e.body)}async _getMap(e,t=!1){return this.readRootFromSessionCache(y.SyncMap.type,e)||this._get(this.services.config.mapsUri,e,t)}async _getStream(e){return this.readRootFromSessionCache(w.SyncStream.type,e)||this._get(this.services.config.streamsUri,e,!1)}async _createStream(e,t){let n={unique_name:e};return"number"==typeof t&&(n.ttl=t),(await this.services.network.post(this.services.config.streamsUri,n)).body}_getLiveQuery(e){return this.readRootFromSessionCache(_.LiveQuery.type,e)}getCached(e,t){return e&&this.entities.get(e,t)||null}removeFromCacheAndSession(e,t,n){this.entities.remove(t),this.services.config.sessionStorageEnabled&&this.services.storage.remove(e,t,n)}async document(e){await this.ensureReady();let t,n=S(e);if("create_new"===n.mode)t=await this._createDocument(n.id,n.value,n.ttl);else{let r=this.getCached(n.id,p.SyncDocument.type);if(r)return new p.SyncDocument(r);try{t=await this._getDocument(n.id)}catch(i){if(404!==i.status||"open_existing"===n.mode)throw i;try{t=await this._createDocument(n.id,n.value,n.ttl)}catch(i){if(409===i.status)return this.document(e);throw i}}}this.storeRootInSessionCache(p.SyncDocument.type,n.id,t);let r=new p.SyncDocumentImpl(this.services,t,(e,t,n)=>this.removeFromCacheAndSession(e,t,n));return r=this.entities.store(r),new p.SyncDocument(r)}async map(e){await this.ensureReady();let t,n=S(e);if("create_new"===n.mode)t=await this._createMap(n.id,n.ttl);else{let r=this.getCached(n.id,y.SyncMap.type);if(r)return new y.SyncMap(r);try{t=await this._getMap(n.id,n.includeItems)}catch(i){if(404!==i.status||"open_existing"===n.mode)throw i;try{t=await this._createMap(n.id,n.ttl)}catch(i){if(409===i.status)return this.map(e);throw i}}}this.storeRootInSessionCache(y.SyncMap.type,n.id,t);let r=new y.SyncMapImpl(this.services,t,(e,t,n)=>this.removeFromCacheAndSession(e,t,n));return r=this.entities.store(r),new y.SyncMap(r)}async list(e){await this.ensureReady();let t,n=S(e);if("create_new"===n.mode)t=await this._createList(n.id,n.purpose,n.context,n.ttl);else{let r=this.getCached(n.id,m.SyncList.type);if(r)return new m.SyncList(r);try{t=await this._getList(n.id)}catch(i){if(404!==i.status||"open_existing"===n.mode)throw i;try{t=await this._createList(n.id,n.purpose,n.context,n.ttl)}catch(i){if(409===i.status)return this.list(e);throw i}}}this.storeRootInSessionCache(m.SyncList.type,n.id,t);let r=new m.SyncListImpl(this.services,t,(e,t,n)=>this.removeFromCacheAndSession(e,t,n));return r=this.entities.store(r),new m.SyncList(r)}async stream(e){await this.ensureReady();let t,n=S(e);if("create_new"===n.mode)t=await this._createStream(n.id,n.ttl);else{let r=this.getCached(n.id,w.SyncStream.type);if(r)return new w.SyncStream(r);try{t=await this._getStream(n.id)}catch(i){if(404!==i.status||"open_existing"===n.mode)throw i;try{t=await this._createStream(n.id,n.ttl)}catch(i){if(409===i.status)return this.stream(e);throw i}}}this.storeRootInSessionCache(w.SyncStream.type,n.id,t);let r=new w.SyncStreamImpl(this.services,t,(e,t,n)=>this.removeFromCacheAndSession(e,t,n));return r=this.entities.store(r),new w.SyncStream(r)}async shutdown(){await this.services.subscriptions.shutdown(),await this.services.twilsock.disconnect()}updateToken(e){return e?this.services.twilsock.updateToken(e):Promise.reject(new Error("A valid Twilio token should be provided"))}async liveQuery(e,t){if(await this.ensureReady(),!e||"string"!=typeof e)throw new Error("Index name must contain a non-empty string value");let n=new a.UriBuilder(this.services.config.insightsUri).pathSegment(e).pathSegment("Items").build(),r=await k.queryItems({network:this.services.network,uri:n,queryString:t}),i=this.getCached(r.query_id,_.LiveQuery.type);if(!i){let s=this._getLiveQuery(r.query_id);s||(s={indexName:e,queryExpression:t,sid:r.query_id,queryUri:n}),i=new _.LiveQueryImpl(s,this.services,(e,t,n)=>this.removeFromCacheAndSession(e,t,n),r.items)}return this.storeRootInSessionCache(_.LiveQuery.type,r.query_id,i.liveQueryDescriptor),i=this.entities.store(i),new _.LiveQuery(i)}async instantQuery(e){return await this.ensureReady(),new _.InstantQuery({indexName:e,network:this.services.network,insightsUri:this.services.config.insightsUri,liveQueryCreator:(e,t)=>this.liveQuery(e,t)})}}t.Client=C,t.SyncClient=C,t.default=C},"/hF+":function(e,t,n){"use strict";var r=h(n("tgXR")),i=h(n("CafK")),s=h(n("IhEH")),a=h(n("XUND")),o=h(n("Rhu4")),u=h(n("4Mt5")),c=h(n("7xyS")),l=h(n("k2Qk")),d=h(n("aq5/"));function h(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var f=n("r2q8"),p=n("CPx3"),m=n("FSt9"),y=n("0tlO");t.User=y.User;var v=n("Isrn"),g=n("ZvXT"),b=n("yDbV"),w=n("MAsh"),_=n("F8DB"),k=n("v9mA"),x=n("p87M"),S=n("vOBy"),C=n("l9m5"),M=n("MuMv"),E=n("LVtF"),T=n("ToDU"),I=n("dSFd"),P=n("UuY1"),O=n("vZMe");t.PushNotification=O.PushNotification;var R=n("RtQP"),N=p.Logger.scope("Client"),j=n("G1hA").version,U="A valid Twilio token should be provided",L=function e(){(0,d.default)(this,e)},D=function(e){function t(e,n){(0,d.default)(this,t);var r=(0,c.default)(this,(t.__proto__||(0,o.default)(t)).call(this));r.connectionState="connecting",r.sessionPromise=null,r.channelsPromise=null,r.version=j,r.parsePushNotification=t.parsePushNotification,r.options=n||{},r.options.disableDeepClone||(r.options=R.deepClone(r.options)),r.options.logLevel=r.options.logLevel||"silent",N.setLevel(r.options.logLevel);var i=r.options.productId="ip_messaging";if(r.options.Sync=r.options.Sync||{},void 0===r.options.Sync.enableSessionStorage&&(r.options.Sync.enableSessionStorage=!0),r.options.region&&(r.options.Sync.region=r.options.region),!e)throw new Error(U);return r.services=new L,r.config=new m.Configuration(r.options),r.options.twilsockClient=r.options.twilsockClient||new _.Twilsock(e,i,r.options),r.options.transport=r.options.transport||r.options.twilsockClient,r.options.notificationsClient=r.options.notificationsClient||new k.Notifications(e,r.options),r.options.syncClient=r.options.syncClient||new x.SyncClient(e,r.options),r.services.syncClient=r.options.syncClient,r.services.transport=r.options.transport,r.services.twilsockClient=r.options.twilsockClient,r.services.notificationClient=r.options.notificationsClient,r.services.session=new C.Session(r.services,r.config),r.sessionPromise=r.services.session.initialize(),r.services.network=new g.Network(r.config,r.services),r.services.users=new E.Users({session:r.services.session,network:r.services.network,syncClient:r.services.syncClient}),r.services.users.on("userSubscribed",r.emit.bind(r,"userSubscribed")),r.services.users.on("userUpdated",(function(e){return r.emit("userUpdated",e)})),r.services.users.on("userUnsubscribed",r.emit.bind(r,"userUnsubscribed")),r.services.twilsockClient.on("tokenAboutToExpire",(function(e){return r.emit("tokenAboutToExpire",e)})),r.services.twilsockClient.on("tokenExpired",(function(){return r.emit("tokenExpired")})),r.services.twilsockClient.on("connectionError",(function(e){return r.emit("connectionError",e)})),r.services.consumptionHorizon=new I.ConsumptionHorizon(r.services),r.services.typingIndicator=new T.TypingIndicator(r.config,{transport:r.services.twilsockClient,notificationClient:r.services.notificationClient},r.getChannelBySid.bind(r)),r.services.syncList=new w.SyncList(r.services),r.channels=new M.Channels(r.services),r.channelsPromise=r.sessionPromise.then((function(){return r.channels.on("channelAdded",r.emit.bind(r,"channelAdded")),r.channels.on("channelRemoved",r.emit.bind(r,"channelRemoved")),r.channels.on("channelInvited",r.emit.bind(r,"channelInvited")),r.channels.on("channelJoined",r.emit.bind(r,"channelJoined")),r.channels.on("channelLeft",r.emit.bind(r,"channelLeft")),r.channels.on("channelUpdated",(function(e){return r.emit("channelUpdated",e)})),r.channels.on("memberJoined",r.emit.bind(r,"memberJoined")),r.channels.on("memberLeft",r.emit.bind(r,"memberLeft")),r.channels.on("memberUpdated",(function(e){return r.emit("memberUpdated",e)})),r.channels.on("messageAdded",r.emit.bind(r,"messageAdded")),r.channels.on("messageUpdated",(function(e){return r.emit("messageUpdated",e)})),r.channels.on("messageRemoved",r.emit.bind(r,"messageRemoved")),r.channels.on("typingStarted",r.emit.bind(r,"typingStarted")),r.channels.on("typingEnded",r.emit.bind(r,"typingEnded")),r.channels.fetchChannels()})).then((function(){return r.channels})),r.services.notificationClient.on("connectionStateChanged",(function(e){var t=null;switch(e){case"connected":t="connected";break;case"denied":t="denied";break;case"disconnecting":t="disconnecting";break;case"disconnected":t="disconnected";break;default:t="connecting"}t!==r.connectionState&&(r.connectionState=t,r.emit("connectionStateChanged",r.connectionState))})),r.fpaToken=e,r}var n,h,f,p,y,D,q,A,F,B,W;return(0,l.default)(t,e),(0,u.default)(t,[{key:"subscribeToPushNotifications",value:function(e){var t=this,n=[];return[b.NotificationTypes.NEW_MESSAGE,b.NotificationTypes.ADDED_TO_CHANNEL,b.NotificationTypes.INVITED_TO_CHANNEL,b.NotificationTypes.REMOVED_FROM_CHANNEL,b.NotificationTypes.TYPING_INDICATOR,b.NotificationTypes.CONSUMPTION_UPDATE].forEach((function(r){n.push(t.services.notificationClient.subscribe(r,e))})),a.default.all(n)}},{key:"unsubscribeFromPushNotifications",value:function(e){var t=this,n=[];return[b.NotificationTypes.NEW_MESSAGE,b.NotificationTypes.ADDED_TO_CHANNEL,b.NotificationTypes.INVITED_TO_CHANNEL,b.NotificationTypes.REMOVED_FROM_CHANNEL,b.NotificationTypes.TYPING_INDICATOR,b.NotificationTypes.CONSUMPTION_UPDATE].forEach((function(r){n.push(t.services.notificationClient.unsubscribe(r,e))})),a.default.all(n)}},{key:"initialize",value:(W=(0,s.default)(r.default.mark((function e(){var n,s,a=this;return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.sessionPromise;case 2:return t.supportedPushChannels.forEach((function(e){return a.subscribeToPushNotifications(e)})),e.next=5,this.services.session.getSessionLinks();case 5:return this.services.publicChannels=new v.PublicChannels(this,this.services,(n=e.sent).publicChannelsUrl),this.services.userChannels=new P.UserChannels(this,this.services,n.myChannelsUrl),(s=(0,i.default)(this.options)).transport=null,this.services.mcsClient=new S.McsClient(this.fpaToken,n.mediaServiceUrl,s),e.next=13,this.services.typingIndicator.initialize();case 13:case"end":return e.stop()}}),e,this)}))),function(){return W.apply(this,arguments)})},{key:"shutdown",value:(B=(0,s.default)(r.default.mark((function e(){return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.twilsockClient.disconnect();case 2:case"end":return e.stop()}}),e,this)}))),function(){return B.apply(this,arguments)})},{key:"updateToken",value:(F=(0,s.default)(r.default.mark((function e(t){var n=this;return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(N.info("updateToken"),t){e.next=3;break}throw new Error(U);case 3:if(this.fpaToken!==t){e.next=5;break}return e.abrupt("return",this);case 5:return e.next=7,this.services.twilsockClient.updateToken(t).then((function(){return n.fpaToken=t})).then((function(){return n.services.mcsClient.updateToken(t)})).then((function(){return n.sessionPromise}));case 7:return e.abrupt("return",this);case 8:case"end":return e.stop()}}),e,this)}))),function(e){return F.apply(this,arguments)})},{key:"getChannelBySid",value:(A=(0,s.default)(r.default.mark((function e(t){var n=this;return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t&&"string"==typeof t){e.next=2;break}throw new Error("Client.getChannelBySid requires a <String>channelSid parameter");case 2:return e.abrupt("return",this.channels.syncListRead.promise.then((function(){return n.channels.getChannel(t).then((function(e){return e||n.services.publicChannels.getChannelBySid(t).then((function(e){return n.channels.pushChannel(e)}))}))})));case 3:case"end":return e.stop()}}),e,this)}))),function(e){return A.apply(this,arguments)})},{key:"getChannelByUniqueName",value:(q=(0,s.default)(r.default.mark((function e(t){var n=this;return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t&&"string"==typeof t){e.next=2;break}throw new Error("Client.getChannelByUniqueName requires a <String>uniqueName parameter");case 2:return e.abrupt("return",this.channels.syncListRead.promise.then((function(){return n.services.publicChannels.getChannelByUniqueName(t).then((function(e){return n.channels.pushChannel(e)}))})));case 3:case"end":return e.stop()}}),e,this)}))),function(e){return q.apply(this,arguments)})},{key:"getSubscribedChannels",value:function(e){return this.channelsPromise.then((function(t){return t.getChannels(e)}))}},{key:"getLocalChannels",value:function(e){return this.channelsPromise.then((function(n){var r=[];n.channels.forEach((function(e){r.push(e)}));var i="ascending";if(e&&e.order)if("descending"===e.order)i="descending";else if("ascending"!==e.order)throw new Error("Sorting order should be `ascending` or `descending`");if(e&&e.criteria)if("lastMessage"===e.criteria)r.sort((function(e,n){return t.compareChannelsByLastMessage(e,n,i)}));else if("uniqueName"===e.criteria)r.sort((function(e,n){return t.compareChannelsByStringProperty(e.uniqueName,n.uniqueName,i)}));else{if("friendlyName"!==e.criteria)throw new Error("Sorting criteria should be one of `lastMessage`, `uniqueName` or `friendlyName`");r.sort((function(e,n){return t.compareChannelsByStringProperty(e.friendlyName,n.friendlyName,i)}))}return r}))}},{key:"getPublicChannelDescriptors",value:function(){return this.services.publicChannels.getChannels()}},{key:"getUserChannelDescriptors",value:function(){return this.services.userChannels.getChannels()}},{key:"createChannel",value:function(e){return e=e||{},this.channelsPromise.then((function(t){return t.addChannel(e)}))}},{key:"setPushRegistrationId",value:(D=(0,s.default)(r.default.mark((function e(n,i){var s=this;return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(-1!==t.supportedPushChannels.indexOf(n)){e.next=2;break}throw new Error("Invalid or unsupported channelType: "+n);case 2:return e.next=4,this.subscribeToPushNotifications(n).then((function(){return s.services.notificationClient.setPushRegistrationId(i,n)}));case 4:case"end":return e.stop()}}),e,this)}))),function(e,t){return D.apply(this,arguments)})},{key:"unsetPushRegistrationId",value:(y=(0,s.default)(r.default.mark((function e(n){return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(-1!==t.supportedPushChannels.indexOf(n)){e.next=2;break}throw new Error("Invalid or unsupported channelType: "+n);case 2:return e.next=4,this.unsubscribeFromPushNotifications(n);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return y.apply(this,arguments)})},{key:"handlePushNotification",value:(p=(0,s.default)(r.default.mark((function e(n){return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:N.debug("handlePushNotification, notificationPayload=",n),this.emit("pushNotification",t.parsePushNotification(n));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return p.apply(this,arguments)})},{key:"getUser",value:function(e){return this.services.users.getUser(e)}},{key:"getUserDescriptor",value:(f=(0,s.default)(r.default.mark((function e(t){return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.services.users.getUserDescriptor(t));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return f.apply(this,arguments)})},{key:"getSubscribedUsers",value:(h=(0,s.default)(r.default.mark((function e(){return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.services.users.getSubscribedUsers());case 1:case"end":return e.stop()}}),e,this)}))),function(){return h.apply(this,arguments)})},{key:"user",get:function(){return this.services.users.myself}},{key:"reachabilityEnabled",get:function(){return this.services.session.reachabilityEnabled}},{key:"token",get:function(){return this.fpaToken}}],[{key:"create",value:(n=(0,s.default)(r.default.mark((function e(n,i){var s;return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return s=new t(n,i),e.next=3,s.initialize();case 3:return e.abrupt("return",s);case 4:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"compareChannelsByLastMessage",value:function(e,t,n){if(e.lastMessage&&t.lastMessage){if(e.lastMessage.timestamp&&t.lastMessage.timestamp)return e.lastMessage.timestamp.getTime()<t.lastMessage.timestamp.getTime()?"ascending"===n?-1:1:"ascending"===n?1:-1;if(e.lastMessage.timestamp)return-1;if(t.lastMessage.timestamp)return 1}return e.lastMessage?-1:t.lastMessage?1:0}},{key:"compareChannelsByStringProperty",value:function(e,t,n){return e&&t?"ascending"===n?e.localeCompare(t):-1*e.localeCompare(t):e?-1:t?1:0}},{key:"parsePushNotificationChatData",value:function(e){var n={};for(var r in t.supportedPushDataFields)null!=e[r]&&("message_index"===r?null!==R.parseToNumber(e[r])&&(n[t.supportedPushDataFields[r]]=Number(e[r])):n[t.supportedPushDataFields[r]]=e[r]);return n}},{key:"parsePushNotification",value:function(e){if(N.debug("parsePushNotification, notificationPayload=",e),null==e)throw new Error("Push notification payload should be provided");if(void 0!==e.aps){if(!e.twi_message_type)throw new Error("Provided push notification payload does not contain Programmable Chat push notification type");var n=t.parsePushNotificationChatData(e),r=e.aps,i=null,s=null;return"string"==typeof r.alert?i=r.alert||null:(i=r.alert.body||null,s=r.alert.title||null),new O.PushNotification({title:s,body:i,sound:r.sound||null,badge:r.badge||null,action:r.category||null,type:e.twi_message_type,data:n})}if(void 0!==e.data){var a=e.data;if(!a.twi_message_type)throw new Error("Provided push notification payload does not contain Programmable Chat push notification type");var o=t.parsePushNotificationChatData(e.data);return new O.PushNotification({title:a.twi_title||null,body:a.twi_body||null,sound:a.twi_sound||null,badge:null,action:a.twi_action||null,type:a.twi_message_type,data:o})}throw new Error("Provided push notification payload is not Programmable Chat notification")}}]),t}(f.EventEmitter);t.Client=D,D.version=j,D.supportedPushChannels=["fcm","apn","gcm"],D.supportedPushDataFields={channel_sid:"channelSid",message_sid:"messageSid",message_index:"messageIndex"},t.default=D},"/r3m":function(e,t,n){"use strict";var r=n("S7IX")(!0);n("S49y")(String,"String",(function(e){this._t=String(e),this._i=0}),(function(){var e,t=this._t,n=this._i;return n>=t.length?{value:void 0,done:!0}:(e=r(t,n),this._i+=e.length,{value:e,done:!1})}))},"/zo1":function(e,t,n){var r=n("IFjL");r(r.S,"Object",{setPrototypeOf:n("Eqmn").set})},"0tlO":function(e,t,n){"use strict";var r=h(n("qCKU")),i=h(n("tgXR")),s=h(n("IhEH")),a=h(n("XUND")),o=h(n("Rhu4")),u=h(n("aq5/")),c=h(n("4Mt5")),l=h(n("7xyS")),d=h(n("k2Qk"));function h(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var f=n("r2q8"),p=n("CPx3"),m=n("RtQP"),y=p.Logger.scope("User"),v=function(e){function t(e,n,r){(0,u.default)(this,t);var i=(0,l.default)(this,(t.__proto__||(0,o.default)(t)).call(this));return i.subscribed="initializing",i.setMaxListeners(0),i.services=r,i.state={identity:e,entityName:n,friendlyName:null,attributes:{},online:null,notifiable:null},i}var n,h,f,p;return(0,d.default)(t,e),(0,c.default)(t,[{key:"_update",value:function(e,t){var n=[];switch(y.debug("User for",this.state.identity,"updated:",e,t),e){case"friendlyName":this.state.friendlyName!==t.value&&(n.push("friendlyName"),this.state.friendlyName=t.value);break;case"attributes":var r={};try{r=JSON.parse(t.value)}catch(i){y.warn("Retrieved malformed attributes from the server for user: "+this.state.identity)}m.isDeepEqual(this.state.attributes,r)||(this.state.attributes=r,n.push("attributes"));break;case"reachability":this.state.online!==t.online&&(this.state.online=t.online,n.push("online")),this.state.notifiable!==t.notifiable&&(this.state.notifiable=t.notifiable,n.push("notifiable"));break;default:return}n.length>0&&this.emit("updated",{user:this,updateReasons:n})}},{key:"_updateReachabilityInfo",value:function(e,t){var n=this;return this.services.session.reachabilityEnabled?e.get("reachability").then(t).catch((function(e){y.warn("Failed to get reachability info for ",n.state.identity,e)})):a.default.resolve()}},{key:"_fetch",value:(p=(0,s.default)(i.default.mark((function e(){var t=this;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.state.entityName){e.next=2;break}return e.abrupt("return",this);case 2:return this.promiseToFetch=this.services.syncClient.map({id:this.state.entityName,mode:"open_existing",includeItems:!0}).then((function(e){return t.entity=e,e.on("itemUpdated",(function(e){return y.debug(t.state.entityName+" ("+t.state.identity+") itemUpdated: "+e.item.key),t._update(e.item.key,e.item.value)})),a.default.all([e.get("friendlyName").then((function(e){return t._update(e.key,e.value)})),e.get("attributes").then((function(e){return t._update(e.key,e.value)})),t._updateReachabilityInfo(e,(function(e){return t._update(e.key,e.value)}))])})).then((function(){return y.debug("Fetched for",t.identity),t.subscribed="subscribed",t.emit("userSubscribed",t),t})).catch((function(e){throw t.promiseToFetch=null,e})),e.abrupt("return",this.promiseToFetch);case 4:case"end":return e.stop()}}),e,this)}))),function(){return p.apply(this,arguments)})},{key:"_ensureFetched",value:function(){return this.promiseToFetch||this._fetch()}},{key:"updateAttributes",value:(f=(0,s.default)(i.default.mark((function e(t){return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==t){e.next=4;break}throw new Error("Attributes is required parameter");case 4:if(null!==t){e.next=8;break}throw new Error("Attributes can't be null");case 8:if(t.constructor===Object){e.next=10;break}throw new Error("Attributes must be a valid JSON object");case 10:if("unsubscribed"!=this.subscribed){e.next=12;break}throw new Error("Can't modify unsubscribed object");case 12:return e.next=14,this.services.session.addCommand("editUserAttributes",{username:this.state.identity,attributes:(0,r.default)(t)});case 14:return e.abrupt("return",this);case 15:case"end":return e.stop()}}),e,this)}))),function(e){return f.apply(this,arguments)})},{key:"updateFriendlyName",value:(h=(0,s.default)(i.default.mark((function e(t){return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t||"string"==typeof t){e.next=2;break}throw new Error("friendlyName must be string or empty");case 2:if("unsubscribed"!=this.subscribed){e.next=4;break}throw new Error("Can't modify unsubscribed object");case 4:return e.next=6,this.services.session.addCommand("editUserFriendlyName",{username:this.state.identity,friendlyName:t});case 6:return e.abrupt("return",this);case 7:case"end":return e.stop()}}),e,this)}))),function(e){return h.apply(this,arguments)})},{key:"unsubscribe",value:(n=(0,s.default)(i.default.mark((function e(){return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.promiseToFetch){e.next=7;break}return e.next=3,this.promiseToFetch;case 3:this.entity.close(),this.promiseToFetch=null,this.subscribed="unsubscribed",this.emit("userUnsubscribed",this);case 7:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"identity",get:function(){return this.state.identity},set:function(e){this.state.identity=e}},{key:"entityName",set:function(e){this.state.entityName=e}},{key:"attributes",get:function(){return this.state.attributes}},{key:"friendlyName",get:function(){return this.state.friendlyName}},{key:"online",get:function(){return this.state.online}},{key:"notifiable",get:function(){return this.state.notifiable}},{key:"isSubscribed",get:function(){return"subscribed"==this.subscribed}}]),t}(f.EventEmitter);t.User=v},"1bLK":function(e,t,n){var r=n("vbc5"),i=n("hR4s").document,s=r(i)&&r(i.createElement);e.exports=function(e){return s?i.createElement(e):{}}},"1eRg":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n("CmQt");class i{constructor(e){this.sdk="js",this.sdkVer=e,this.os=r.os.family,this.osVer=r.os.version,this.pl=r.name,this.plVer=r.version}}t.ClientInfo=i,t.default=i},"1ppQ":function(e,t){for(var n=[],r=0;r<256;++r)n[r]=(r+256).toString(16).substr(1);e.exports=function(e,t){var r=t||0;return[n[e[r++]],n[e[r++]],n[e[r++]],n[e[r++]],"-",n[e[r++]],n[e[r++]],"-",n[e[r++]],n[e[r++]],"-",n[e[r++]],n[e[r++]],"-",n[e[r++]],n[e[r++]],n[e[r++]],n[e[r++]],n[e[r++]],n[e[r++]]].join("")}},"1rCL":function(e){e.exports=JSON.parse('{"_from":"twilio-sync@^0.11.5","_id":"twilio-sync@0.11.5","_inBundle":false,"_integrity":"sha512-Gsr2Xms4HdnTzOnqayalMiIRD7A8iWUAk2UG83l0KFttH0sEXkU79QClm7j2qla1MD6s4niqrRAekVMYqeo/7Q==","_location":"/twilio-sync","_phantomChildren":{},"_requested":{"type":"range","registry":true,"raw":"twilio-sync@^0.11.5","name":"twilio-sync","escapedName":"twilio-sync","rawSpec":"^0.11.5","saveSpec":null,"fetchSpec":"^0.11.5"},"_requiredBy":["/twilio-chat"],"_resolved":"https://registry.npmjs.org/twilio-sync/-/twilio-sync-0.11.5.tgz","_shasum":"945e06117204fd23eab9022b27aa3d5c6b645ed9","_spec":"twilio-sync@^0.11.5","_where":"D:\\\\Gabrielle2\\\\Development\\\\Web\\\\cooper-pantry\\\\cooper\\\\node_modules\\\\twilio-chat","author":{"name":"Twilio"},"browserify":{"transform":["babelify"]},"bundleDependencies":false,"dependencies":{"loglevel":"^1.6.3","operation-retrier":"^3.0.0","platform":"^1.3.5","twilio-notifications":"^0.5.8","twilsock":"^0.5.11","uuid":"^3.3.2"},"deprecated":false,"description":"Twilio Sync client library","devDependencies":{"@types/chai":"^4.1.7","@types/chai-as-promised":"7.1.0","@types/chai-string":"^1.4.1","@types/mocha":"^5.2.7","@types/node":"^12.0.4","@types/sinon":"^7.0.12","@types/sinon-chai":"^3.2.2","async-test-tools":"^1.0.7","babel-core":"^6.26.0","babel-plugin-transform-builtin-extend":"^1.1.2","babel-plugin-transform-runtime":"^6.23.0","babel-preset-env":"^1.6.1","babel-runtime":"^6.26.0","babelify":"^8.0.0","browserify":"^16.2.3","chai":"^4.2.0","chai-as-promised":"^7.1.1","chai-string":"^1.5.0","cheerio":"^1.0.0-rc.2","cross-env":"^5.2.0","del":"^4.1.1","fancy-log":"^1.3.3","fs":"0.0.2","gulp":"^4.0.2","gulp-babel":"^7.0.1","gulp-derequire":"^2.1.0","gulp-if":"^2.0.2","gulp-insert":"^0.5.0","gulp-rename":"^1.4.0","gulp-sourcemaps":"^2.6.5","gulp-tap":"^1.0.1","gulp-tslint":"^8.1.4","gulp-typescript":"^5.0.1","gulp-uglify-es":"^1.0.4","ink-docstrap":"^1.3.2","jsdoc":"~3.5.5","jsonwebtoken":"^8.5.1","karma":"^4.1.0","karma-browserify":"^6.0.0","karma-browserstack-launcher":"^1.5.1","karma-mocha":"^1.3.0","karma-mocha-reporter":"^2.2.5","mocha":"^6.1.4","nyc":"^14.1.1","path":"^0.12.7","sinon":"^7.3.2","sinon-chai":"^3.3.0","source-map-explorer":"^1.8.0","ts-node":"^8.2.0","tslint":"^5.17.0","twilio":"^3.31.1","typescript":"^3.5.1","uglify-es":"^3.3.10","uglify-save-license":"^0.4.1","underscore":"^1.9.1","vinyl-buffer":"^1.0.1","vinyl-source-stream":"^2.0.0","watchify":"^3.11.1"},"engines":{"node":">=8"},"license":"MIT","main":"lib/index.js","name":"twilio-sync","types":"./lib/index.d.ts","version":"0.11.5"}')},"1sfF":function(e,t,n){var r=n("M25K"),i=n("eD9m")("iterator"),s=n("tReM");e.exports=n("rFq9").getIteratorMethod=function(e){if(null!=e)return e[i]||e["@@iterator"]||s[r(e)]}},"1yva":function(e,t,n){var r=n("dWRk"),i=n("aAA+"),s=n("MrWc"),a=n("MPuG"),o=n("Wnek");e.exports=function(e,t){var n=1==e,u=2==e,c=3==e,l=4==e,d=6==e,h=5==e||d,f=t||o;return function(t,o,p){for(var m,y,v=s(t),g=i(v),b=r(o,p,3),w=a(g.length),_=0,k=n?f(t,w):u?f(t,0):void 0;w>_;_++)if((h||_ in g)&&(y=b(m=g[_],_,v),e))if(n)k[_]=y;else if(y)switch(e){case 3:return!0;case 5:return m;case 6:return _;case 2:k.push(m)}else if(l)return!1;return d?-1:c||l?l:k}}},"2CE9":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class r extends Error{constructor(e,t,n,r,i){super(e),this.code=t,this.body=n,this.status=r,this.headers=i}}t.TransportError=r},"2E5e":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n("LYxL");class i{constructor(e){this.config=e.config,this.subscriptions=e.subscriptions,this.notifications=e.notifications,this.notifications.subscribe("twilio.sync.event"),this.notifications.subscribe("com.twilio.rtd.cds.document"),this.notifications.subscribe("com.twilio.rtd.cds.list"),this.notifications.subscribe("com.twilio.rtd.cds.map"),this.notifications.on("message",(e,t)=>this.onMessage(e,t)),this.notifications.on("transportReady",e=>this.onConnectionStateChanged(e))}onMessage(e,t){switch(r.default.trace("Notification type:",e,"content:",t),e){case"com.twilio.rtd.cds.document":case"com.twilio.rtd.cds.list":case"com.twilio.rtd.cds.map":this.subscriptions.acceptMessage(t,!1);break;case"twilio.sync.event":this.subscriptions.acceptMessage(t,!0)}}subscribe(e,t){this.subscriptions.add(e,t)}unsubscribe(e){this.subscriptions.remove(e)}onConnectionStateChanged(e){this.subscriptions.onConnectionStateChanged(e)}}t.Router=i,t.default=i},"2NA7":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n("F8DB");class i{constructor(e){this.id=e}static create(e){if(e instanceof Object&&"storage_id"in e)return new i(e.storage_id);throw new r.TwilsockError('Field "storage_id" is missing')}}t.OfflineProductStorage=i},"2YE3":function(e,t,n){var r=n("rFq9"),i=r.JSON||(r.JSON={stringify:JSON.stringify});e.exports=function(e){return i.stringify.apply(i,arguments)}},"2qJG":function(e,t,n){var r=n("IFjL"),i=n("rFq9"),s=n("7S/a");e.exports=function(e,t){var n=(i.Object||{})[e]||Object[e],a={};a[e]=t(n),r(r.S+r.F*s((function(){n(1)})),"Object",a)}},"2tcU":function(e,t,n){"use strict";t.__esModule=!0;var r=a(n("+ozH")),i=a(n("TQPF")),s="function"==typeof i.default&&"symbol"==typeof r.default?function(e){return typeof e}:function(e){return e&&"function"==typeof i.default&&e.constructor===i.default&&e!==i.default.prototype?"symbol":typeof e};function a(e){return e&&e.__esModule?e:{default:e}}t.default="function"==typeof i.default&&"symbol"===s(r.default)?function(e){return void 0===e?"undefined":s(e)}:function(e){return e&&"function"==typeof i.default&&e.constructor===i.default&&e!==i.default.prototype?"symbol":void 0===e?"undefined":s(e)}},3555:function(e,t,n){var r=n("UwCj"),i=n("8fQz"),s=n("ApsS");e.exports=n("ObEa")?Object.defineProperties:function(e,t){i(e);for(var n,a=s(t),o=a.length,u=0;o>u;)r.f(e,n=a[u++],t[n]);return e}},"3UoP":function(e,t,n){var r,i,s=n("hoXw"),a=n("5YqI"),o=0,u=0;e.exports=function(e,t,n){var c=t&&n||0,l=t||[],d=(e=e||{}).node||r,h=void 0!==e.clockseq?e.clockseq:i;if(null==d||null==h){var f=s();null==d&&(d=r=[1|f[0],f[1],f[2],f[3],f[4],f[5]]),null==h&&(h=i=16383&(f[6]<<8|f[7]))}var p=void 0!==e.msecs?e.msecs:(new Date).getTime(),m=void 0!==e.nsecs?e.nsecs:u+1,y=p-o+(m-u)/1e4;if(y<0&&void 0===e.clockseq&&(h=h+1&16383),(y<0||p>o)&&void 0===e.nsecs&&(m=0),m>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");o=p,u=m,i=h;var v=(1e4*(268435455&(p+=122192928e5))+m)%4294967296;l[c++]=v>>>24&255,l[c++]=v>>>16&255,l[c++]=v>>>8&255,l[c++]=255&v;var g=p/4294967296*1e4&268435455;l[c++]=g>>>8&255,l[c++]=255&g,l[c++]=g>>>24&15|16,l[c++]=g>>>16&255,l[c++]=h>>>8|128,l[c++]=255&h;for(var b=0;b<6;++b)l[c+b]=d[b];return t||a(l)}},"3eIt":function(e,t,n){"use strict";var r,i=(r=n("aq5/"))&&r.__esModule?r:{default:r};Object.defineProperty(t,"__esModule",{value:!0});var s=function e(){(0,i.default)(this,e)};t.ResponseCodes=s,s.HTTP_200_OK=200,s.HTTP_400_BAD_REQUEST=400,s.HTTP_404_NOT_FOUND=404,s.ACCESS_FORBIDDEN_FOR_IDENTITY=54007,s.LIST_NOT_FOUND=54150},4:function(e,t){},"4Mt5":function(e,t,n){"use strict";t.__esModule=!0;var r,i=(r=n("e5bQ"))&&r.__esModule?r:{default:r};t.default=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),(0,i.default)(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}()},"4RHC":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n("qlDM"),i=n("sc67"),s=n("LYxL"),a=n("r2q8"),o=n("yURk"),u=n("e/PS");t.InsightsItem=class{};class c extends o.SyncEntity{constructor(e,t,n,r){super(t,n),this.descriptor=e,this.items=d(r)}get sid(){return this.descriptor.sid}get uniqueName(){return null}get type(){return c.type}static get type(){return"live_query"}get lastEventId(){return null}get indexName(){return this.descriptor.indexName}get queryString(){return this.descriptor.queryExpression}get queryUri(){return this.descriptor.queryUri}get liveQueryDescriptor(){return this.descriptor}get network(){return this.services.network}onRemoved(){}getItems(){const e={};return this.items&&Object.keys(this.items).map((t,n)=>{e[t]=this.items[t].value}),e}_update(e){const t=e.item_key,n=e.item_revision;switch(e.type){case"live_query_item_updated":const r=this.items[t];if(!r||n>r.revision){const r={key:t,revision:n,value:e.item_data};this.items[t]=r,this.broadcastEventToListeners("itemUpdated",r)}break;case"live_query_item_removed":delete this.items[t],this.broadcastEventToListeners("itemRemoved",{key:t})}}}async function l(e){let{network:t,queryString:n,uri:r}=e;if(null==n)throw new i.SyncError("Invalid query",400,54507);const s={query_string:n};return(await t.post(r,s,void 0,!0)).body}function d(e){if(e)return e.reduce((e,t)=>(e[t.key]={key:t.key,value:t.data,revision:t.revision},e),{})}t.LiveQueryImpl=c,t.queryItems=l;class h extends u.default{constructor(e){super(),this.liveQueryImpl=e,this.liveQueryImpl.attach(this)}static get type(){return c.type}get type(){return c.type}get sid(){return this.liveQueryImpl.sid}close(){super.close(),this.liveQueryImpl.detach(this.listenerUuid)}getItems(){return this.ensureNotClosed(),this.liveQueryImpl.getItems()}}t.LiveQuery=h;class f extends a.EventEmitter{constructor(e){super(),this.queryExpression=null,Object.assign(this,e),this.updateIndexName(e.indexName)}static get type(){return"instant_query"}get type(){return f.type}async search(e){return l({network:this.network,uri:this.queryUri,queryString:e}).then(t=>{this.queryExpression=e,this.items=d(t.items),this.emit("searchResult",this.getItems())}).catch(t=>{throw s.default.error(`Error '${t.message}' while executing query '${e}'`),this.queryExpression=null,this.items=null,t})}async subscribe(){return null==this.queryExpression?Promise.reject(new i.SyncError("Invalid query",400,54507)):this.liveQueryCreator(this.indexName,this.queryExpression)}getItems(){const e={};return this.items&&Object.keys(this.items).map((t,n)=>{e[t]=this.items[t].value}),e}updateIndexName(e){if(!e||"string"!=typeof e)throw new Error("Index name must contain a non-empty string value");this.indexName=e,this.queryUri=this.generateQueryUri(this.indexName)}generateQueryUri(e){return new r.UriBuilder(this.insightsUri).pathSegment(e).pathSegment("Items").build()}}t.InstantQuery=f,t.default=h},"4iaB":function(e,t,n){n("nX7j");var r=n("rFq9").Object;e.exports=function(e,t){return r.create(e,t)}},5:function(e,t){},"5JVr":function(e,t,n){e.exports={default:n("MRQX"),__esModule:!0}},"5YqI":function(e,t){for(var n=[],r=0;r<256;++r)n[r]=(r+256).toString(16).substr(1);e.exports=function(e,t){var r=t||0;return[n[e[r++]],n[e[r++]],n[e[r++]],n[e[r++]],"-",n[e[r++]],n[e[r++]],"-",n[e[r++]],n[e[r++]],"-",n[e[r++]],n[e[r++]],"-",n[e[r++]],n[e[r++]],n[e[r++]],n[e[r++]],n[e[r++]],n[e[r++]]].join("")}},"5ZaL":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n("XdyU");function i(e,t){return[`${(new Date).toISOString()} Notifications ${e}:`].concat(Array.from(t))}class s{constructor(){this.prefix=""}static scope(e=""){return new s}setLevel(e){r.setLevel(e)}trace(...e){r.debug.apply(null,i("T"+this.prefix,e))}debug(...e){r.debug.apply(null,i("D"+this.prefix,e))}info(...e){r.info.apply(null,i("I"+this.prefix,e))}warn(...e){r.warn.apply(null,i("W"+this.prefix,e))}error(...e){r.error.apply(null,i("E"+this.prefix,e))}}t.Logger=s;let a=s.scope();t.log=a},"6UZt":function(e,t,n){var r=n("Jo0e"),i=Math.max,s=Math.min;e.exports=function(e,t){return(e=r(e))<0?i(e+t,0):s(e,t)}},"6XaB":function(e,t){var n="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(n){var r=new Uint8Array(16);e.exports=function(){return n(r),r}}else{var i=new Array(16);e.exports=function(){for(var e,t=0;t<16;t++)0==(3&t)&&(e=4294967296*Math.random()),i[t]=e>>>((3&t)<<3)&255;return i}}},"6XsV":function(e,t,n){n("/r3m"),n("Fk9O"),e.exports=n("dWcX").f("iterator")},"6YAS":function(e,t,n){var r=n("hR4s"),i=n("CmYO").set,s=r.MutationObserver||r.WebKitMutationObserver,a=r.process,o=r.Promise,u="process"==n("e7fL")(a);e.exports=function(){var e,t,n,c=function(){var r,i;for(u&&(r=a.domain)&&r.exit();e;){i=e.fn,e=e.next;try{i()}catch(s){throw e?n():t=void 0,s}}t=void 0,r&&r.enter()};if(u)n=function(){a.nextTick(c)};else if(!s||r.navigator&&r.navigator.standalone)if(o&&o.resolve){var l=o.resolve(void 0);n=function(){l.then(c)}}else n=function(){i.call(r,c)};else{var d=!0,h=document.createTextNode("");new s(c).observe(h,{characterData:!0}),n=function(){h.data=d=!d}}return function(r){var i={fn:r,next:void 0};t&&(t.next=i),e||(e=i,n()),t=i}}},"70ul":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n("BHqR");t.Init=class extends r.AbstractMessage{constructor(e,t,n,r=null,i=null){super(),this.method="init",this.token=e,this.continuation_token=t,this.metadata=n,this.registrations=r,this.tweaks=i,this.capabilities=["client_update","offline_storage"]}}},"7S/a":function(e,t){e.exports=function(e){try{return!!e()}catch(t){return!0}}},"7ae9":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=["weeks","years","months","days","hours","minutes","seconds"],i=t.pattern=new RegExp("P(?:(\\d+(?:[\\.,]\\d+)?W)|(\\d+(?:[\\.,]\\d+)?Y)?(\\d+(?:[\\.,]\\d+)?M)?(\\d+(?:[\\.,]\\d+)?D)?(?:T(\\d+(?:[\\.,]\\d+)?H)?(\\d+(?:[\\.,]\\d+)?M)?(\\d+(?:[\\.,]\\d+)?S)?)?)"),s=t.parse=function(e){return e.match(i).slice(1).reduce((function(e,t,n){return e[r[n]]=parseFloat(t)||0,e}),{})},a=t.end=function(e,t){var n=t?t.getTime():Date.now(),r=new Date(n);return r.setFullYear(r.getFullYear()+e.years),r.setMonth(r.getMonth()+e.months),r.setDate(r.getDate()+e.days),r.setHours(r.getHours()+e.hours),r.setMinutes(r.getMinutes()+e.minutes),r.setMilliseconds(r.getMilliseconds()+1e3*e.seconds),r.setDate(r.getDate()+7*e.weeks),r},o=t.toSeconds=function(e,t){var n=t?t.getTime():Date.now(),r=new Date(n);return(a(e,r).getTime()-r.getTime())/1e3};t.default={end:a,toSeconds:o,pattern:i,parse:s}},"7xyS":function(e,t,n){"use strict";t.__esModule=!0;var r,i=(r=n("2tcU"))&&r.__esModule?r:{default:r};t.default=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==(void 0===t?"undefined":(0,i.default)(t))&&"function"!=typeof t?e:t}},"8HAW":function(e,t,n){e.exports={default:n("VAi2"),__esModule:!0}},"8fQz":function(e,t,n){var r=n("vbc5");e.exports=function(e){if(!r(e))throw TypeError(e+" is not an object!");return e}},"8lcS":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n("r2q8"),i=n("F8DB"),s=n("grU3"),a=n("V/GX"),o=n("5ZaL");t.Client=class extends r.EventEmitter{constructor(e,t={}){if(super(),!e||0===e.length)throw new Error("Token is required for Notifications client");t.logLevel=t.logLevel||"error",o.log.setLevel(t.logLevel);const n=t.productId||"notifications";t.twilsockClient=t.twilsockClient||new i.TwilsockClient(e,n,t),t.transport=t.transport||t.twilsockClient,this.services={twilsock:t.twilsockClient,transport:t.transport,config:new s.Configuration(null,t)},this.registrar=new a.Registrar(n,this.services.transport,this.services.twilsock,this.services.config),this.reliableTransportState={overall:!1,transport:!1,registration:!1,lastEmitted:null},this._onTransportStateChange(this.services.twilsock.isConnected),this.registrar.on("transportReady",e=>{this._onRegistrationStateChange(e?"registered":"")}),this.registrar.on("stateChanged",e=>{this._onRegistrationStateChange(e)}),this.registrar.on("needReliableTransport",this._onNeedReliableTransport.bind(this)),this.services.twilsock.on("message",(e,t)=>this._routeMessage(e,t)),this.services.twilsock.on("connected",e=>{this._onTransportStateChange(!0),this.registrar.setNotificationId("twilsock",e)}),this.services.twilsock.on("disconnected",()=>{this._onTransportStateChange(!1)}),this.services.config.updateToken(e),this.registrar.updateToken(e)}get connectionState(){return"disconnected"===this.services.twilsock.state?"disconnected":"disconnecting"===this.services.twilsock.state?"disconnecting":"connected"===this.services.twilsock.state&&this.reliableTransportState.registration?"connected":"rejected"===this.services.twilsock.state?"denied":"connecting"}_routeMessage(e,t){o.log.trace("Message arrived: ",e,t),this.emit("message",e,t)}_onNeedReliableTransport(e){e?this.services.twilsock.connect():this.services.twilsock.disconnect()}_onRegistrationStateChange(e){this.reliableTransportState.registration="registered"===e,this._updateTransportState()}_onTransportStateChange(e){this.reliableTransportState.transport=e,this._updateTransportState()}_updateTransportState(){const e=this.reliableTransportState.transport&&this.reliableTransportState.registration;this.reliableTransportState.overall!==e&&(this.reliableTransportState.overall=e,o.log.info("Transport ready:",e),this.emit("transportReady",e)),this.reliableTransportState.lastEmitted!==this.connectionState&&(this.reliableTransportState.lastEmitted=this.connectionState,this.emit("connectionStateChanged",this.connectionState))}subscribe(e,t="twilsock"){return o.log.trace("Add subscriptions for message type: ",e,t),this.registrar.subscribe(e,t)}unsubscribe(e,t="twilsock"){return o.log.trace("Remove subscriptions for message type: ",e,t),this.registrar.unsubscribe(e,t)}handlePushNotification(e){return{messageType:e.twi_message_type,payload:e.payload}}setPushRegistrationId(e,t){o.log.trace("Set push registration id",e,t),this.registrar.setNotificationId(t,e)}async updateToken(e){o.log.info("authTokenUpdated"),this.services.config.token!==e&&(await this.services.twilsock.updateToken(e),this.services.config.updateToken(e),this.registrar.updateToken(e))}}},"9F0I":function(e,t,n){"use strict";var r=a(n("XUND")),i=a(n("aq5/")),s=a(n("4Mt5"));function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(){var t=this;(0,i.default)(this,e),this._promise=new r.default((function(e,n){t._resolve=e,t._reject=n}))}return(0,s.default)(e,[{key:"update",value:function(e){this._resolve(e)}},{key:"set",value:function(e){this.current=e,this._resolve(e)}},{key:"fail",value:function(e){this._reject(e)}},{key:"promise",get:function(){return this._promise}}]),e}();t.Deferred=o},"9YHp":function(e,t,n){var r=n("hR4s"),i=n("rFq9"),s=n("UtsQ"),a=n("dWcX"),o=n("UwCj").f;e.exports=function(e){var t=i.Symbol||(i.Symbol=s?{}:r.Symbol||{});"_"==e.charAt(0)||e in t||o(t,e,{value:a.f(e)})}},"9bSt":function(e,t,n){"use strict";var r=n("UwCj"),i=n("jHgz");e.exports=function(e,t,n){t in e?r.f(e,t,i(0,n)):e[t]=n}},"9v8s":function(e,t,n){var r=n("dWRk"),i=n("9vFK"),s=n("fawX"),a=n("8fQz"),o=n("MPuG"),u=n("1sfF"),c={},l={};(t=e.exports=function(e,t,n,d,h){var f,p,m,y,v=h?function(){return e}:u(e),g=r(n,d,t?2:1),b=0;if("function"!=typeof v)throw TypeError(e+" is not iterable!");if(s(v)){for(f=o(e.length);f>b;b++)if((y=t?g(a(p=e[b])[0],p[1]):g(e[b]))===c||y===l)return y}else for(m=v.call(e);!(p=m.next()).done;)if((y=i(m,g,p.value,t))===c||y===l)return y}).BREAK=c,t.RETURN=l},"9vFK":function(e,t,n){var r=n("8fQz");e.exports=function(e,t,n,i){try{return i?t(r(n)[0],n[1]):t(n)}catch(a){var s=e.return;throw void 0!==s&&r(s.call(e)),a}}},AKzx:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n("r2q8");class i extends r.EventEmitter{constructor(e){super(),this.minDelay=e.min,this.maxDelay=e.max,this.initialDelay=e.initial||0,this.maxAttemptsCount=e.maxAttemptsCount||0,this.maxAttemptsTime=e.maxAttemptsTime||0,this.randomness=e.randomness||0,this.inProgress=!1,this.attemptNum=0,this.prevDelay=0,this.currDelay=0}attempt(){clearTimeout(this.timeout),this.attemptNum++,this.timeout=null,this.emit("attempt",this)}nextDelay(e){if("number"==typeof e)return this.prevDelay=0,this.currDelay=e,e;if(0==this.attemptNum)return this.initialDelay;if(1==this.attemptNum)return this.currDelay=this.minDelay,this.currDelay;this.prevDelay=this.currDelay;let t=this.currDelay+this.prevDelay;return this.maxDelay&&t>this.maxDelay&&(this.currDelay=this.maxDelay,t=this.maxDelay),this.currDelay=t,t}randomize(e){let t=e*this.randomness,n=Math.round(Math.random()*t*2-t);return Math.max(0,e+n)}scheduleAttempt(e){if(this.maxAttemptsCount&&this.attemptNum>=this.maxAttemptsCount)return this.cleanup(),this.emit("failed",new Error("Maximum attempt count limit reached")),void this.reject(new Error("Maximum attempt count reached"));let t=this.nextDelay(e);if(t=this.randomize(t),this.maxAttemptsTime&&this.startTimestamp+this.maxAttemptsTime<Date.now()+t)return this.cleanup(),this.emit("failed",new Error("Maximum attempt time limit reached")),void this.reject(new Error("Maximum attempt time limit reached"));this.timeout=setTimeout(()=>this.attempt(),t)}cleanup(){clearTimeout(this.timeout),this.timeout=null,this.inProgress=!1,this.attemptNum=0,this.prevDelay=0,this.currDelay=0}start(){if(this.inProgress)throw new Error("Retrier is already in progress");return this.inProgress=!0,new Promise((e,t)=>{this.resolve=e,this.reject=t,this.startTimestamp=Date.now(),this.scheduleAttempt(this.initialDelay)})}cancel(){this.timeout&&(clearTimeout(this.timeout),this.timeout=null,this.inProgress=!1,this.emit("cancelled"),this.reject(new Error("Cancelled")))}succeeded(e){this.emit("succeeded",e),this.resolve(e)}failed(e,t){if(this.timeout)throw new Error("Retrier attempt is already in progress");this.scheduleAttempt(t)}run(e){return this.on("attempt",()=>{e().then(e=>this.succeeded(e)).catch(e=>this.failed(e))}),this.start()}}t.Retrier=i,t.default=i},ApsS:function(e,t,n){var r=n("J0XI"),i=n("guEv");e.exports=Object.keys||function(e){return r(e,i)}},AwPv:function(e,t,n){var r=n("IFjL");r(r.P+r.R,"Map",{toJSON:n("KIy9")("Map")})},B3Ab:function(e,t,n){"use strict";t.__esModule=!0;var r=s(n("8HAW")),i=s(n("QDM+"));function s(e){return e&&e.__esModule?e:{default:e}}t.default=function(e,t){if(Array.isArray(e))return e;if((0,r.default)(Object(e)))return function(e,t){var n=[],r=!0,s=!1,a=void 0;try{for(var o,u=(0,i.default)(e);!(r=(o=u.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(c){s=!0,a=c}finally{try{!r&&u.return&&u.return()}finally{if(s)throw a}}return n}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}},B3fw:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n("lKIr"),i=n("qlDM"),s=n("sc67"),a=n("LYxL"),o=n("yURk"),u=n("tTO9"),c=n("L760"),l=n("QvZc"),d=n("wiho"),h=n("e/PS");class f extends o.SyncEntity{constructor(e,t,n){super(e,n),this.updateMergingQueue=new d.NamespacedMergingQueue((e,t)=>"number"==typeof t.ttl?{ttl:t.ttl}:e),this.cache=new l.Cache,this.descriptor=t,this.descriptor.date_updated=new Date(this.descriptor.date_updated),t.items&&t.items.forEach(e=>{e.date_updated=new Date(e.date_updated),this.cache.store(e.key,new u.MapItem(e),e.last_event_id)})}get uri(){return this.descriptor.url}get links(){return this.descriptor.links}get revision(){return this.descriptor.revision}get lastEventId(){return this.descriptor.last_event_id}get dateExpires(){return this.descriptor.date_expires}static get type(){return"map"}get type(){return"map"}get indexName(){}get queryString(){}get sid(){return this.descriptor.sid}get uniqueName(){return this.descriptor.unique_name||null}get dateUpdated(){return this.descriptor.date_updated}async set(e,t,n){const i=n||{};return r.validateOptionalTtl(i.ttl),this.updateMergingQueue.squashAndAdd(e,i,n=>this._putItemUnconditionally(e,t,n.ttl))}async get(e){return this.cache.has(e)?this.cache.get(e):this._getItemFromServer(e)}async _getItemFromServer(e){let t=await this.queryItems({key:e});if(t.items.length<1)throw new s.SyncError(`No item with key ${e} found`,404,54201);return t.items[0]}async mutate(e,t,n){const i=n||{};return r.validateOptionalTtl(i.ttl),this.updateMergingQueue.add(e,i,n=>this._putItemWithIfMatch(e,t,n.ttl))}async update(e,t,n){return this.mutate(e,e=>Object.assign(e,t),n)}async _putItemUnconditionally(e,t,n){const r=await this._putItemToServer(e,t,void 0,n),i=r.item;return this._handleItemMutated(i.key,i.url,i.last_event_id,i.revision,i.data,i.date_updated,i.date_expires,r.added,!1),this.cache.get(i.key)}async _putItemWithIfMatch(e,t,n){const i=await this.get(e).catch(t=>{if(404===t.status)return new u.MapItem({key:e,data:{},last_event_id:-1,revision:"-1",url:null,date_updated:null,date_expires:null});throw t});let s=t(r.deepClone(i.value));if(!s)return i;{let r=i.revision;try{const t=await this._putItemToServer(e,s,r,n),i=t.item;return this._handleItemMutated(i.key,i.url,i.last_event_id,i.revision,i.data,i.date_updated,i.date_expires,t.added,!1),this.cache.get(i.key)}catch(a){if(412===a.status)return await this._getItemFromServer(e),this._putItemWithIfMatch(e,t,n);throw a}}}async _putItemToServer(e,t,n,r){const s=new i.UriBuilder(this.links.items).pathSegment(e).build(),a={data:t};"number"==typeof r&&(a.ttl=r);try{const e=await this.services.network.put(s,a,n),r=e.body;return r.data=t,r.date_updated=new Date(r.date_updated),{added:201===e.status.code,item:r}}catch(o){throw 404===o.status&&this.onRemoved(!1),o}}async remove(e){if(void 0===e)throw new Error("Key argument is invalid");let t=await this.get(e),n=await this.services.network.delete(t.uri);this._handleItemRemoved(e,n.body.last_event_id,void 0,new Date(n.body.date_updated),!1)}async queryItems(e){e=e||{};const t=new i.UriBuilder(this.links.items).queryParam("From",e.from).queryParam("PageSize",e.limit).queryParam("Key",e.key).queryParam("PageToken",e.pageToken).queryParam("Order",e.order).build();let n=await this.services.network.get(t),r=n.body.items.map(e=>(e.date_updated=new Date(e.date_updated),this.cache.get(e.key)?this._handleItemMutated(e.key,e.url,e.last_event_id,e.revision,e.data,e.date_updated,e.date_expires,!1,!0):this.cache.store(e.key,new u.MapItem(e),e.last_event_id),this.cache.get(e.key)));const s=n.body.meta;return new c.Paginator(r,e=>this.queryItems({pageToken:e}),s.previous_token,s.next_token)}async getItems(e){return r.validatePageSize((e=e||{}).pageSize),e.limit=e.pageSize||e.limit||50,e.order=e.order||"asc",this.queryItems(e)}shouldIgnoreEvent(e,t){return this.cache.isKnown(e,t)}_update(e,t){switch(e.date_created=new Date(e.date_created),e.type){case"map_item_added":case"map_item_updated":this._handleItemMutated(e.item_key,e.item_url,e.id,e.item_revision,e.item_data,e.date_created,void 0,"map_item_added"===e.type,!0);break;case"map_item_removed":this._handleItemRemoved(e.item_key,e.id,e.item_data,e.date_created,!0);break;case"map_removed":this.onRemoved(!1)}t&&this._advanceLastEventId(e.id,e.map_revision)}_advanceLastEventId(e,t){this.lastEventId<e&&(this.descriptor.last_event_id=e,t&&(this.descriptor.revision=t))}_updateRootDateUpdated(e){(!this.descriptor.date_updated||e.getTime()>this.descriptor.date_updated.getTime())&&(this.descriptor.date_updated=e,this.services.storage.update(this.type,this.sid,this.uniqueName,{date_updated:e}))}_handleItemMutated(e,t,n,r,i,s,o,c,l){if(this.shouldIgnoreEvent(e,n))a.default.trace("Item ",e," update skipped, current:",this.lastEventId,", remote:",n);else{this._updateRootDateUpdated(s);let a=this.cache.get(e);a?(a.update(n,r,i,s),this.cache.store(e,a,n),void 0!==o&&a.updateDateExpires(o),this.emitItemMutationEvent(a,l,!1)):(a=new u.MapItem({key:e,url:t,last_event_id:n,revision:r,data:i,date_updated:s,date_expires:o}),this.cache.store(e,a,n),this.emitItemMutationEvent(a,l,c))}}emitItemMutationEvent(e,t,n){this.broadcastEventToListeners(n?"itemAdded":"itemUpdated",{item:e,isLocal:!t})}_handleItemRemoved(e,t,n,r,i){this._updateRootDateUpdated(r),this.cache.delete(e,t),this.broadcastEventToListeners("itemRemoved",{key:e,isLocal:!i,value:n})}onRemoved(e){this._unsubscribe(),this.removalHandler(this.type,this.sid,this.uniqueName),this.broadcastEventToListeners("removed",{isLocal:e})}async setTtl(e){r.validateMandatoryTtl(e);try{const t={ttl:e},n=await this.services.network.post(this.uri,t);this.descriptor.date_expires=n.body.date_expires}catch(t){throw 404===t.status&&this.onRemoved(!1),t}}async setItemTtl(e,t){r.validateMandatoryTtl(t);let n=await this.get(e);const i={ttl:t},s=await this.services.network.post(n.uri,i);n.updateDateExpires(s.body.date_expires)}async removeMap(){await this.services.network.delete(this.uri),this.onRemoved(!0)}}t.SyncMapImpl=f;class p extends h.Closeable{constructor(e){super(),this.syncMapImpl=e,this.syncMapImpl.attach(this)}get uri(){return this.syncMapImpl.uri}get links(){return this.syncMapImpl.links}get revision(){return this.syncMapImpl.revision}get lastEventId(){return this.syncMapImpl.lastEventId}get dateExpires(){return this.syncMapImpl.dateExpires}static get type(){return f.type}get type(){return f.type}get sid(){return this.syncMapImpl.sid}get uniqueName(){return this.syncMapImpl.uniqueName}get dateUpdated(){return this.syncMapImpl.dateUpdated}async set(e,t,n){return this.ensureNotClosed(),this.syncMapImpl.set(e,t,n)}async get(e){return this.ensureNotClosed(),this.syncMapImpl.get(e)}async mutate(e,t,n){return this.ensureNotClosed(),this.syncMapImpl.mutate(e,t,n)}async update(e,t,n){return this.ensureNotClosed(),this.syncMapImpl.update(e,t,n)}async remove(e){return this.ensureNotClosed(),this.syncMapImpl.remove(e)}async getItems(e){return this.ensureNotClosed(),this.syncMapImpl.getItems(e)}async setTtl(e){return this.ensureNotClosed(),this.syncMapImpl.setTtl(e)}async setItemTtl(e,t){return this.ensureNotClosed(),this.syncMapImpl.setItemTtl(e,t)}async removeMap(){this.ensureNotClosed(),await this.syncMapImpl.removeMap()}close(){super.close(),this.syncMapImpl.detach(this.listenerUuid)}}t.SyncMap=p,t.default=p},BHqR:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n("TkJz");t.AbstractMessage=class{constructor(e){this.id=e||`TM${r.v4()}`}}},Bkdt:function(e,t,n){var r=n("8fQz"),i=n("1sfF");e.exports=n("rFq9").getIterator=function(e){var t=i(e);if("function"!=typeof t)throw TypeError(e+" is not iterable!");return r(t.call(e))}},BxSP:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SessionStorage=class{constructor(e,t){this.config=e,this.storageId=null;try{this.storage=t||sessionStorage}catch(n){}}storageKey(e,t){return`${this.storageId}::${e}::${t}`}get isReady(){return this.config.sessionStorageEnabled&&!!this.storageId}updateStorageId(e){this.storageId=e}store(e,t,n){return this.isReady?this._store(this.storageKey(e,t),n):null}read(e,t){return this.isReady?this._read(this.storageKey(e,t)):null}remove(e,t,n){if(!this.isReady)return null;try{this.storage.removeItem(this.storageKey(e,t)),n&&this.storage.removeItem(this.storageKey(e,n))}catch(r){}}update(e,t,n,r){if(!this.isReady)return null;this._apply(this.storageKey(e,t),r),n&&this._apply(this.storageKey(e,n),r)}_store(e,t){try{this.storage.setItem(e,JSON.stringify(t))}catch(n){}}_read(e){try{let t=this.storage.getItem(e);if(t)return JSON.parse(t)}catch(t){}return null}_apply(e,t){let n=this._read(e);if(!n)return!1;this._store(e,Object.assign(n,t))}}},CHRr:function(e,t,n){n("HWod");var r=n("rFq9").Object;e.exports=function(e,t,n){return r.defineProperty(e,t,n)}},CPx3:function(e,t,n){"use strict";var r=a(n("aq5/")),i=a(n("4Mt5")),s=a(n("oPEB"));function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=n("XdyU");function u(e,t){return[(new Date).toISOString()+" Chat "+e+":"].concat((0,s.default)(t))}var c=function(){function e(t){(0,r.default)(this,e),this.prefix="",this.prefix=null!=t&&t.length>0?t+" ":""}return(0,i.default)(e,[{key:"setLevel",value:function(e){o.setLevel(e)}},{key:"trace",value:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];o.trace.apply(null,u(this.prefix+"T",t))}},{key:"debug",value:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];o.debug.apply(null,u(this.prefix+"D",t))}},{key:"info",value:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];o.info.apply(null,u(this.prefix+"I",t))}},{key:"warn",value:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];o.warn.apply(null,u(this.prefix+"W",t))}},{key:"error",value:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];o.error.apply(null,u(this.prefix+"E",t))}}],[{key:"scope",value:function(t){return new e(t)}},{key:"setLevel",value:function(e){o.setLevel(e)}},{key:"trace",value:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];o.trace.apply(null,u("T",t))}},{key:"debug",value:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];o.debug.apply(null,u("D",t))}},{key:"info",value:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];o.info.apply(null,u("I",t))}},{key:"warn",value:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];o.warn.apply(null,u("W",t))}},{key:"error",value:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];o.error.apply(null,u("E",t))}}]),e}();t.Logger=c},CafK:function(e,t,n){e.exports={default:n("TjkB"),__esModule:!0}},Cf4i:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Configuration=class{constructor(e,t,n={}){this.activeGrant=t,this._token=e,this.url=(n.twilsock||n.Twilsock||{}).uri||`wss://tsock.${n.region||"us1"}.twilio.com/v3/wsconnect`,this._continuationToken=n.continuationToken?n.continuationToken:null,this.logLevel=n.logLevel?n.logLevel:"error",this.retryPolicy=n.retryPolicy?n.retryPolicy:{min:1e3,max:12e4,randomness:.2},this.clientMetadata=n.clientMetadata?n.clientMetadata:{},this.clientMetadata.ver="0.5.11",this.initRegistrations=n.initRegistrations?n.initRegistrations:null,this.tweaks=n.tweaks?n.tweaks:null}get token(){return this._token}get continuationToken(){return this._continuationToken}updateToken(e){this._token=e}updateContinuationToken(e){this._continuationToken=e}}},CmQt:function(e,t,n){(function(e){var r;(function(){"use strict";var i={function:!0,object:!0},s=i[typeof window]&&window||this,a=i[typeof t]&&t&&i[typeof e]&&e&&!e.nodeType&&e&&"object"==typeof global&&global;!a||a.global!==a&&a.window!==a&&a.self!==a||(s=a);var o=Math.pow(2,53)-1,u=/\bOpera/,c=Object.prototype,l=c.hasOwnProperty,d=c.toString;function h(e){return(e=String(e)).charAt(0).toUpperCase()+e.slice(1)}function f(e){return e=g(e),/^(?:webOS|i(?:OS|P))/.test(e)?e:h(e)}function p(e,t){for(var n in e)l.call(e,n)&&t(e[n],n,e)}function m(e){return null==e?h(e):d.call(e).slice(8,-1)}function y(e){return String(e).replace(/([ -])(?!$)/g,"$1?")}function v(e,t){var n=null;return function(e,t){var n=-1,r=e?e.length:0;if("number"==typeof r&&r>-1&&r<=o)for(;++n<r;)t(e[n],n);else p(e,t)}(e,(function(r,i){n=t(n,r,i,e)})),n}function g(e){return String(e).replace(/^ +| +$/g,"")}var b=function e(t){var n=s,r=t&&"object"==typeof t&&"String"!=m(t);r&&(n=t,t=null);var i=n.navigator||{},a=i.userAgent||"";t||(t=a);var o,c,l,h,b=r?!!i.likeChrome:/\bChrome\b/.test(t)&&!/internal|\n/i.test(d.toString()),w=r?"Object":"ScriptBridgingProxyObject",_=r?"Object":"Environment",k=r&&n.java?"JavaPackage":m(n.java),x=r?"Object":"RuntimeObject",S=/\bJava/.test(k)&&n.java,C=S&&m(n.environment)==_,M=S?"a":"\u03b1",E=S?"b":"\u03b2",T=n.document||{},I=n.operamini||n.opera,P=u.test(P=r&&I?I["[[Class]]"]:m(I))?P:I=null,O=t,R=[],N=null,j=t==a,U=j&&I&&"function"==typeof I.version&&I.version(),L=v([{label:"EdgeHTML",pattern:"Edge"},"Trident",{label:"WebKit",pattern:"AppleWebKit"},"iCab","Presto","NetFront","Tasman","KHTML","Gecko"],(function(e,n){return e||RegExp("\\b"+(n.pattern||y(n))+"\\b","i").exec(t)&&(n.label||n)})),D=v(["Adobe AIR","Arora","Avant Browser","Breach","Camino","Electron","Epiphany","Fennec","Flock","Galeon","GreenBrowser","iCab","Iceweasel","K-Meleon","Konqueror","Lunascape","Maxthon",{label:"Microsoft Edge",pattern:"Edge"},"Midori","Nook Browser","PaleMoon","PhantomJS","Raven","Rekonq","RockMelt",{label:"Samsung Internet",pattern:"SamsungBrowser"},"SeaMonkey",{label:"Silk",pattern:"(?:Cloud9|Silk-Accelerated)"},"Sleipnir","SlimBrowser",{label:"SRWare Iron",pattern:"Iron"},"Sunrise","Swiftfox","Waterfox","WebPositive","Opera Mini",{label:"Opera Mini",pattern:"OPiOS"},"Opera",{label:"Opera",pattern:"OPR"},"Chrome",{label:"Chrome Mobile",pattern:"(?:CriOS|CrMo)"},{label:"Firefox",pattern:"(?:Firefox|Minefield)"},{label:"Firefox for iOS",pattern:"FxiOS"},{label:"IE",pattern:"IEMobile"},{label:"IE",pattern:"MSIE"},"Safari"],(function(e,n){return e||RegExp("\\b"+(n.pattern||y(n))+"\\b","i").exec(t)&&(n.label||n)})),q=B([{label:"BlackBerry",pattern:"BB10"},"BlackBerry",{label:"Galaxy S",pattern:"GT-I9000"},{label:"Galaxy S2",pattern:"GT-I9100"},{label:"Galaxy S3",pattern:"GT-I9300"},{label:"Galaxy S4",pattern:"GT-I9500"},{label:"Galaxy S5",pattern:"SM-G900"},{label:"Galaxy S6",pattern:"SM-G920"},{label:"Galaxy S6 Edge",pattern:"SM-G925"},{label:"Galaxy S7",pattern:"SM-G930"},{label:"Galaxy S7 Edge",pattern:"SM-G935"},"Google TV","Lumia","iPad","iPod","iPhone","Kindle",{label:"Kindle Fire",pattern:"(?:Cloud9|Silk-Accelerated)"},"Nexus","Nook","PlayBook","PlayStation Vita","PlayStation","TouchPad","Transformer",{label:"Wii U",pattern:"WiiU"},"Wii","Xbox One",{label:"Xbox 360",pattern:"Xbox"},"Xoom"]),A=v({Apple:{iPad:1,iPhone:1,iPod:1},Archos:{},Amazon:{Kindle:1,"Kindle Fire":1},Asus:{Transformer:1},"Barnes & Noble":{Nook:1},BlackBerry:{PlayBook:1},Google:{"Google TV":1,Nexus:1},HP:{TouchPad:1},HTC:{},LG:{},Microsoft:{Xbox:1,"Xbox One":1},Motorola:{Xoom:1},Nintendo:{"Wii U":1,Wii:1},Nokia:{Lumia:1},Samsung:{"Galaxy S":1,"Galaxy S2":1,"Galaxy S3":1,"Galaxy S4":1},Sony:{PlayStation:1,"PlayStation Vita":1}},(function(e,n,r){return e||(n[q]||n[/^[a-z]+(?: +[a-z]+\b)*/i.exec(q)]||RegExp("\\b"+y(r)+"(?:\\b|\\w*\\d)","i").exec(t))&&r})),F=v(["Windows Phone","Android","CentOS",{label:"Chrome OS",pattern:"CrOS"},"Debian","Fedora","FreeBSD","Gentoo","Haiku","Kubuntu","Linux Mint","OpenBSD","Red Hat","SuSE","Ubuntu","Xubuntu","Cygwin","Symbian OS","hpwOS","webOS ","webOS","Tablet OS","Tizen","Linux","Mac OS X","Macintosh","Mac","Windows 98;","Windows "],(function(e,n){var r=n.pattern||y(n);return!e&&(e=RegExp("\\b"+r+"(?:/[\\d.]+|[ \\w.]*)","i").exec(t))&&(e=function(e,t,n){var r={"10.0":"10",6.4:"10 Technical Preview",6.3:"8.1",6.2:"8",6.1:"Server 2008 R2 / 7","6.0":"Server 2008 / Vista",5.2:"Server 2003 / XP 64-bit",5.1:"XP",5.01:"2000 SP1","5.0":"2000","4.0":"NT","4.90":"ME"};return t&&n&&/^Win/i.test(e)&&!/^Windows Phone /i.test(e)&&(r=r[/[\d.]+$/.exec(e)])&&(e="Windows "+r),e=String(e),t&&n&&(e=e.replace(RegExp(t,"i"),n)),f(e.replace(/ ce$/i," CE").replace(/\bhpw/i,"web").replace(/\bMacintosh\b/,"Mac OS").replace(/_PowerPC\b/i," OS").replace(/\b(OS X) [^ \d]+/i,"$1").replace(/\bMac (OS X)\b/,"$1").replace(/\/(\d)/," $1").replace(/_/g,".").replace(/(?: BePC|[ .]*fc[ \d.]+)$/i,"").replace(/\bx86\.64\b/gi,"x86_64").replace(/\b(Windows Phone) OS\b/,"$1").replace(/\b(Chrome OS \w+) [\d.]+\b/,"$1").split(" on ")[0])}(e,r,n.label||n)),e}));function B(e){return v(e,(function(e,n){var r=n.pattern||y(n);return!e&&(e=RegExp("\\b"+r+" *\\d+[.\\w_]*","i").exec(t)||RegExp("\\b"+r+" *\\w+-[\\w]*","i").exec(t)||RegExp("\\b"+r+"(?:; *(?:[a-z]+[_-])?[a-z]+\\d+|[^ ();-]*)","i").exec(t))&&((e=String(n.label&&!RegExp(r,"i").test(n.label)?n.label:e).split("/"))[1]&&!/[\d.]+/.test(e[0])&&(e[0]+=" "+e[1]),n=n.label||n,e=f(e[0].replace(RegExp(r,"i"),n).replace(RegExp("; *(?:"+n+"[_-])?","i")," ").replace(RegExp("("+n+")[-_.]?(\\w)","i"),"$1 $2"))),e}))}if(L&&(L=[L]),A&&!q&&(q=B([A])),(o=/\bGoogle TV\b/.exec(q))&&(q=o[0]),/\bSimulator\b/i.test(t)&&(q=(q?q+" ":"")+"Simulator"),"Opera Mini"==D&&/\bOPiOS\b/.test(t)&&R.push("running in Turbo/Uncompressed mode"),"IE"==D&&/\blike iPhone OS\b/.test(t)?(A=(o=e(t.replace(/like iPhone OS/,""))).manufacturer,q=o.product):/^iP/.test(q)?(D||(D="Safari"),F="iOS"+((o=/ OS ([\d_]+)/i.exec(t))?" "+o[1].replace(/_/g,"."):"")):"Konqueror"!=D||/buntu/i.test(F)?A&&"Google"!=A&&(/Chrome/.test(D)&&!/\bMobile Safari\b/i.test(t)||/\bVita\b/.test(q))||/\bAndroid\b/.test(F)&&/^Chrome/.test(D)&&/\bVersion\//i.test(t)?(D="Android Browser",F=/\bAndroid\b/.test(F)?F:"Android"):"Silk"==D?(/\bMobi/i.test(t)||(F="Android",R.unshift("desktop mode")),/Accelerated *= *true/i.test(t)&&R.unshift("accelerated")):"PaleMoon"==D&&(o=/\bFirefox\/([\d.]+)\b/.exec(t))?R.push("identifying as Firefox "+o[1]):"Firefox"==D&&(o=/\b(Mobile|Tablet|TV)\b/i.exec(t))?(F||(F="Firefox OS"),q||(q=o[1])):!D||(o=!/\bMinefield\b/i.test(t)&&/\b(?:Firefox|Safari)\b/.exec(D))?(D&&!q&&/[\/,]|^[^(]+?\)/.test(t.slice(t.indexOf(o+"/")+8))&&(D=null),(o=q||A||F)&&(q||A||/\b(?:Android|Symbian OS|Tablet OS|webOS)\b/.test(F))&&(D=/[a-z]+(?: Hat)?/i.exec(/\bAndroid\b/.test(F)?F:o)+" Browser")):"Electron"==D&&(o=(/\bChrome\/([\d.]+)\b/.exec(t)||0)[1])&&R.push("Chromium "+o):F="Kubuntu",U||(U=v(["(?:Cloud9|CriOS|CrMo|Edge|FxiOS|IEMobile|Iron|Opera ?Mini|OPiOS|OPR|Raven|SamsungBrowser|Silk(?!/[\\d.]+$))","Version",y(D),"(?:Firefox|Minefield|NetFront)"],(function(e,n){return e||(RegExp(n+"(?:-[\\d.]+/|(?: for [\\w-]+)?[ /-])([\\d.]+[^ ();/_-]*)","i").exec(t)||0)[1]||null}))),(o=("iCab"==L&&parseFloat(U)>3?"WebKit":/\bOpera\b/.test(D)&&(/\bOPR\b/.test(t)?"Blink":"Presto"))||/\b(?:Midori|Nook|Safari)\b/i.test(t)&&!/^(?:Trident|EdgeHTML)$/.test(L)&&"WebKit"||!L&&/\bMSIE\b/i.test(t)&&("Mac OS"==F?"Tasman":"Trident")||"WebKit"==L&&/\bPlayStation\b(?! Vita\b)/i.test(D)&&"NetFront")&&(L=[o]),"IE"==D&&(o=(/; *(?:XBLWP|ZuneWP)(\d+)/i.exec(t)||0)[1])?(D+=" Mobile",F="Windows Phone "+(/\+$/.test(o)?o:o+".x"),R.unshift("desktop mode")):/\bWPDesktop\b/i.test(t)?(D="IE Mobile",F="Windows Phone 8.x",R.unshift("desktop mode"),U||(U=(/\brv:([\d.]+)/.exec(t)||0)[1])):"IE"!=D&&"Trident"==L&&(o=/\brv:([\d.]+)/.exec(t))&&(D&&R.push("identifying as "+D+(U?" "+U:"")),D="IE",U=o[1]),j){if(/^(?:boolean|number|string|undefined)$/.test(h=null!=(l=n)?typeof l.global:"number")||"object"==h&&!l.global)m(o=n.runtime)==w?(D="Adobe AIR",F=o.flash.system.Capabilities.os):m(o=n.phantom)==x?(D="PhantomJS",U=(o=o.version||null)&&o.major+"."+o.minor+"."+o.patch):"number"==typeof T.documentMode&&(o=/\bTrident\/(\d+)/i.exec(t))?((o=+o[1]+4)!=(U=[U,T.documentMode])[1]&&(R.push("IE "+U[1]+" mode"),L&&(L[1]=""),U[1]=o),U="IE"==D?String(U[1].toFixed(1)):U[0]):"number"==typeof T.documentMode&&/^(?:Chrome|Firefox)\b/.test(D)&&(R.push("masking as "+D+" "+U),D="IE",U="11.0",L=["Trident"],F="Windows");else if(S&&(O=(o=S.lang.System).getProperty("os.arch"),F=F||o.getProperty("os.name")+" "+o.getProperty("os.version")),C){try{U=n.require("ringo/engine").version.join("."),D="RingoJS"}catch(z){(o=n.system)&&o.global.system==n.system&&(D="Narwhal",F||(F=o[0].os||null))}D||(D="Rhino")}else"object"==typeof n.process&&!n.process.browser&&(o=n.process)&&("object"==typeof o.versions&&("string"==typeof o.versions.electron?(R.push("Node "+o.versions.node),D="Electron",U=o.versions.electron):"string"==typeof o.versions.nw&&(R.push("Chromium "+U,"Node "+o.versions.node),D="NW.js",U=o.versions.nw)),D||(D="Node.js",O=o.arch,F=o.platform,U=(U=/[\d.]+/.exec(o.version))?U[0]:null));F=F&&f(F)}if(U&&(o=/(?:[ab]|dp|pre|[ab]\d+pre)(?:\d+\+?)?$/i.exec(U)||/(?:alpha|beta)(?: ?\d)?/i.exec(t+";"+(j&&i.appMinorVersion))||/\bMinefield\b/i.test(t)&&"a")&&(N=/b/i.test(o)?"beta":"alpha",U=U.replace(RegExp(o+"\\+?$"),"")+("beta"==N?E:M)+(/\d+\+?/.exec(o)||"")),"Fennec"==D||"Firefox"==D&&/\b(?:Android|Firefox OS)\b/.test(F))D="Firefox Mobile";else if("Maxthon"==D&&U)U=U.replace(/\.[\d.]+/,".x");else if(/\bXbox\b/i.test(q))"Xbox 360"==q&&(F=null),"Xbox 360"==q&&/\bIEMobile\b/.test(t)&&R.unshift("mobile mode");else if(!/^(?:Chrome|IE|Opera)$/.test(D)&&(!D||q||/Browser|Mobi/.test(D))||"Windows CE"!=F&&!/Mobi/i.test(t))if("IE"==D&&j)try{null===n.external&&R.unshift("platform preview")}catch(z){R.unshift("embedded")}else(/\bBlackBerry\b/.test(q)||/\bBB10\b/.test(t))&&(o=(RegExp(q.replace(/ +/g," *")+"/([.\\d]+)","i").exec(t)||0)[1]||U)?(F=((o=[o,/BB10/.test(t)])[1]?(q=null,A="BlackBerry"):"Device Software")+" "+o[0],U=null):this!=p&&"Wii"!=q&&(j&&I||/Opera/.test(D)&&/\b(?:MSIE|Firefox)\b/i.test(t)||"Firefox"==D&&/\bOS X (?:\d+\.){2,}/.test(F)||"IE"==D&&(F&&!/^Win/.test(F)&&U>5.5||/\bWindows XP\b/.test(F)&&U>8||8==U&&!/\bTrident\b/.test(t)))&&!u.test(o=e.call(p,t.replace(u,"")+";"))&&o.name&&(o="ing as "+o.name+((o=o.version)?" "+o:""),u.test(D)?(/\bIE\b/.test(o)&&"Mac OS"==F&&(F=null),o="identify"+o):(o="mask"+o,D=P?f(P.replace(/([a-z])([A-Z])/g,"$1 $2")):"Opera",/\bIE\b/.test(o)&&(F=null),j||(U=null)),L=["Presto"],R.push(o));else D+=" Mobile";(o=(/\bAppleWebKit\/([\d.]+\+?)/i.exec(t)||0)[1])&&(o=[parseFloat(o.replace(/\.(\d)$/,".0$1")),o],"Safari"==D&&"+"==o[1].slice(-1)?(D="WebKit Nightly",N="alpha",U=o[1].slice(0,-1)):U!=o[1]&&U!=(o[2]=(/\bSafari\/([\d.]+\+?)/i.exec(t)||0)[1])||(U=null),o[1]=(/\bChrome\/([\d.]+)/i.exec(t)||0)[1],537.36==o[0]&&537.36==o[2]&&parseFloat(o[1])>=28&&"WebKit"==L&&(L=["Blink"]),j&&(b||o[1])?(L&&(L[1]="like Chrome"),o=o[1]||((o=o[0])<530?1:o<532?2:o<532.05?3:o<533?4:o<534.03?5:o<534.07?6:o<534.1?7:o<534.13?8:o<534.16?9:o<534.24?10:o<534.3?11:o<535.01?12:o<535.02?"13+":o<535.07?15:o<535.11?16:o<535.19?17:o<536.05?18:o<536.1?19:o<537.01?20:o<537.11?"21+":o<537.13?23:o<537.18?24:o<537.24?25:o<537.36?26:"Blink"!=L?"27":"28")):(L&&(L[1]="like Safari"),o=(o=o[0])<400?1:o<500?2:o<526?3:o<533?4:o<534?"4+":o<535?5:o<537?6:o<538?7:o<601?8:"8"),L&&(L[1]+=" "+(o+="number"==typeof o?".x":/[.+]/.test(o)?"":"+")),"Safari"==D&&(!U||parseInt(U)>45)&&(U=o)),"Opera"==D&&(o=/\bzbov|zvav$/.exec(F))?(D+=" ",R.unshift("desktop mode"),"zvav"==o?(D+="Mini",U=null):D+="Mobile",F=F.replace(RegExp(" *"+o+"$"),"")):"Safari"==D&&/\bChrome\b/.exec(L&&L[1])&&(R.unshift("desktop mode"),D="Chrome Mobile",U=null,/\bOS X\b/.test(F)?(A="Apple",F="iOS 4.3+"):F=null),U&&0==U.indexOf(o=/[\d.]+$/.exec(F))&&t.indexOf("/"+o+"-")>-1&&(F=g(F.replace(o,""))),L&&!/\b(?:Avant|Nook)\b/.test(D)&&(/Browser|Lunascape|Maxthon/.test(D)||"Safari"!=D&&/^iOS/.test(F)&&/\bSafari\b/.test(L[1])||/^(?:Adobe|Arora|Breach|Midori|Opera|Phantom|Rekonq|Rock|Samsung Internet|Sleipnir|Web)/.test(D)&&L[1])&&(o=L[L.length-1])&&R.push(o),R.length&&(R=["("+R.join("; ")+")"]),A&&q&&q.indexOf(A)<0&&R.push("on "+A),q&&R.push((/^on /.test(R[R.length-1])?"":"on ")+q),F&&(o=/ ([\d.+]+)$/.exec(F),c=o&&"/"==F.charAt(F.length-o[0].length-1),F={architecture:32,family:o&&!c?F.replace(o[0],""):F,version:o?o[1]:null,toString:function(){var e=this.version;return this.family+(e&&!c?" "+e:"")+(64==this.architecture?" 64-bit":"")}}),(o=/\b(?:AMD|IA|Win|WOW|x86_|x)64\b/i.exec(O))&&!/\bi686\b/i.test(O)?(F&&(F.architecture=64,F.family=F.family.replace(RegExp(" *"+o),"")),D&&(/\bWOW64\b/i.test(t)||j&&/\w(?:86|32)$/.test(i.cpuClass||i.platform)&&!/\bWin64; x64\b/i.test(t))&&R.unshift("32-bit")):F&&/^OS X/.test(F.family)&&"Chrome"==D&&parseFloat(U)>=39&&(F.architecture=64),t||(t=null);var W={};return W.description=t,W.layout=L&&L[0],W.manufacturer=A,W.name=D,W.prerelease=N,W.product=q,W.ua=t,W.version=D&&U,W.os=F||{architecture:null,family:null,version:null,toString:function(){return"null"}},W.parse=e,W.toString=function(){return this.description||""},W.version&&R.unshift(U),W.name&&R.unshift(D),F&&D&&(F!=String(F).split(" ")[0]||F!=D.split(" ")[0]&&!q)&&R.push(q?"("+F+")":"on "+F),R.length&&(W.description=R.join(" ")),W}();s.platform=b,void 0===(r=(function(){return b}).call(t,n,t,e))||(e.exports=r)}).call(this)}).call(this,n("aYSr")(e))},CmYO:function(e,t,n){var r,i,s,a=n("dWRk"),o=n("IAQa"),u=n("wHU4"),c=n("1bLK"),l=n("hR4s"),d=l.process,h=l.setImmediate,f=l.clearImmediate,p=l.MessageChannel,m=l.Dispatch,y=0,v={},g=function(){var e=+this;if(v.hasOwnProperty(e)){var t=v[e];delete v[e],t()}},b=function(e){g.call(e.data)};h&&f||(h=function(e){for(var t=[],n=1;arguments.length>n;)t.push(arguments[n++]);return v[++y]=function(){o("function"==typeof e?e:Function(e),t)},r(y),y},f=function(e){delete v[e]},"process"==n("e7fL")(d)?r=function(e){d.nextTick(a(g,e,1))}:m&&m.now?r=function(e){m.now(a(g,e,1))}:p?(s=(i=new p).port2,i.port1.onmessage=b,r=a(s.postMessage,s,1)):l.addEventListener&&"function"==typeof postMessage&&!l.importScripts?(r=function(e){l.postMessage(e+"","*")},l.addEventListener("message",b,!1)):r="onreadystatechange"in c("script")?function(e){u.appendChild(c("script")).onreadystatechange=function(){u.removeChild(this),g.call(e)}}:function(e){setTimeout(a(g,e,1),0)}),e.exports={set:h,clear:f}},CrJZ:function(e,t,n){"use strict";var r=n("hR4s"),i=n("YVtA"),s=n("ObEa"),a=n("IFjL"),o=n("Eolq"),u=n("aRFn").KEY,c=n("7S/a"),l=n("kz3d"),d=n("KnMe"),h=n("b1KM"),f=n("eD9m"),p=n("dWcX"),m=n("9YHp"),y=n("Hjik"),v=n("gNE/"),g=n("8fQz"),b=n("vbc5"),w=n("MrWc"),_=n("Hs7Z"),k=n("Kc1g"),x=n("jHgz"),S=n("yew7"),C=n("QdMa"),M=n("VeTy"),E=n("dptC"),T=n("UwCj"),I=n("ApsS"),P=M.f,O=T.f,R=C.f,N=r.Symbol,j=r.JSON,U=j&&j.stringify,L=f("_hidden"),D=f("toPrimitive"),q={}.propertyIsEnumerable,A=l("symbol-registry"),F=l("symbols"),B=l("op-symbols"),W=Object.prototype,z="function"==typeof N&&!!E.f,H=r.QObject,Q=!H||!H.prototype||!H.prototype.findChild,X=s&&c((function(){return 7!=S(O({},"a",{get:function(){return O(this,"a",{value:7}).a}})).a}))?function(e,t,n){var r=P(W,t);r&&delete W[t],O(e,t,n),r&&e!==W&&O(W,t,r)}:O,J=function(e){var t=F[e]=S(N.prototype);return t._k=e,t},K=z&&"symbol"==typeof N.iterator?function(e){return"symbol"==typeof e}:function(e){return e instanceof N},V=function(e,t,n){return e===W&&V(B,t,n),g(e),t=k(t,!0),g(n),i(F,t)?(n.enumerable?(i(e,L)&&e[L][t]&&(e[L][t]=!1),n=S(n,{enumerable:x(0,!1)})):(i(e,L)||O(e,L,x(1,{})),e[L][t]=!0),X(e,t,n)):O(e,t,n)},$=function(e,t){g(e);for(var n,r=y(t=_(t)),i=0,s=r.length;s>i;)V(e,n=r[i++],t[n]);return e},G=function(e){var t=q.call(this,e=k(e,!0));return!(this===W&&i(F,e)&&!i(B,e))&&(!(t||!i(this,e)||!i(F,e)||i(this,L)&&this[L][e])||t)},Y=function(e,t){if(e=_(e),t=k(t,!0),e!==W||!i(F,t)||i(B,t)){var n=P(e,t);return!n||!i(F,t)||i(e,L)&&e[L][t]||(n.enumerable=!0),n}},Z=function(e){for(var t,n=R(_(e)),r=[],s=0;n.length>s;)i(F,t=n[s++])||t==L||t==u||r.push(t);return r},ee=function(e){for(var t,n=e===W,r=R(n?B:_(e)),s=[],a=0;r.length>a;)!i(F,t=r[a++])||n&&!i(W,t)||s.push(F[t]);return s};z||(o((N=function(){if(this instanceof N)throw TypeError("Symbol is not a constructor!");var e=h(arguments.length>0?arguments[0]:void 0),t=function(n){this===W&&t.call(B,n),i(this,L)&&i(this[L],e)&&(this[L][e]=!1),X(this,e,x(1,n))};return s&&Q&&X(W,e,{configurable:!0,set:t}),J(e)}).prototype,"toString",(function(){return this._k})),M.f=Y,T.f=V,n("z7HR").f=C.f=Z,n("DIWJ").f=G,E.f=ee,s&&!n("UtsQ")&&o(W,"propertyIsEnumerable",G,!0),p.f=function(e){return J(f(e))}),a(a.G+a.W+a.F*!z,{Symbol:N});for(var te="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),ne=0;te.length>ne;)f(te[ne++]);for(var re=I(f.store),ie=0;re.length>ie;)m(re[ie++]);a(a.S+a.F*!z,"Symbol",{for:function(e){return i(A,e+="")?A[e]:A[e]=N(e)},keyFor:function(e){if(!K(e))throw TypeError(e+" is not a symbol!");for(var t in A)if(A[t]===e)return t},useSetter:function(){Q=!0},useSimple:function(){Q=!1}}),a(a.S+a.F*!z,"Object",{create:function(e,t){return void 0===t?S(e):$(S(e),t)},defineProperty:V,defineProperties:$,getOwnPropertyDescriptor:Y,getOwnPropertyNames:Z,getOwnPropertySymbols:ee});var se=c((function(){E.f(1)}));a(a.S+a.F*se,"Object",{getOwnPropertySymbols:function(e){return E.f(w(e))}}),j&&a(a.S+a.F*(!z||c((function(){var e=N();return"[null]"!=U([e])||"{}"!=U({a:e})||"{}"!=U(Object(e))}))),"JSON",{stringify:function(e){for(var t,n,r=[e],i=1;arguments.length>i;)r.push(arguments[i++]);if(n=t=r[1],(b(t)||void 0!==e)&&!K(e))return v(t)||(t=function(e,t){if("function"==typeof n&&(t=n.call(this,e,t)),!K(t))return t}),r[1]=t,U.apply(j,r)}}),N.prototype[D]||n("b95h")(N.prototype,D,N.prototype.valueOf),d(N,"Symbol"),d(Math,"Math",!0),d(r.JSON,"JSON",!0)},DIWJ:function(e,t){t.f={}.propertyIsEnumerable},E9sr:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n("m+l7"),i=Object.prototype.hasOwnProperty;function s(e,t){var n={};for(var r in e)i.call(e,r)&&void 0!==e[r]&&(n[r]=1);for(var s in t)i.call(t,s)&&void 0!==t[s]&&delete n[s];return Object.keys(n)}function a(e){for(var t=e.length,n={},r=0;r<t;r++){var s=e[r];for(var a in s)i.call(s,a)&&void 0!==s[a]&&(n[a]=(n[a]||0)+1)}for(var a in n)n[a]<t&&delete n[a];return Object.keys(n)}function o(e,t){return{operations:e.operations.concat(t),cost:e.cost+1}}function u(e,t,n,i){void 0===i&&(i=d);var s={"0,0":{operations:[],cost:0}},a=isNaN(e.length)||e.length<=0?0:e.length,u=isNaN(t.length)||t.length<=0?0:t.length;return function n(i,a){var u=i+","+a,c=s[u];if(void 0===c){if(i>0&&a>0&&r.compare(e[i-1],t[a-1]))c=n(i-1,a-1);else{var l=[];if(i>0){var d=n(i-1,a);l.push(o(d,{op:"remove",index:i-1}))}if(a>0){var h=n(i,a-1);l.push(o(h,{op:"add",index:i-1,value:t[a-1]}))}if(i>0&&a>0){var f=n(i-1,a-1);l.push(o(f,{op:"replace",index:i-1,original:e[i-1],value:t[a-1]}))}c=l.sort((function(e,t){return e.cost-t.cost}))[0]}s[u]=c}return c}(a,u).operations.reduce((function(e,t){var r=e[0],s=e[1];if(function(e){return"add"===e.op}(t)){var o=t.index+1+s,u=o<a+s?String(o):"-",c={op:t.op,path:n.add(u).toString(),value:t.value};return[r.concat(c),s+1]}if(function(e){return"remove"===e.op}(t))return c={op:t.op,path:n.add(String(t.index+s)).toString()},[r.concat(c),s-1];var l=n.add(String(t.index+s)),d=i(t.original,t.value,l);return[r.concat.apply(r,d),s]}),[[],0])[0]}function c(e,t,n,r){void 0===r&&(r=d);var i=[];return s(e,t).forEach((function(e){i.push({op:"remove",path:n.add(e).toString()})})),s(t,e).forEach((function(e){i.push({op:"add",path:n.add(e).toString(),value:t[e]})})),a([e,t]).forEach((function(s){i.push.apply(i,r(e[s],t[s],n.add(s)))})),i}function l(e,t,n){return r.compare(e,t)?[]:[{op:"replace",path:n.toString(),value:t}]}function d(e,t,n,i){void 0===i&&(i=d);var s=r.objectType(e),a=r.objectType(t);return"array"==s&&"array"==a?u(e,t,n,i):"object"==s&&"object"==a?c(e,t,n,i):l(e,t,n)}t.isDestructive=function(e){var t=e.op;return"remove"===t||"replace"===t||"copy"===t||"move"===t},t.subtract=s,t.intersection=a,t.diffArrays=u,t.diffObjects=c,t.diffValues=l,t.diffAny=d},EWHn:function(e,t,n){var r=n("eD9m")("iterator"),i=!1;try{var s=[7][r]();s.return=function(){i=!0},Array.from(s,(function(){throw 2}))}catch(a){}e.exports=function(e,t){if(!t&&!i)return!1;var n=!1;try{var s=[7],o=s[r]();o.next=function(){return{done:n=!0}},s[r]=function(){return o},e(s)}catch(a){}return n}},EfDG:function(e,t,n){"use strict";var r=n("zCrM"),i=n("S5Zg");e.exports=n("HKkr")("Map",(function(e){return function(){return e(this,arguments.length>0?arguments[0]:void 0)}}),{get:function(e){var t=r.getEntry(i(this,"Map"),e);return t&&t.v},set:function(e,t){return r.def(i(this,"Map"),0===e?0:e,t)}},r,!0)},Eolq:function(e,t,n){e.exports=n("b95h")},Eqmn:function(e,t,n){var r=n("vbc5"),i=n("8fQz"),s=function(e,t){if(i(e),!r(t)&&null!==t)throw TypeError(t+": can't set as prototype!")};e.exports={set:Object.setPrototypeOf||("__proto__"in{}?function(e,t,r){try{(r=n("dWRk")(Function.call,n("VeTy").f(Object.prototype,"__proto__").set,2))(e,[]),t=!(e instanceof Array)}catch(i){t=!0}return function(e,n){return s(e,n),t?e.__proto__=n:r(e,n),e}}({},!1):void 0),check:s}},EtEV:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n("r2q8"),i=n("5ZaL");class s{constructor(e="",t="",n=new Set){this.token=e,this.notificationId=t,this.messageTypes=n}clone(){return new s(this.token,this.notificationId,new Set(this.messageTypes))}}t.RegistrationState=s,t.Connector=class extends r.EventEmitter{constructor(e){super(),this.config=e,this.desiredState=new s,this.currentState=new s,this.hasActiveAttempt=!1}async subscribe(e){this.desiredState.messageTypes.has(e)?i.log.debug("message type already registered ",e):(this.desiredState.messageTypes.add(e),await this.persistRegistration())}async unsubscribe(e){this.desiredState.messageTypes.has(e)&&(this.desiredState.messageTypes.delete(e),await this.persistRegistration())}updateToken(e){this.desiredState.token=e,this.persistRegistration()}async persistRegistration(){if(!this.config.token||0===this.config.token.length)return void i.log.trace("Can't persist registration: token is not set");if(this.hasActiveAttempt)return void i.log.trace("One registration attempt is already in progress");let[e,t]=function(e,t){let n=new Set;return e.notificationId!==t.notificationId&&n.add("notificationId"),e.token!==t.token&&n.add("token"),function(e,t){return[...[...e].filter(e=>!t.has(e)),...[...t].filter(t=>!e.has(t))]}(e.messageTypes,t.messageTypes).length>0&&n.add("messageType"),[n.size>0,n]}(this.desiredState,this.currentState);if(e){this.currentState.notificationId||t.delete("notificationId"),i.log.trace("Persisting registration",t,this.desiredState);try{this.hasActiveAttempt=!0;let e=this.desiredState.clone();if(e.messageTypes.size>0){let n=await this.updateRegistration(e,t);this.currentState.token=n.token,this.currentState.notificationId=n.notificationId,this.currentState.messageTypes=n.messageTypes,this.emit("stateChanged","registered")}else await this.removeRegistration(),this.currentState.token=e.token,this.currentState.notificationId=e.notificationId,this.currentState.messageTypes.clear(),this.emit("stateChanged","unregistered")}finally{this.hasActiveAttempt=!1,setTimeout(()=>this.persistRegistration(),0)}}}setNotificationId(e){this.desiredState.notificationId=e,this.persistRegistration()}}},"F//K":function(e,t,n){n("dUHx"),n("/r3m"),n("Fk9O"),n("EfDG"),n("AwPv"),n("SZul"),n("Lwwr"),e.exports=n("rFq9").Map},F8DB:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n("tqb5");t.TwilsockClient=r.TwilsockClient,t.Twilsock=r.TwilsockClient;const i=n("SbVi");t.TwilsockError=i.TwilsockError;const s=n("c/HT");t.TransportUnavailableError=s.TransportUnavailableError},FSt9:function(e,t,n){"use strict";var r=s(n("aq5/")),i=s(n("4Mt5"));function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(t){(0,r.default)(this,e);var n=(t=t||{}).Chat||t.IPMessaging||t||{};this.region=n.region||t.region,this.baseUrl=n.apiUri||n.typingUri||(this.region&&"us1"!==this.region?"https://aim."+this.region+".twilio.com":"https://aim.twilio.com"),this.typingIndicatorUri=this.baseUrl+"/v1/typing",this.typingIndicatorTimeoutOverride=n.typingIndicatorTimeoutOverride,this.httpCacheIntervalOverride=n.httpCacheIntervalOverride,this.consumptionReportIntervalOverride=n.consumptionReportIntervalOverride,this.userInfosToSubscribeOverride=n.userInfosToSubscribeOverride,this.retryWhenThrottledOverride=n.retryWhenThrottledOverride,this.backoffConfigOverride=n.backoffConfigOverride}return(0,i.default)(e,[{key:"typingIndicatorTimeoutDefault",get:function(){return 5e3}},{key:"httpCacheIntervalDefault",get:function(){return"PT5S"}},{key:"consumptionReportIntervalDefault",get:function(){return"PT5S"}},{key:"userInfosToSubscribeDefault",get:function(){return 100}},{key:"retryWhenThrottledDefault",get:function(){return!0}},{key:"backoffConfigDefault",get:function(){return{min:1e3,max:4e3,maxAttemptsCount:3}}}]),e}();t.Configuration=a},Ff16:function(e,t,n){n("zjhQ")("Set")},Fk9O:function(e,t,n){n("j/aJ");for(var r=n("hR4s"),i=n("b95h"),s=n("tReM"),a=n("eD9m")("toStringTag"),o="CSSRuleList,CSSStyleDeclaration,CSSValueList,ClientRectList,DOMRectList,DOMStringList,DOMTokenList,DataTransferItemList,FileList,HTMLAllCollection,HTMLCollection,HTMLFormElement,HTMLSelectElement,MediaList,MimeTypeArray,NamedNodeMap,NodeList,PaintRequestList,Plugin,PluginArray,SVGLengthList,SVGNumberList,SVGPathSegList,SVGPointList,SVGStringList,SVGTransformList,SourceBufferList,StyleSheetList,TextTrackCueList,TextTrackList,TouchList".split(","),u=0;u<o.length;u++){var c=o[u],l=r[c],d=l&&l.prototype;d&&!d[a]&&i(d,a,c),s[c]=s.Array}},FukD:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n("70ul");t.Init=r.Init;const i=n("vsn+");t.InitReply=i.InitReply;const s=n("kcEc");t.Update=s.Update;const a=n("hsRX");t.Message=a.Message;const o=n("ViZE");t.Reply=o.Reply;const u=n("pagH");t.Close=u.Close},"G+rG":function(e,t,n){var r=function(){return this}()||Function("return this")(),i=r.regeneratorRuntime&&Object.getOwnPropertyNames(r).indexOf("regeneratorRuntime")>=0,s=i&&r.regeneratorRuntime;if(r.regeneratorRuntime=void 0,e.exports=n("mFO2"),i)r.regeneratorRuntime=s;else try{delete r.regeneratorRuntime}catch(a){r.regeneratorRuntime=void 0}},G1hA:function(e){e.exports=JSON.parse('{"_from":"twilio-chat","_id":"twilio-chat@3.3.4","_inBundle":false,"_integrity":"sha512-HZ68AWlsqVNjKum4dPHJ3gFkDPmrhzld4rHiQHbOlSPXO05Tyw8z4dwRki7SdTntLpqVL3lZeF7lSXz73pHs3A==","_location":"/twilio-chat","_phantomChildren":{},"_requested":{"type":"tag","registry":true,"raw":"twilio-chat","name":"twilio-chat","escapedName":"twilio-chat","rawSpec":"","saveSpec":null,"fetchSpec":"latest"},"_requiredBy":["#USER","/"],"_resolved":"https://registry.npmjs.org/twilio-chat/-/twilio-chat-3.3.4.tgz","_shasum":"0211c85424b59ebdc8e68ab1000c82e6345b69a4","_spec":"twilio-chat","_where":"D:\\\\Gabrielle2\\\\Development\\\\Web\\\\cooper-pantry\\\\cooper","author":{"name":"Twilio"},"browser":"browser/index.js","browserslist":["IE 11","last 3 Chrome versions","last 3 Firefox versions","last 3 Safari versions","last 3 Edge versions","last 2 iOS version","last 2 ChromeAndroid version","last 2 FirefoxAndroid version","last 2 Samsung versions","last 2 UCAndroid versions"],"bundleDependencies":false,"dependencies":{"iso8601-duration":"^1.2.0","loglevel":"^1.6.6","operation-retrier":"^3.0.0","platform":"^1.3.5","rfc6902":"^3.0.2","twilio-mcs-client":"^0.3.3","twilio-notifications":"^0.5.8","twilio-sync":"^0.11.5","twilsock":"^0.5.11","uuid":"^3.3.2"},"deprecated":false,"description":"Twilio Chat service client library","devDependencies":{"@types/chai":"^4.2.5","@types/chai-as-promised":"^7.1.2","@types/chai-string":"^1.4.1","@types/core-js":"^2.5.0","@types/mocha":"^5.2.7","@types/node":"^12.12.12","@types/sinon":"^7.5.1","@types/sinon-chai":"^3.2.2","async":"^3.0.1","async-test-tools":"^1.0.7","babel-core":"^6.26.0","babel-plugin-transform-builtin-extend":"^1.1.2","babel-plugin-transform-runtime":"^6.23.0","babel-preset-env":"^1.6.1","babel-runtime":"^6.26.0","babelify":"^8.0.0","backoff":"^2.5.0","browserify":"^16.2.3","browserify-replace":"^1.0.0","browserslist":"^4.7.3","chai":"^4.2.0","chai-as-promised":"^7.1.1","chai-string":"^1.5.0","cheerio":"^1.0.0-rc.2","cross-env":"^5.2.0","del":"^5.1.0","fancy-log":"^1.3.3","fs":"0.0.2","gulp":"^4.0.2","gulp-babel":"^7.0.1","gulp-derequire":"^2.1.0","gulp-if":"^2.0.2","gulp-insert":"^0.5.0","gulp-rename":"^1.4.0","gulp-sourcemaps":"^2.6.5","gulp-tap":"^1.0.1","gulp-tslint":"^8.1.4","gulp-typescript":"^5.0.1","gulp-uglify-es":"^1.0.4","ink-docstrap":"^1.3.2","isomorphic-form-data":"^2.0.0","jsdoc":"~3.5.5","jsdoc-strip-async-await":"^0.1.0","mocha":"^6.2.2","mocha.parallel":"^0.15.6","nyc":"^14.1.1","path":"^0.12.7","sinon":"^7.5.0","sinon-chai":"^3.3.0","source-map-explorer":"^2.1.1","ts-node":"^8.5.2","tslint":"^5.20.1","twilio":"^3.37.1","typescript":"^3.7.2","uglify-save-license":"^0.4.1","vinyl-buffer":"^1.0.1","vinyl-source-stream":"^2.0.0"},"engines":{"node":">=6"},"license":"MIT","main":"lib/index.js","name":"twilio-chat","types":"./lib/client.d.ts","version":"3.3.4"}')},HKkr:function(e,t,n){"use strict";var r=n("hR4s"),i=n("IFjL"),s=n("aRFn"),a=n("7S/a"),o=n("b95h"),u=n("qa3O"),c=n("9v8s"),l=n("s0lH"),d=n("vbc5"),h=n("KnMe"),f=n("UwCj").f,p=n("1yva")(0),m=n("ObEa");e.exports=function(e,t,n,y,v,g){var b=r[e],w=b,_=v?"set":"add",k=w&&w.prototype,x={};return m&&"function"==typeof w&&(g||k.forEach&&!a((function(){(new w).entries().next()})))?(w=t((function(t,n){l(t,w,e,"_c"),t._c=new b,null!=n&&c(n,v,t[_],t)})),p("add,clear,delete,forEach,get,has,set,keys,values,entries,toJSON".split(","),(function(e){var t="add"==e||"set"==e;!(e in k)||g&&"clear"==e||o(w.prototype,e,(function(n,r){if(l(this,w,e),!t&&g&&!d(n))return"get"==e&&void 0;var i=this._c[e](0===n?0:n,r);return t?this:i}))})),g||f(w.prototype,"size",{get:function(){return this._c.size}})):(w=y.getConstructor(t,e,v,_),u(w.prototype,n),s.NEED=!0),h(w,e),x[e]=w,i(i.G+i.W+i.F,x),g||y.setStrong(w,e,v),w}},HWod:function(e,t,n){var r=n("IFjL");r(r.S+r.F*!n("ObEa"),"Object",{defineProperty:n("UwCj").f})},Hjik:function(e,t,n){var r=n("ApsS"),i=n("dptC"),s=n("DIWJ");e.exports=function(e){var t=r(e),n=i.f;if(n)for(var a,o=n(e),u=s.f,c=0;o.length>c;)u.call(e,a=o[c++])&&t.push(a);return t}},HoF5:function(e,t,n){n("dUHx"),n("/r3m"),n("Fk9O"),n("Y+Rv"),n("aSQu"),n("YR+c"),e.exports=n("rFq9").Promise},Hs7Z:function(e,t,n){var r=n("aAA+"),i=n("rU52");e.exports=function(e){return r(i(e))}},IAQa:function(e,t){e.exports=function(e,t,n){var r=void 0===n;switch(t.length){case 0:return r?e():e.call(n);case 1:return r?e(t[0]):e.call(n,t[0]);case 2:return r?e(t[0],t[1]):e.call(n,t[0],t[1]);case 3:return r?e(t[0],t[1],t[2]):e.call(n,t[0],t[1],t[2]);case 4:return r?e(t[0],t[1],t[2],t[3]):e.call(n,t[0],t[1],t[2],t[3])}return e.apply(n,t)}},IFjL:function(e,t,n){var r=n("hR4s"),i=n("rFq9"),s=n("dWRk"),a=n("b95h"),o=n("YVtA"),u=function(e,t,n){var c,l,d,h=e&u.F,f=e&u.G,p=e&u.S,m=e&u.P,y=e&u.B,v=e&u.W,g=f?i:i[t]||(i[t]={}),b=g.prototype,w=f?r:p?r[t]:(r[t]||{}).prototype;for(c in f&&(n=t),n)(l=!h&&w&&void 0!==w[c])&&o(g,c)||(d=l?w[c]:n[c],g[c]=f&&"function"!=typeof w[c]?n[c]:y&&l?s(d,r):v&&w[c]==d?function(e){var t=function(t,n,r){if(this instanceof e){switch(arguments.length){case 0:return new e;case 1:return new e(t);case 2:return new e(t,n)}return new e(t,n,r)}return e.apply(this,arguments)};return t.prototype=e.prototype,t}(d):m&&"function"==typeof d?s(Function.call,d):d,m&&((g.virtual||(g.virtual={}))[c]=d,e&u.R&&b&&!b[c]&&a(b,c,d)))};u.F=1,u.G=2,u.S=4,u.P=8,u.B=16,u.W=32,u.U=64,u.R=128,e.exports=u},IgrD:function(e,t,n){var r=n("IFjL");r(r.S+r.F,"Object",{assign:n("XWhX")})},IhEH:function(e,t,n){"use strict";t.__esModule=!0;var r,i=(r=n("XUND"))&&r.__esModule?r:{default:r};t.default=function(e){return function(){var t=e.apply(this,arguments);return new i.default((function(e,n){return function r(s,a){try{var o=t[s](a),u=o.value}catch(c){return void n(c)}if(!o.done)return i.default.resolve(u).then((function(e){r("next",e)}),(function(e){r("throw",e)}));e(u)}("next")}))}}},IkCb:function(e,t,n){n("CrJZ"),n("dUHx"),n("PkSp"),n("zZTv"),e.exports=n("rFq9").Symbol},Isrn:function(e,t,n){"use strict";var r=o(n("tgXR")),i=o(n("IhEH")),s=o(n("aq5/")),a=o(n("4Mt5"));function o(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var u=n("RtQP"),c=n("ZYEu"),l=n("Xfc8"),d=function(){function e(t,n,r){(0,s.default)(this,e),this.client=t,this.services=n,this.url=r}var t,n,o;return(0,a.default)(e,[{key:"getChannels",value:(o=(0,i.default)(r.default.mark((function e(){var t,n,i=this,s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new u.UriBuilder(this.url).arg("PageToken",s.pageToken).build(),e.next=3,this.services.network.get(t);case 3:return e.abrupt("return",new c.RestPaginator((n=e.sent).body.channels.map((function(e){return new l.ChannelDescriptor(i.client,e)})),(function(e){return i.getChannels({pageToken:e})}),n.body.meta.previous_token,n.body.meta.next_token));case 5:case"end":return e.stop()}}),e,this)}))),function(){return o.apply(this,arguments)})},{key:"getChannelBySid",value:(n=(0,i.default)(r.default.mark((function e(t){var n;return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new u.UriBuilder(this.url).path(t).build(),e.next=3,this.services.network.get(n);case 3:return e.abrupt("return",new l.ChannelDescriptor(this.client,e.sent.body));case 5:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"getChannelByUniqueName",value:(t=(0,i.default)(r.default.mark((function e(t){var n;return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new u.UriBuilder(this.url).path(t).build(),e.next=3,this.services.network.get(n);case 3:return e.abrupt("return",new l.ChannelDescriptor(this.client,e.sent.body));case 5:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),e}();t.PublicChannels=d},J0XI:function(e,t,n){var r=n("YVtA"),i=n("Hs7Z"),s=n("J1Io")(!1),a=n("ubhL")("IE_PROTO");e.exports=function(e,t){var n,o=i(e),u=0,c=[];for(n in o)n!=a&&r(o,n)&&c.push(n);for(;t.length>u;)r(o,n=t[u++])&&(~s(c,n)||c.push(n));return c}},J1Io:function(e,t,n){var r=n("Hs7Z"),i=n("MPuG"),s=n("6UZt");e.exports=function(e){return function(t,n,a){var o,u=r(t),c=i(u.length),l=s(a,c);if(e&&n!=n){for(;c>l;)if((o=u[l++])!=o)return!0}else for(;c>l;l++)if((e||l in u)&&u[l]===n)return e||l||0;return!e&&-1}}},JA1H:function(e,t,n){"use strict";n.r(t),n.d(t,"CustomerModule",(function(){return b}));var r=n("2kYt"),i=n("3KNA"),s=n("sEIs"),a=n("EM62"),o=n("D57K"),u=n("CW98"),c=n("y51I"),l=n("ZTXN"),d=n("SrNW"),h=n("kuMc");let f=(()=>{class e{constructor(e,t){this.httpService=e,this.user=t,this.currentId="4",this.send=new l.a,this.newMsg=new l.a,this.destroyed=new l.a,this.messages=this.newMsg.pipe(Object(d.a)((e,t)=>[...e,t],[]))}connect(){return Object(o.__awaiter)(this,void 0,void 0,(function*(){const e=yield this.user.getById(this.currentId).toPromise(),t=yield this.httpService.getChatToken({identity:this.currentId}).toPromise(),n=yield c.Client.create(t),r=yield n.getSubscribedChannels();for(const s of r.items)s.createdBy===e.id?yield s.delete():yield s.leave();const i=yield n.createChannel();yield i.join(),i.on("messageAdded",t=>{const n=t.author===e.id;this.newMsg.next({text:t.body,date:t.dateUpdated,reply:n,user:{name:n?"You":"Cooper Bot",avatar:n?void 0:"https://s3.amazonaws.com/pix.iemoji.com/images/emoji/apple/ios-12/256/robot-face.png"}})}),this.send.pipe(Object(h.a)(this.destroyed)).subscribe(e=>{i.sendMessage(e)}),this.httpService.addChatBot({channelSid:i.sid}).toPromise()}))}sendMessage(e){this.send.next(e.message)}ngOnDestroy(){this.destroyed.next()}}return e.\u0275fac=function(t){return new(t||e)(a.cc(u.b),a.cc(u.c))},e.\u0275prov=a.Ob({token:e,factory:e.\u0275fac}),e})();var p=n("UnYO");function m(e,t){if(1&e&&a.Tb(0,"nb-chat-message",3),2&e){const e=t.$implicit;a.oc("message",e.text)("reply",e.reply)("sender",e.user.name)("date",e.date)("avatar",e.user.avatar)}}let y=(()=>{class e{constructor(e){this.service=e,this.messages=this.service.messages,this.service.connect()}sendMessage(e){this.service.sendMessage(e)}}return e.\u0275fac=function(t){return new(t||e)(a.Sb(f))},e.\u0275cmp=a.Mb({type:e,selectors:[["cooper-bot-chat"]],features:[a.Db([f])],decls:4,vars:3,consts:[["title","Cooper"],[3,"message","reply","sender","date","avatar",4,"ngFor","ngForOf"],[3,"send"],[3,"message","reply","sender","date","avatar"]],template:function(e,t){1&e&&(a.Yb(0,"nb-chat",0),a.Bc(1,m,1,5,"nb-chat-message",1),a.jc(2,"async"),a.Yb(3,"nb-chat-form",2),a.gc("send",(function(e){return t.sendMessage(e)})),a.Xb(),a.Xb()),2&e&&(a.Eb(1),a.oc("ngForOf",a.kc(2,1,t.messages)))},directives:[p.a,r.l,p.b,p.c],pipes:[r.b],encapsulation:2,changeDetection:0}),e})();const v=[{path:"",redirectTo:"bot",pathMatch:"full"},{path:"bot",component:(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=a.Mb({type:e,selectors:[["cooper-bot"]],decls:1,vars:0,template:function(e,t){1&e&&a.Tb(0,"cooper-bot-chat")},directives:[y],styles:["nb-layout{height:100%!important;width:100%!important}  .layout{min-height:0!important;background-color:inherit!important}  nb-layout-column{padding:0!important}  .columns,   .content,   .layout,   .scrollable-container,   nb-layout-column{height:inherit!important;width:inherit!important}"]}),e})()}];let g=(()=>{class e{}return e.\u0275mod=a.Qb({type:e}),e.\u0275inj=a.Pb({factory:function(t){return new(t||e)},imports:[[s.h.forChild(v)],s.h]}),e})(),b=(()=>{class e{}return e.\u0275mod=a.Qb({type:e}),e.\u0275inj=a.Pb({factory:function(t){return new(t||e)},imports:[[r.c,i.a,g]]}),e})()},JId3:function(e,t,n){var r,i,s=n("gm/K"),a=n("1ppQ"),o=0,u=0;e.exports=function(e,t,n){var c=t&&n||0,l=t||[],d=(e=e||{}).node||r,h=void 0!==e.clockseq?e.clockseq:i;if(null==d||null==h){var f=s();null==d&&(d=r=[1|f[0],f[1],f[2],f[3],f[4],f[5]]),null==h&&(h=i=16383&(f[6]<<8|f[7]))}var p=void 0!==e.msecs?e.msecs:(new Date).getTime(),m=void 0!==e.nsecs?e.nsecs:u+1,y=p-o+(m-u)/1e4;if(y<0&&void 0===e.clockseq&&(h=h+1&16383),(y<0||p>o)&&void 0===e.nsecs&&(m=0),m>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");o=p,u=m,i=h;var v=(1e4*(268435455&(p+=122192928e5))+m)%4294967296;l[c++]=v>>>24&255,l[c++]=v>>>16&255,l[c++]=v>>>8&255,l[c++]=255&v;var g=p/4294967296*1e4&268435455;l[c++]=g>>>8&255,l[c++]=255&g,l[c++]=g>>>24&15|16,l[c++]=g>>>16&255,l[c++]=h>>>8|128,l[c++]=255&h;for(var b=0;b<6;++b)l[c+b]=d[b];return t||a(l)}},Jn7W:function(e,t,n){"use strict";var r=n("hR4s"),i=n("rFq9"),s=n("UwCj"),a=n("ObEa"),o=n("eD9m")("species");e.exports=function(e){var t="function"==typeof i[e]?i[e]:r[e];a&&t&&!t[o]&&s.f(t,o,{configurable:!0,get:function(){return this}})}},Jo0e:function(e,t){var n=Math.ceil,r=Math.floor;e.exports=function(e){return isNaN(e=+e)?0:(e>0?r:n)(e)}},KBpo:function(e,t,n){var r=n("6XaB"),i=n("NkxH");e.exports=function(e,t,n){var s=t&&n||0;"string"==typeof e&&(t="binary"===e?new Array(16):null,e=null);var a=(e=e||{}).random||(e.rng||r)();if(a[6]=15&a[6]|64,a[8]=63&a[8]|128,t)for(var o=0;o<16;++o)t[s+o]=a[o];return t||i(a)}},KIy9:function(e,t,n){var r=n("M25K"),i=n("qiY+");e.exports=function(e){return function(){if(r(this)!=e)throw TypeError(e+"#toJSON isn't generic");return i(this)}}},KQtV:function(e,t){for(var n=[],r=0;r<256;++r)n[r]=(r+256).toString(16).substr(1);e.exports=function(e,t){var r=t||0;return[n[e[r++]],n[e[r++]],n[e[r++]],n[e[r++]],"-",n[e[r++]],n[e[r++]],"-",n[e[r++]],n[e[r++]],"-",n[e[r++]],n[e[r++]],"-",n[e[r++]],n[e[r++]],n[e[r++]],n[e[r++]],n[e[r++]],n[e[r++]]].join("")}},Kc1g:function(e,t,n){var r=n("vbc5");e.exports=function(e,t){if(!r(e))return e;var n,i;if(t&&"function"==typeof(n=e.toString)&&!r(i=n.call(e)))return i;if("function"==typeof(n=e.valueOf)&&!r(i=n.call(e)))return i;if(!t&&"function"==typeof(n=e.toString)&&!r(i=n.call(e)))return i;throw TypeError("Can't convert object to primitive value")}},KnMe:function(e,t,n){var r=n("UwCj").f,i=n("YVtA"),s=n("eD9m")("toStringTag");e.exports=function(e,t,n){e&&!i(e=n?e:e.prototype,s)&&r(e,s,{configurable:!0,value:t})}},L760:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Paginator=class{constructor(e,t,n,r){this.prevToken=n,this.nextToken=r,this.items=e,this.source=t}get hasNextPage(){return!!this.nextToken}get hasPrevPage(){return!!this.prevToken}async nextPage(){if(!this.hasNextPage)throw new Error("No next page");return this.source(this.nextToken)}async prevPage(){if(!this.hasPrevPage)throw new Error("No previous page");return this.source(this.prevToken)}}},LBb3:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n("Sqfg"),i=n("sc67"),s=n("LYxL"),a=n("qXWz"),o=n("F8DB");function u(e){if(e.body&&e.body.message)return e.body.message;switch(e.status){case 429:return"Throttled by server";case 404:return"Not found from server";default:return"Error from server"}}function c(e){return e.body?e.body.code:0}function l(e){return 409===e.status?new i.SyncNetworkError(u(e),e.status,c(e),e.body):e.status?new i.SyncError(u(e),e.status,c(e)):e instanceof o.TransportUnavailableError?e:new i.SyncError(e.message,0,0)}t.NetworkService=class{constructor(e,t,n){this.clientInfo=e,this.config=t,this.transport=n}createHeaders(){return{"Content-Type":"application/json","Twilio-Sync-Client-Info":JSON.stringify(this.clientInfo),"Twilio-Request-Id":"RQ"+r.v4().replace(/-/g,"")}}backoffConfig(){return Object.assign({min:4e3,max:6e4,maxAttemptsTime:9e4,randomness:.2},this.config.backoffConfig)}executeWithRetry(e,t=!0){return new Promise((n,r)=>{let i=[502,503,504];t&&i.push(429);let s=new a.Retrier(this.backoffConfig());s.on("attempt",()=>{e().then(e=>s.succeeded(e)).catch(e=>{if(i.includes(e.status)){let t=parseInt(e.headers?e.headers["Retry-After"]:null);s.failed(l(e),isNaN(t)?null:1e3*t)}else"Twilsock disconnected"===e.message?s.failed(l(e)):(s.removeAllListeners(),s.cancel(),r(l(e)))})}),s.on("succeeded",e=>{n(e)}),s.on("cancelled",e=>r(l(e))),s.on("failed",e=>r(l(e))),s.start()})}get(e){let t=this.createHeaders();return s.default.debug("GET",e,"ID:",t["Twilio-Request-Id"]),this.executeWithRetry(()=>this.transport.get(e,t),!0)}post(e,t,n,r=!1){let i=this.createHeaders();return null!=n&&(i["If-Match"]=n),s.default.debug("POST",e,"ID:",i["Twilio-Request-Id"]),this.executeWithRetry(()=>this.transport.post(e,i,t),r)}put(e,t,n){let r=this.createHeaders();return null!=n&&(r["If-Match"]=n),s.default.debug("PUT",e,"ID:",r["Twilio-Request-Id"]),this.executeWithRetry(()=>this.transport.put(e,r,t),!1)}delete(e){let t=this.createHeaders();return s.default.debug("DELETE",e,"ID:",t["Twilio-Request-Id"]),this.executeWithRetry(()=>this.transport.delete(e,t),!1)}}},LMaB:function(e,t,n){e.exports=!n("ObEa")&&!n("7S/a")((function(){return 7!=Object.defineProperty(n("1bLK")("div"),"a",{get:function(){return 7}}).a}))},LQEr:function(e,t,n){var r=n("IFjL");r(r.S,"Number",{isInteger:n("mrFV")})},LVtF:function(e,t,n){"use strict";var r=d(n("tgXR")),i=d(n("IhEH")),s=d(n("u2rs")),a=d(n("Rhu4")),o=d(n("aq5/")),u=d(n("4Mt5")),c=d(n("7xyS")),l=d(n("k2Qk"));function d(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var h=n("r2q8"),f=n("0tlO"),p=n("MHYR"),m=function(e){function t(e){(0,o.default)(this,t);var n=(0,c.default)(this,(t.__proto__||(0,a.default)(t)).call(this));return n.services=e,n.fifoStack=[],n.fifoStackMaxLength=100,n.myself=new f.User(null,null,n.services),n.myself.on("updated",(function(e){return n.emit("userUpdated",e)})),n.myself.on("userSubscribed",(function(){return n.emit("userSubscribed",n.myself)})),n.myself.on("userUnsubscribed",(function(){n.emit("userUnsubscribed",n.myself),n.myself._ensureFetched()})),n.services=e,n.subscribedUsers=new s.default,n.userDescriptorsPromise=n.services.session.getSessionLinks().then((function(e){return n.userDescriptors=new p.UserDescriptors({users:n,network:n.services.network},e.usersUrl),n.userDescriptors})),n.services.session.getMaxUserInfosToSubscribe().then((function(e){n.fifoStackMaxLength=e})),n.services.session.getUsersData().then((function(e){return n.myself.identity=e.identity,n.myself.entityName=e.user,n.myself._ensureFetched()})),n}var n,d,h,m;return(0,l.default)(t,e),(0,u.default)(t,[{key:"handleUnsubscribeUser",value:function(e){this.subscribedUsers.has(e.identity)&&this.subscribedUsers.delete(e.identity);var t=-1;this.fifoStack.find((function(n,r){return n==e.identity&&(t=r,!0)}))&&this.fifoStack.splice(t,1),this.emit("userUnsubscribed",e)}},{key:"handleSubscribeUser",value:function(e){this.subscribedUsers.has(e.identity)||(this.fifoStack.length>=this.fifoStackMaxLength&&this.subscribedUsers.get(this.fifoStack.shift()).unsubscribe(),this.fifoStack.push(e.identity),this.subscribedUsers.set(e.identity,e),this.emit("userSubscribed",e))}},{key:"getUser",value:(m=(0,i.default)(r.default.mark((function e(t){var n,i=this,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.session.getUsersData();case 2:return e.next=4,this.myself._ensureFetched();case 4:if(t!=this.myself.identity){e.next=6;break}return e.abrupt("return",this.myself);case 6:if(n=this.subscribedUsers.get(t)){e.next=19;break}if(s){e.next=13;break}return e.next=11,this.getUserDescriptor(t);case 11:s=e.sent._getDescriptor().sync_unique_name;case 13:return(n=new f.User(t,s,this.services)).on("updated",(function(e){return i.emit("userUpdated",e)})),n.on("userSubscribed",(function(){return i.handleSubscribeUser(n)})),n.on("userUnsubscribed",(function(){return i.handleUnsubscribeUser(n)})),e.next=19,n._ensureFetched();case 19:return e.abrupt("return",n);case 20:case"end":return e.stop()}}),e,this)}))),function(e){return m.apply(this,arguments)})},{key:"getUserDescriptor",value:(h=(0,i.default)(r.default.mark((function e(t){return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.userDescriptorsPromise;case 2:return e.abrupt("return",this.userDescriptors.getUserDescriptor(t));case 3:case"end":return e.stop()}}),e,this)}))),function(e){return h.apply(this,arguments)})},{key:"getChannelUserDescriptors",value:(d=(0,i.default)(r.default.mark((function e(t){return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.userDescriptorsPromise;case 2:return e.abrupt("return",this.userDescriptors.getChannelUserDescriptors(t));case 3:case"end":return e.stop()}}),e,this)}))),function(e){return d.apply(this,arguments)})},{key:"getSubscribedUsers",value:(n=(0,i.default)(r.default.mark((function e(){var t;return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.session.getUsersData();case 2:return e.next=4,this.myself._ensureFetched();case 4:return t=[this.myself],this.subscribedUsers.forEach((function(e){return t.push(e)})),e.abrupt("return",t);case 7:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})}]),t}(h.EventEmitter);t.Users=m},LYxL:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n("XdyU");function i(e,t){return[`${(new Date).toISOString()} Sync ${e}:`].concat(Array.from(t))}t.default={setLevel:function(e){r.setLevel(e)},trace:function(...e){r.trace.apply(null,i("T",e))},debug:function(...e){r.debug.apply(null,i("D",e))},info:function(...e){r.info.apply(null,i("I",e))},warn:function(...e){r.warn.apply(null,i("W",e))},error:function(...e){r.error.apply(null,i("E",e))}}},Lwwr:function(e,t,n){n("zjhQ")("Map")},M25K:function(e,t,n){var r=n("e7fL"),i=n("eD9m")("toStringTag"),s="Arguments"==r(function(){return arguments}());e.exports=function(e){var t,n,a;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(n=function(e,t){try{return e[t]}catch(n){}}(t=Object(e),i))?n:s?r(t):"Object"==(a=r(t))&&"function"==typeof t.callee?"Arguments":a}},MAsh:function(e,t,n){"use strict";var r=o(n("tgXR")),i=o(n("IhEH")),s=o(n("aq5/")),a=o(n("4Mt5"));function o(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var u=n("RtQP"),c=n("ZYEu"),l=n("XXPQ"),d=function(){function e(t){(0,s.default)(this,e),this.services=t}var t;return(0,a.default)(e,[{key:"getPage",value:(t=(0,i.default)(r.default.mark((function e(t){var n,i,s=this;return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=t||{},e.next=3,this.services.session.getSessionLinks();case 3:return n=new u.UriBuilder(e.sent.syncListUrl).arg("PageToken",t.pageToken).build(),e.next=7,this.services.network.get(n);case 7:return e.abrupt("return",new c.RestPaginator((i=e.sent).body.channels.map((function(e){return new l.SyncListDescriptor(e)})),(function(e){return s.getPage({pageToken:e})}),i.body.meta.previous_token,i.body.meta.next_token));case 9:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),e}();t.SyncList=d},MC8q:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n("r2q8"),i=n("bDMy"),s=n("N8HJ"),a=n("FukD"),o=n("MmGm"),u=n("gSK9"),c=n("yWtm");t.Response=class{};class l extends r.EventEmitter{constructor(e,t,n){super(),this.terminalStates=["disconnected","rejected"],this.lastEmittedState=void 0,this.tokenExpiredSasCode=20104,this.websocket=e,this.websocket.on("connected",()=>this.fsm.socketConnected()),this.websocket.on("disconnected",e=>this.fsm.socketClosed()),this.websocket.on("message",e=>this.onIncomingMessage(e)),this.websocket.on("socketError",e=>this.emit("connectionError",{terminal:!1,message:e.message,httpStatusCode:null,errorCode:null})),this.transport=t,this.config=n,this.retrier=new c.BackoffRetrier(n.retryPolicy),this.retrier.on("attempt",()=>this.retry()),this.retrier.on("failed",e=>{s.log.warn(`Retrying failed: ${e.message}`),this.disconnect()}),"undefined"!=typeof window&&void 0!==window.addEventListener&&(window.addEventListener("online",()=>{s.log.debug("Browser reported connectivity state: online"),this.fsm.systemOnline()}),window.addEventListener("offline",()=>{s.log.debug("Browser reported connectivity state: offline"),this.websocket.close(),this.fsm.socketClosed()})),this.fsm=new i({init:"disconnected",transitions:[{name:"userConnect",from:["disconnected","rejected"],to:"connecting"},{name:"userConnect",from:["connecting","connected"]},{name:"userDisconnect",from:["connecting","initialising","connected","updating","retrying","rejected","waitSocketClosed","waitOffloadSocketClosed"],to:"disconnecting"},{name:"userRetry",from:["retrying"],to:"connecting"},{name:"socketConnected",from:["connecting"],to:"initialising"},{name:"socketClosed",from:["connecting","initialising","connected","updating","error","waitOffloadSocketClosed"],to:"retrying"},{name:"socketClosed",from:["disconnecting"],to:"disconnected"},{name:"socketClosed",from:["waitSocketClosed"],to:"disconnected"},{name:"socketClosed",from:["rejected"],to:"rejected"},{name:"initSuccess",from:["initialising"],to:"connected"},{name:"initError",from:["initialising"],to:"error"},{name:"tokenRejected",from:["initialising","updating"],to:"rejected"},{name:"protocolError",from:["initialising","connected","updating"],to:"error"},{name:"receiveClose",from:["initialising","connected","updating"],to:"waitSocketClosed"},{name:"receiveOffload",from:["initialising","connected","updating"],to:"waitOffloadSocketClosed"},{name:"unsupportedProtocol",from:["initialising","connected","updating"],to:"unsupported"},{name:"receiveFatalClose",from:["initialising","connected","updating"],to:"unsupported"},{name:"userUpdateToken",from:["disconnected","rejected","connecting","retrying"],to:"connecting"},{name:"userUpdateToken",from:["connected"],to:"updating"},{name:"updateSuccess",from:["updating"],to:"connected"},{name:"updateError",from:["updating"],to:"error"},{name:"userSend",from:["connected"],to:"connected"},{name:"systemOnline",from:["retrying"],to:"connecting"}],methods:{onConnecting:()=>{this.setupSocket(),this.emit("connecting")},onEnterInitialising:()=>{this.sendInit()},onLeaveInitialising:()=>{this.cancelInit()},onEnterUpdating:()=>{this.sendUpdate()},onLeaveUpdating:()=>{this.cancelUpdate()},onEnterRetrying:()=>{this.initRetry(),this.emit("connecting")},onEnterConnected:()=>{this.resetBackoff(),this.onConnected()},onUserUpdateToken:()=>{this.resetBackoff()},onTokenRejected:()=>{this.resetBackoff(),this.closeSocket(!0),this.finalizeSocket()},onUserDisconnect:()=>{this.closeSocket(!0)},onEnterDisconnecting:()=>{this.startDisconnectTimer()},onLeaveDisconnecting:()=>{this.cancelDisconnectTimer()},onEnterWaitSocketClosed:()=>{this.startDisconnectTimer()},onLeaveWaitSocketClosed:()=>{this.cancelDisconnectTimer()},onEnterWaitOffloadSocketClosed:()=>{this.startDisconnectTimer()},onLeaveWaitOffloadSocketClosed:()=>{this.cancelDisconnectTimer()},onDisconnected:()=>{this.resetBackoff(),this.finalizeSocket()},onReceiveClose:(e,t)=>{this.onCloseReceived(t)},onReceiveOffload:(e,t)=>{s.log.debug("onreceiveoffload: ",t),this.modifyBackoff(t.body),this.onCloseReceived(t.status)},onUnsupported:()=>{this.closeSocket(!0),this.finalizeSocket()},onError:(e,t)=>{this.closeSocket(t),this.finalizeSocket()},onEnterState:e=>{"none"!==e.from&&this.changeState(e)},onInvalidTransition:(e,t,n)=>{s.log.warn("FSM: unexpected transition",t,n)}}})}changeState(e){s.log.debug(`FSM: ${e.transition}: ${e.from} --\x3e ${e.to}`),this.lastEmittedState!==this.state&&(this.lastEmittedState=this.state,this.emit("stateChanged",this.state))}resetBackoff(){s.log.trace("resetBackoff"),this.retrier.stop()}modifyBackoff(e){s.log.trace("modifyBackoff",e);let t=e?e.backoff_policy:null;t&&"number"==typeof t.reconnect_min_ms&&this.retrier.modifyBackoff(t.reconnect_min_ms)}startDisconnectTimer(){s.log.trace("startDisconnectTimer"),this.disconnectingTimer&&(clearTimeout(this.disconnectingTimer),this.disconnectingTimer=null),this.disconnectingTimer=setTimeout(()=>{s.log.debug("disconnecting is timed out"),this.closeSocket(!0)},3e3)}cancelDisconnectTimer(){s.log.trace("cancelDisconnectTimer"),this.disconnectingTimer&&(clearTimeout(this.disconnectingTimer),this.disconnectingTimer=null)}get isConnected(){return"connected"===this.state&&this.websocket.isConnected}get state(){switch(this.fsm.state){case"connecting":case"initialising":case"retrying":case"error":return"connecting";case"updating":case"connected":return"connected";case"rejected":return"rejected";case"disconnecting":case"waitSocketClosed":case"waitOffloadSocketClosed":return"disconnecting";case"disconnected":default:return"disconnected"}}initRetry(){s.log.debug("initRetry"),this.retrier.inProgress?this.retrier.attemptFailed():this.retrier.start()}retry(){"connecting"!=this.fsm.state?(s.log.trace("retry"),this.websocket.close(),this.fsm.userRetry()):s.log.trace("can\t retry as already connecting")}onConnected(){this.emit("connected")}finalizeSocket(){s.log.trace("finalizeSocket"),this.websocket.close(),this.emit("disconnected"),this.disconnectedPromiseResolve&&(this.disconnectedPromiseResolve(),this.disconnectedPromiseResolve=null)}setupSocket(){s.log.trace("setupSocket:",this.config.token),this.websocket.connect()}onIncomingMessage(e){let{method:t,header:n,payload:r}=o.Parser.parse(e);if("reply"!==t&&this.confirmReceiving(n),"notification"===t)this.emit("message",n.message_type,r);else if("reply"===n.method)this.transport.processReply({id:n.id,status:n.status,header:n,body:r});else if("client_update"===n.method)"token_about_to_expire"===n.client_update_type&&this.emit("tokenAboutToExpire");else if("close"===n.method)if(308===n.status.code)s.log.debug("Connection has been offloaded"),this.fsm.receiveOffload({status:n.status.status,body:r});else if(406===n.status.code){const e=`Server closed connection because can't parse protocol: ${JSON.stringify(n.status)}`;this.emitReplyConnectionError(e,n,!0),s.log.error(e),this.fsm.receiveFatalClose()}else 417===n.status.code?(s.log.error(`Server closed connection because can't parse client reply: ${JSON.stringify(n.status)}`),this.fsm.receiveFatalClose(n.status.status)):410===n.status.code?(s.log.warn(`Server closed connection: ${JSON.stringify(n.status)}`),this.fsm.receiveClose(n.status.status),this.emit("tokenExpired")):401===n.status.code?(s.log.error(`Server closed connection: ${JSON.stringify(n.status)}`),this.fsm.receiveClose(n.status.status)):(s.log.warn("unexpected message: ",n.status),this.fsm.receiveOffload({status:n.status.status,body:null}))}async sendInit(){s.log.trace("sendInit");try{let e=await this.transport.sendInit();this.config.updateContinuationToken(e.continuationToken),this.fsm.initSuccess(e),this.emit("initialized",e),this.emit("tokenUpdated")}catch(e){if(e instanceof u.TwilsockReplyError){let t=!1;s.log.warn(`Init rejected by server: ${JSON.stringify(e.reply.status)}`),401===e.reply.status.code||403===e.reply.status.code?(t=!0,this.fsm.tokenRejected(e.reply.status),e.reply.status.errorCode===this.tokenExpiredSasCode&&this.emit("tokenExpired")):429===e.reply.status.code?(this.modifyBackoff(e.reply.body),this.fsm.initError(!0)):this.fsm.initError(500!==e.reply.status.code),this.emitReplyConnectionError(e.message,e.reply,t)}else this.emit("connectionError",{terminal:!0,message:e.message,httpStatusCode:null,errorCode:null}),this.fsm.initError(!0);this.emit("tokenUpdated",e)}}async sendUpdate(){s.log.trace("sendUpdate");let e=new a.Update(this.config.token);try{let t=await this.transport.sendWithReply(e);this.fsm.updateSuccess(t.body),this.emit("tokenUpdated")}catch(t){if(t instanceof u.TwilsockReplyError){let e=!1;s.log.warn(`Token update rejected by server: ${JSON.stringify(t.reply.status)}`),401===t.reply.status.code||403===t.reply.status.code?(e=!0,this.fsm.tokenRejected(t.reply.status),t.reply.status.errorCode===this.tokenExpiredSasCode&&this.emit("tokenExpired")):429===t.reply.status.code?(this.modifyBackoff(t.reply.body),this.fsm.updateError(t.reply.status)):this.fsm.updateError(t.reply.status),this.emitReplyConnectionError(t.message,t.reply,e)}else this.emit("error",!1,t.message,null,null),this.fsm.updateError(t);this.emit("tokenUpdated",t)}}emitReplyConnectionError(e,t,n){this.emit("connectionError",{terminal:n,message:t.status&&t.status.description?t.status.description:e,httpStatusCode:t.status.code,errorCode:t.status&&t.status.errorCode?t.status.errorCode:null})}cancelInit(){s.log.trace("cancelInit")}cancelUpdate(){s.log.trace("cancelUpdate")}confirmReceiving(e){s.log.trace("confirmReceiving");try{this.transport.send(new a.Reply(e.id))}catch(t){s.log.debug("failed to confirm packet receiving",t)}}closeSocket(e){s.log.trace(`closeSocket (graceful: ${e})`),e&&this.transport.isConnected&&this.transport.sendClose(),this.websocket.close(),setTimeout(()=>this.fsm.socketClosed(),0)}connect(){s.log.trace("connect"),this.fsm.userConnect()}disconnect(){return s.log.trace("disconnect"),this.fsm.is("disconnected")?Promise.resolve():new Promise(e=>{this.disconnectedPromiseResolve=e,this.fsm.userDisconnect()})}updateToken(e){return s.log.trace("updateToken:",e),new Promise((e,t)=>{this.once("tokenUpdated",n=>{n?t(n):e()}),this.fsm.userUpdateToken()})}get isTerminalState(){return-1!==this.terminalStates.indexOf(this.fsm.state)}onCloseReceived(e){this.websocket.close()}}t.TwilsockChannel=l,t.TwilsockImpl=l},MHYR:function(e,t,n){"use strict";var r=o(n("tgXR")),i=o(n("IhEH")),s=o(n("aq5/")),a=o(n("4Mt5"));function o(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var u=n("RtQP"),c=n("ZYEu"),l=n("Yquk"),d=function(){function e(t,n){(0,s.default)(this,e),this.services=t,this.url=n}var t,n;return(0,a.default)(e,[{key:"getUserDescriptor",value:(n=(0,i.default)(r.default.mark((function e(t){var n;return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new u.UriBuilder(this.url).path(t).build(),e.next=3,this.services.network.get(n);case 3:return e.abrupt("return",new l.UserDescriptor(this.services,e.sent.body));case 5:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"getChannelUserDescriptors",value:(t=(0,i.default)(r.default.mark((function e(t){var n,i,s=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=new u.UriBuilder(this.url).arg("ChannelSid",t).arg("PageToken",a.pageToken).build(),e.next=3,this.services.network.get(n);case 3:return e.abrupt("return",new c.RestPaginator((i=e.sent).body.users.map((function(e){return new l.UserDescriptor(s.services,e)})),(function(e){return s.getChannelUserDescriptors(t,{pageToken:e})}),i.body.meta.prev_token,i.body.meta.next_token));case 5:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),e}();t.UserDescriptors=d},MIMp:function(e,t){e.exports=function(e,t){return{value:t,done:!!e}}},"MNq/":function(e,t,n){n("iaOj")("Set")},MPuG:function(e,t,n){var r=n("Jo0e"),i=Math.min;e.exports=function(e){return e>0?i(r(e),9007199254740991):0}},MRQX:function(e,t,n){n("nNrO"),e.exports=n("rFq9").Reflect.construct},MmGm:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n("N8HJ");function i(e){return encodeURIComponent(e).replace(/%([0-9A-F]{2})/g,(e,t)=>String.fromCharCode("0x"+t)).length}function s(e){let t=Array.prototype.map.call(e,e=>String.fromCharCode(e)).join("").replace(/(.)/g,(e,t)=>{let n=t.charCodeAt(0).toString(16).toUpperCase();return n.length<2&&(n="0"+n),"%"+n});return decodeURIComponent(t)}function a(e){return JSON.parse(s(e))}t.Parser=class{constructor(){}static parse(e){const t=new Uint8Array(e),n=function(e){let t="",n=0;for(;n<e.length;++n){const r=String.fromCharCode(e[n]);if(t+=r,"\r"===r){n+=2;break}}const r=t.split(" ");return{size:n,protocol:r[0],version:r[1],headerSize:Number(r[2])}}(t);if("TWILSOCK"!==n.protocol||"V3.0"!==n.version)return void r.log.error(`unsupported protocol: ${n.protocol} ver ${n.version}`);let i=null;try{i=a(t.subarray(n.size,n.size+n.headerSize))}catch(u){return void r.log.error("failed to parse message header",u,e)}r.log.debug("message received: ",i.method),r.log.trace("message received: ",i);let o=null;if(i.payload_size>0){const c=2+n.size+n.headerSize,l=i.payload_size;if(i.hasOwnProperty("payload_type")&&0!==i.payload_type.indexOf("application/json"))0===i.payload_type.indexOf("text/plain")&&(o=s(t.subarray(c,c+l)));else try{o=a(t.subarray(c,c+l))}catch(u){return void r.log.error("failed to parse message body",u,e)}}return{method:i.method,header:i,payload:o}}static createPacket(e,t=""){e.payload_size=i(t);let n=JSON.stringify(e)+"\r\n",s="TWILSOCK V3.0 "+(i(n)-2)+"\r\n";return r.log.debug("send request:",s+n+t),function(e){let t=encodeURIComponent(e).replace(/%([0-9A-F]{2})/g,(e,t)=>String.fromCharCode("0x"+t)),n=new Uint8Array(t.length);return Array.prototype.forEach.call(t,(e,t)=>{n[t]=e.charCodeAt(0)}),n}(s+n+t).buffer}}},MrWc:function(e,t,n){var r=n("rU52");e.exports=function(e){return Object(r(e))}},MuMv:function(e,t,n){"use strict";var r=p(n("XUND")),i=p(n("tgXR")),s=p(n("qCKU")),a=p(n("IhEH")),o=p(n("kGNy")),u=p(n("u2rs")),c=p(n("Rhu4")),l=p(n("aq5/")),d=p(n("4Mt5")),h=p(n("7xyS")),f=p(n("k2Qk"));function p(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var m=n("r2q8"),y=n("CPx3"),v=n("cDQD");t.Channel=v.Channel;var g=n("9F0I"),b=n("RtQP"),w=y.Logger.scope("Channels"),_=function(e){function t(e){(0,l.default)(this,t);var n=(0,h.default)(this,(t.__proto__||(0,c.default)(t)).call(this));return n.services=e,n.channels=new u.default,n.thumbstones=new o.default,n.syncListFetched=!1,n.syncListRead=new g.Deferred,n}var n;return(0,f.default)(t,e),(0,d.default)(t,[{key:"getMap",value:function(){var e=this;return this.services.session.getMyChannelsId().then((function(t){return e.services.syncClient.map({id:t,mode:"open_existing"})}))}},{key:"addChannel",value:(n=(0,a.default)(i.default.mark((function e(t){var n,r,a,o,u,c;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=void 0,null!==(n=void 0===t.attributes?{}:t.attributes)){e.next=4;break}throw new Error("Attributes can't be null");case 4:if(n.constructor===Object){e.next=6;break}throw new Error("Attributes must be a valid JSON object");case 6:return e.next=8,this.services.session.addCommand("createChannel",{friendlyName:t.friendlyName,uniqueName:t.uniqueName,type:t.isPrivate?"private":"public",attributes:(0,s.default)(n)});case 8:if(o="channel"in(r=e.sent)?r.channel:null,!(u=this.channels.get(a="channelSid"in r?r.channelSid:null))){e.next=16;break}return e.next=15,u._subscribe();case 15:return e.abrupt("return",u);case 16:return c=new v.Channel(this.services,{channel:o,entityName:null,uniqueName:null,attributes:null,createdBy:null,friendlyName:null,lastConsumedMessageIndex:null,type:t.isPrivate?"private":"public",dateCreated:null,dateUpdated:null},a),this.channels.set(c.sid,c),this.registerForEvents(c),e.next=21,c._subscribe();case 21:return this.emit("channelAdded",c),e.abrupt("return",c);case 23:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"fetchChannels",value:function(){var e,t=this;this.getMap().then((e=(0,a.default)(i.default.mark((function e(n){var s,a;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.on("itemAdded",(function(e){w.debug("itemAdded: "+e.item.key),t.upsertChannel("sync",e.item.key,e.item.value)})),n.on("itemRemoved",(function(e){w.debug("itemRemoved: "+e.key);var n=e.key;t.syncListFetched||t.thumbstones.add(n);var r=t.channels.get(n);r&&("joined"!==r.status&&"invited"!==r.status||(r._setStatus("known","sync"),t.emit("channelLeft",r)),r.isPrivate&&(t.channels.delete(n),t.emit("channelRemoved",r),r.emit("removed",r)))})),n.on("itemUpdated",(function(e){w.debug("itemUpdated: "+e.item.key),t.upsertChannel("sync",e.item.key,e.item.value)})),s=[],e.next=6,t.services.syncList.getPage();case 6:(a=e.sent).items.forEach((function(e){s.push(t.upsertChannel("synclist",e.channel_sid,e))}));case 9:if(!a.hasNextPage){e.next=16;break}return e.next=12,a.nextPage();case 12:(a=e.sent).items.forEach((function(e){s.push(t.upsertChannel("synclist",e.channel_sid,e))})),e.next=9;break;case 16:return t.syncListRead.set(!0),e.abrupt("return",r.default.all(s));case 18:case"end":return e.stop()}}),e,t)}))),function(t){return e.apply(this,arguments)})).then((function(){t.syncListFetched=!0,t.thumbstones.clear(),w.debug("Channels list fetched")})).then((function(){return t})).catch((function(e){throw"disconnected"!=t.services.syncClient.connectionState&&w.error("Failed to get channels list",e),w.debug("ERROR: Failed to get channels list",e),e}))}},{key:"_wrapPaginator",value:function(e,t){var n=this;return t(e.items).then((function(r){return{items:r,hasNextPage:e.hasNextPage,hasPrevPage:e.hasPrevPage,nextPage:function(){return e.nextPage().then((function(e){return n._wrapPaginator(e,t)}))},prevPage:function(){return e.prevPage().then((function(e){return n._wrapPaginator(e,t)}))}}}))}},{key:"getChannels",value:function(e){var t=this;return this.getMap().then((function(t){return t.getItems(e)})).then((function(e){return t._wrapPaginator(e,(function(e){return r.default.all(e.map((function(e){return t.upsertChannel("sync",e.key,e.value)})))}))}))}},{key:"getChannel",value:function(e){var t=this;return this.getMap().then((function(t){return t.getItems({key:e})})).then((function(e){return e.items.map((function(e){return t.upsertChannel("sync",e.key,e.value)}))})).then((function(e){return e.length>0?e[0]:null}))}},{key:"pushChannel",value:function(e){var t=e.sid;return this.upsertChannel("chat",t,{entityName:null,lastConsumedMessageIndex:e.lastConsumedMessageIndex,type:e.type,status:e.status,friendlyName:e.friendlyName,dateUpdated:e.dateUpdated,dateCreated:e.dateCreated,uniqueName:e.uniqueName,createdBy:e.createdBy,attributes:e.attributes,channel:e.channel,notificationLevel:e.notificationLevel,sid:t})}},{key:"upsertChannel",value:function(e,t,n){var r=this;w.trace("upsertChannel(sid="+t+", data=",n);var i=this.channels.get(t);if(i){if(w.trace("upsertChannel: channel "+t+" is known and it's status is known from source "+i._statusSource()+" and update came from source "+e,i),void 0===i._statusSource()||e===i._statusSource()||"synclist"===e&&"sync"!==i._statusSource()||"sync"===e)if("joined"===n.status&&"joined"!==i.status){i._setStatus("joined",e);var s={};void 0!==n.notificationLevel&&(s.notificationLevel=n.notificationLevel),void 0!==n.lastConsumedMessageIndex&&(s.lastConsumedMessageIndex=n.lastConsumedMessageIndex),b.isDeepEqual(s,{})||i._update(s),i._subscribe().then((function(){r.emit("channelJoined",i)}))}else if("invited"===n.status&&"invited"!==i.status){i._setStatus("invited",e);var a={};void 0!==n.notificationLevel&&(a.notificationLevel=n.notificationLevel),void 0!==n.lastConsumedMessageIndex&&(a.lastConsumedMessageIndex=n.lastConsumedMessageIndex),b.isDeepEqual(a,{})||i._update(a),i._subscribe().then((function(){r.emit("channelInvited",i)}))}else"known"!==n.status||"invited"!==i.status&&"joined"!==i.status?"notParticipating"!==n.status&&"known"!==n.status||"private"!==n.type?i._update(n):i._subscribe():(i._setStatus("known",e),i._update(n),i._subscribe().then((function(){r.emit("channelLeft",i)})));else w.trace("upsertChannel: channel is known from sync and came from chat, ignoring",{sid:t,data:n.status,channel:i.status});return i._subscribe().then((function(){return i}))}if("chat"!==e&&"synclist"!==e||!this.thumbstones.has(t))return w.trace("upsertChannel: creating local channel object with sid "+t,n),i=new v.Channel(this.services,n,t),this.channels.set(t,i),i._subscribe().then((function(){return r.registerForEvents(i),r.emit("channelAdded",i),"joined"===n.status?(i._setStatus("joined",e),r.emit("channelJoined",i)):"invited"===n.status&&(i._setStatus("invited",e),r.emit("channelInvited",i)),i}));w.trace("upsertChannel: channel is deleted and came again from chat, ignoring",t)}},{key:"onChannelRemoved",value:function(e){var t=this.channels.get(e);t&&(this.channels.delete(e),this.emit("channelRemoved",t))}},{key:"registerForEvents",value:function(e){var t=this;e.on("removed",(function(){return t.onChannelRemoved(e.sid)})),e.on("updated",(function(e){return t.emit("channelUpdated",e)})),e.on("memberJoined",this.emit.bind(this,"memberJoined")),e.on("memberLeft",this.emit.bind(this,"memberLeft")),e.on("memberUpdated",(function(e){return t.emit("memberUpdated",e)})),e.on("messageAdded",this.emit.bind(this,"messageAdded")),e.on("messageUpdated",(function(e){return t.emit("messageUpdated",e)})),e.on("messageRemoved",this.emit.bind(this,"messageRemoved")),e.on("typingStarted",this.emit.bind(this,"typingStarted")),e.on("typingEnded",this.emit.bind(this,"typingEnded"))}}]),t}(m.EventEmitter);t.Channels=_},N8HJ:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n("XdyU");function i(e,t){return[`${(new Date).toISOString()} Twilsock ${e}:`].concat(Array.from(t))}class s{constructor(e){this.prefix="",this.prefix=null!=e&&e.length>0?" "+e+":":""}setLevel(e){r.setLevel(e)}static setLevel(e){r.setLevel(e)}trace(...e){r.debug.apply(null,i("T",e))}debug(...e){r.debug.apply(null,i("D",e))}info(...e){r.info.apply(null,i("I",e))}warn(...e){r.warn.apply(null,i("W",e))}error(...e){r.error.apply(null,i("E",e))}static trace(...e){r.trace.apply(null,i("T",e))}static debug(...e){r.debug.apply(null,i("D",e))}static info(...e){r.info.apply(null,i("I",e))}static warn(...e){r.warn.apply(null,i("W",e))}static error(...e){r.error.apply(null,i("E",e))}}t.Logger=s;let a=new s("");t.log=a},NkxH:function(e,t){for(var n=[],r=0;r<256;++r)n[r]=(r+256).toString(16).substr(1);e.exports=function(e,t){var r=t||0;return[n[e[r++]],n[e[r++]],n[e[r++]],n[e[r++]],"-",n[e[r++]],n[e[r++]],"-",n[e[r++]],n[e[r++]],"-",n[e[r++]],n[e[r++]],"-",n[e[r++]],n[e[r++]],n[e[r++]],n[e[r++]],n[e[r++]],n[e[r++]]].join("")}},O3kU:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n("N8HJ"),i=n("SbVi"),s=n("oi0w"),a=n("FukD"),o=n("F8DB");function u(e,t){const n=function(e){const t=e.match(/^(https?\:)\/\/(([^:\/?#]*)(?:\:([0-9]+))?)(\/[^?#]*)(\?[^#]*|)(#.*|)$/);if(t){let e={protocol:t[1],host:t[2],hostname:t[3],port:t[4],pathname:t[5],search:t[6],hash:t[7],params:null};if(e.search.length>0){let t=e.search.substring(1);e.params=t.split("&").map(e=>e.split("=")).reduce((e,t)=>(e.hasOwnProperty(t[0])?Array.isArray(e[t[0]])?e[t[0]].push(t[1]):e[t[0]]=[e[t[0]],t[1]]:e[t[0]]=t[1],e),{})}return e}throw new i.TwilsockError("Incorrect URI: "+e)}(t);let r={method:e,host:n.host,path:n.pathname};return n.params&&(r.params=n.params),r}t.Upstream=class{constructor(e,t,n){this.config=n,this.transport=e,this.pendingMessages=[],this.twilsock=t}saveMessage(e){return new Promise((t,n)=>{let s={message:e,resolve:t,reject:n,alreadyRejected:!1,timeout:setTimeout(()=>{r.log.debug("request is timed out"),n(new i.TwilsockError("Twilsock: request timeout")),s.alreadyRejected=!0},2e4)};this.pendingMessages.push(s)})}sendPendingMessages(){for(;this.pendingMessages.length;){let t=this.pendingMessages[0];if(!t.alreadyRejected)try{this.actualSend(t.message).then(e=>t.resolve(e)).catch(e=>t.reject(e)),clearTimeout(t.timeout)}catch(e){r.log.debug("Failed to send pending message",e);break}this.pendingMessages.splice(0,1)}}rejectPendingMessages(){this.pendingMessages.forEach(e=>{e.reject(new o.TransportUnavailableError("Can't connect to twilsock")),clearTimeout(e.timeout)}),this.pendingMessages.splice(0,this.pendingMessages.length)}async actualSend(e){let t=e.to,n=e.headers,r=e.body,i=new a.Message(this.config.activeGrant,n["Content-Type"]||"application/json",{host:t.host,path:t.path,method:t.method,params:t.params,headers:n}),o=await this.transport.sendWithReply(i,r);if((c=o)&&c.header&&c.header.http_status&&!((u=o.header.http_status.code)>=200&&u<300))throw new s.TwilsockUpstreamError(o.header.http_status.code,o.header.http_status.status,o.body);var u,c;return{status:o.header.http_status,headers:o.header.http_headers,body:o.body}}send(e,t,n={},r){if(this.twilsock.isTerminalState)return Promise.reject(new o.TransportUnavailableError("Can't connect to twilsock"));let i=function(e,t,n,r){return{to:u(e,t),headers:n,body:r}}(e,t,n,r);return this.twilsock.isConnected?this.actualSend(i):this.saveMessage(i)}}},O95A:function(e,t,n){"use strict";var r=n("zCrM"),i=n("S5Zg");e.exports=n("HKkr")("Set",(function(e){return function(){return e(this,arguments.length>0?arguments[0]:void 0)}}),{add:function(e){return r.def(i(this,"Set"),e=0===e?0:e,e)}},r)},ObEa:function(e,t,n){e.exports=!n("7S/a")((function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a}))},OoA2:function(e,t,n){n("/zo1"),e.exports=n("rFq9").Object.setPrototypeOf},P0Gn:function(e,t,n){n("LQEr"),e.exports=n("rFq9").Number.isInteger},PfNy:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n("ihyG"),i=n("sqYj"),s=n("E9sr");function a(e,t){var n=r.Pointer.fromJSON(t).evaluate(e);if(void 0!==n)return{op:"test",path:t,value:n.value}}t.applyPatch=function(e,t){return t.map((function(t){return i.apply(e,t)}))},t.createPatch=function(e,t,n){var i=new r.Pointer;return(n?function(e){return function t(n,r,i){var a=e(n,r,i);return Array.isArray(a)?a:s.diffAny(n,r,i,t)}}(n):s.diffAny)(e,t,i)},t.createTests=function(e,t){var n=new Array;return t.filter(s.isDestructive).forEach((function(t){var r=a(e,t.path);if(r&&n.push(r),"from"in t){var i=a(e,t.from);i&&n.push(i)}})),n}},PkSp:function(e,t,n){n("9YHp")("asyncIterator")},"QDM+":function(e,t,n){e.exports={default:n("xLJM"),__esModule:!0}},QdMa:function(e,t,n){var r=n("Hs7Z"),i=n("z7HR").f,s={}.toString,a="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];e.exports.f=function(e){return a&&"[object Window]"==s.call(e)?function(e){try{return i(e)}catch(t){return a.slice()}}(e):i(r(e))}},QvZc:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n("llpV");class i{constructor(e,t){this.value=e,this.revision=t||0}get isValid(){return!0}}class s{constructor(e){this.revision=e}get isValid(){return!1}}class a{constructor(){this.items=new r.TreeMap}store(e,t,n){let r=this.items.get(e);return r&&r.revision>n?r.isValid?r.value:null:(this.items.set(e,new i(t,n)),t)}delete(e,t){let n=this.items.get(e);(!n||n.revision<t)&&this.items.set(e,new s(t))}isKnown(e,t){let n=this.items.get(e);return n&&n.revision>=t}get(e){let t=this.items.get(e);return t&&t.isValid?t.value:null}has(e){let t=this.items.get(e);return t&&t.isValid}}t.Cache=a,t.default=a},QwS4:function(e,t,n){var r=n("hR4s").navigator;e.exports=r&&r.userAgent||""},QyXE:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n("qXWz"),i=n("s23o"),s=n("zaPo"),a=i.Logger.scope("Network");t.Network=class{constructor(e,t){this.config=e,this.transport=t}backoffConfig(){return Object.assign(s.Configuration.backoffConfigDefault,this.config.backoffConfigOverride)}retryWhenThrottled(){return void 0!==this.config.retryWhenThrottledOverride?this.config.retryWhenThrottledOverride:void 0!==s.Configuration.retryWhenThrottledDefault&&s.Configuration.retryWhenThrottledDefault}executeWithRetry(e,t=!1){return new Promise((n,i)=>{let s=[502,503,504];t&&s.push(429);let a=new r.Retrier(this.backoffConfig());a.on("attempt",()=>{e().then(e=>a.succeeded(e)).catch(e=>{s.indexOf(e.status)>-1||"Twilsock disconnected"===e.message?a.failed(e):(a.removeAllListeners(),a.cancel(),i(e))})}),a.on("succeeded",e=>{n(e)}),a.on("cancelled",e=>i(e)),a.on("failed",e=>i(e)),a.start()})}async get(e){const t={"X-Twilio-Token":this.config.token};a.trace("sending GET request to ",e," headers ",t);let n=await this.executeWithRetry(()=>this.transport.get(e,t),this.retryWhenThrottled());return a.trace("response",n),n}async post(e,t,n){let r,i={"X-Twilio-Token":this.config.token};"undefined"!=typeof FormData&&t instanceof FormData||!n||Object.assign(i,{"Content-Type":n}),a.trace("sending POST request to ",e," headers ",i);try{r=await this.transport.post(e,i,t)}catch(s){throw s instanceof TypeError?(a.trace("got error in post response",s),new TypeError("Posting FormData supported only with browser engine's FormData")):s}return a.trace("response",r),r}}},R6fH:function(e,t,n){var r=n("M25K"),i=n("eD9m")("iterator"),s=n("tReM");e.exports=n("rFq9").isIterable=function(e){var t=Object(e);return void 0!==t[i]||"@@iterator"in t||s.hasOwnProperty(r(t))}},Rhu4:function(e,t,n){e.exports={default:n("uBMx"),__esModule:!0}},Rk1W:function(e,t,n){n("dUHx"),n("/r3m"),n("Fk9O"),n("O95A"),n("cvX4"),n("MNq/"),n("Ff16"),e.exports=n("rFq9").Set},RtQP:function(e,t,n){"use strict";var r=a(n("aq5/")),i=a(n("4Mt5")),s=a(n("qCKU"));function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=n("PfNy");t.isDeepEqual=function(e,t){return 0===o.createPatch(e,t).length},t.deepClone=function(e){return JSON.parse((0,s.default)(e))},t.parseToNumber=function(e){return void 0===e||isNaN(Number(e))?null:Number(e)},t.parseTime=function(e){try{return new Date(e)}catch(t){return null}},t.parseAttributes=function(e,t,n){var r={};if(e)try{r=JSON.parse(e)}catch(i){n.warn(t)}return r};var u=function(){function e(t){(0,r.default)(this,e),this.base=t.replace(/\/$/,""),this.args=[],this.paths=[]}return(0,i.default)(e,[{key:"arg",value:function(e,t){return void 0!==t&&this.args.push(encodeURIComponent(e)+"="+encodeURIComponent(t)),this}},{key:"path",value:function(e){return this.paths.push(encodeURIComponent(e)),this}},{key:"build",value:function(){var e=this.base;return this.paths.length&&(e+="/"+this.paths.join("/")),this.args.length&&(e+="?"+this.args.join("&")),e}}]),e}();t.UriBuilder=u},S49y:function(e,t,n){"use strict";var r=n("UtsQ"),i=n("IFjL"),s=n("Eolq"),a=n("b95h"),o=n("tReM"),u=n("zjfI"),c=n("KnMe"),l=n("ax0Y"),d=n("eD9m")("iterator"),h=!([].keys&&"next"in[].keys()),f=function(){return this};e.exports=function(e,t,n,p,m,y,v){u(n,t,p);var g,b,w,_=function(e){if(!h&&e in C)return C[e];switch(e){case"keys":case"values":return function(){return new n(this,e)}}return function(){return new n(this,e)}},k=t+" Iterator",x="values"==m,S=!1,C=e.prototype,M=C[d]||C["@@iterator"]||m&&C[m],E=M||_(m),T=m?x?_("entries"):E:void 0,I="Array"==t&&C.entries||M;if(I&&(w=l(I.call(new e)))!==Object.prototype&&w.next&&(c(w,k,!0),r||"function"==typeof w[d]||a(w,d,f)),x&&M&&"values"!==M.name&&(S=!0,E=function(){return M.call(this)}),r&&!v||!h&&!S&&C[d]||a(C,d,E),o[t]=E,o[k]=f,m)if(g={values:x?E:_("values"),keys:y?E:_("keys"),entries:T},v)for(b in g)b in C||s(C,b,g[b]);else i(i.P+i.F*(h||S),t,g);return g}},S5Zg:function(e,t,n){var r=n("vbc5");e.exports=function(e,t){if(!r(e)||e._t!==t)throw TypeError("Incompatible receiver, "+t+" required!");return e}},S7IX:function(e,t,n){var r=n("Jo0e"),i=n("rU52");e.exports=function(e){return function(t,n){var s,a,o=String(i(t)),u=r(n),c=o.length;return u<0||u>=c?e?"":void 0:(s=o.charCodeAt(u))<55296||s>56319||u+1===c||(a=o.charCodeAt(u+1))<56320||a>57343?e?o.charAt(u):s:e?o.slice(u,u+2):a-56320+(s-55296<<10)+65536}}},SZul:function(e,t,n){n("iaOj")("Map")},SbVi:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class r extends Error{constructor(e){super(e)}}t.TwilsockError=r},SmK6:function(e,t,n){var r=n("8fQz"),i=n("Vzpu"),s=n("eD9m")("species");e.exports=function(e,t){var n,a=r(e).constructor;return void 0===a||null==(n=r(a)[s])?t:i(n)}},Sqfg:function(e,t,n){var r=n("uXIA"),i=n("KBpo"),s=i;s.v1=r,s.v4=i,e.exports=s},TQPF:function(e,t,n){e.exports={default:n("IkCb"),__esModule:!0}},TjkB:function(e,t,n){n("IgrD"),e.exports=n("rFq9").Object.assign},TkJz:function(e,t,n){var r=n("3UoP"),i=n("jJPU"),s=i;s.v1=r,s.v4=i,e.exports=s},TkXn:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=Object.prototype.hasOwnProperty;t.clone=function e(t){if(null==t||"object"!=typeof t)return t;if(t.constructor==Array){for(var n=t.length,i=new Array(n),s=0;s<n;s++)i[s]=e(t[s]);return i}var a={};for(var o in t)r.call(t,o)&&(a[o]=e(t[o]));return a}},TkcT:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n("r2q8");function i(e){return null!=e}class s extends r.EventEmitter{constructor(e){if(super(),i((e=e||{}).initialDelay)&&e.initialDelay<1)throw new Error("The initial timeout must be equal to or greater than 1.");if(i(e.maxDelay)&&e.maxDelay<=1)throw new Error("The maximal timeout must be greater than 1.");if(i(e.randomisationFactor)&&(e.randomisationFactor<0||e.randomisationFactor>1))throw new Error("The randomisation factor must be between 0 and 1.");if(i(e.factor)&&e.factor<=1)throw new Error("Exponential factor should be greater than 1.");if(this.initialDelay=e.initialDelay||100,this.maxDelay=e.maxDelay||1e4,this.maxDelay<=this.initialDelay)throw new Error("The maximal backoff delay must be greater than the initial backoff delay.");this.randomisationFactor=e.randomisationFactor||0,this.factor=e.factor||2,this.maxNumberOfRetry=-1,this.reset()}static exponential(e){return new s(e)}backoff(e){null==this.timeoutID&&(this.backoffNumber===this.maxNumberOfRetry?(this.emit("fail",e),this.reset()):(this.backoffDelay=this.next(),this.timeoutID=setTimeout(this.onBackoff.bind(this),this.backoffDelay),this.emit("backoff",this.backoffNumber,this.backoffDelay,e)))}reset(){this.backoffDelay=0,this.nextBackoffDelay=this.initialDelay,this.backoffNumber=0,clearTimeout(this.timeoutID),this.timeoutID=null}failAfter(e){if(e<=0)throw new Error(`Expected a maximum number of retry greater than 0 but got ${e}`);this.maxNumberOfRetry=e}next(){this.backoffDelay=Math.min(this.nextBackoffDelay,this.maxDelay),this.nextBackoffDelay=this.backoffDelay*this.factor;let e=1+Math.random()*this.randomisationFactor;return Math.min(this.maxDelay,Math.round(this.backoffDelay*e))}onBackoff(){this.timeoutID=null,this.emit("ready",this.backoffNumber,this.backoffDelay),this.backoffNumber++}}t.Backoff=s,t.default=s},ToDU:function(e,t,n){"use strict";var r=o(n("XUND")),i=o(n("u2rs")),s=o(n("aq5/")),a=o(n("4Mt5"));function o(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var u=n("CPx3"),c=n("yDbV"),l=u.Logger.scope("TypingIndicator"),d=function(){function e(t,n,r){(0,s.default)(this,e),this.config=t,this.services=n,this.getChannel=r,this.serviceTypingTimeout=null,this.sentUpdates=new i.default}return(0,a.default)(e,[{key:"initialize",value:function(){var e=this;this.services.notificationClient.subscribe(c.NotificationTypes.TYPING_INDICATOR,"twilsock"),this.services.notificationClient.on("message",(function(t,n){t===c.NotificationTypes.TYPING_INDICATOR&&e.handleRemoteTyping(n)}))}},{key:"handleRemoteTyping",value:function(e){var t=this;l.trace("Got new typing indicator ",e),this.getChannel(e.channel_sid).then((function(n){n&&n.members.forEach((function(n){n.identity===e.identity&&n._startTyping(t.typingTimeout)}))})).catch((function(e){throw l.error(e),e}))}},{key:"send",value:function(e){var t=this.sentUpdates.get(e);return t&&t>Date.now()-this.typingTimeout?r.default.resolve():(this.sentUpdates.set(e,Date.now()),this._send(e))}},{key:"_send",value:function(e){var t=this;return l.trace("Sending typing indicator"),this.services.transport.post(this.config.typingIndicatorUri,{"Content-Type":"application/x-www-form-urlencoded"},"ChannelSid="+e).then((function(e){e.body.hasOwnProperty("typing_timeout")&&(t.serviceTypingTimeout=1e3*e.body.typing_timeout)})).catch((function(e){throw l.error("Failed to send typing indicator:",e),e}))}},{key:"typingTimeout",get:function(){return this.config.typingIndicatorTimeoutOverride||this.serviceTypingTimeout||this.config.typingIndicatorTimeoutDefault}}]),e}();t.TypingIndicator=d},TsN3:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n("N8HJ"),i=n("TkJz"),s=n("SbVi"),a=n("gSK9"),o=n("MmGm"),u=n("FukD"),c=n("Xs3C");t.PacketResponse=class{},t.PacketInterface=class{constructor(e,t){this.config=t,this.activeRequests=new Map,this.channel=e,this.channel.on("reply",e=>this.processReply(e)),this.channel.on("disconnected",()=>{this.activeRequests.forEach(e=>{clearTimeout(e.timeout),e.reject(new s.TwilsockError("disconnected"))}),this.activeRequests.clear()})}get isConnected(){return this.channel.isConnected}processReply(e){const t=this.activeRequests.get(e.id);var n;t&&(clearTimeout(t.timeout),this.activeRequests.delete(e.id),(n=e.status.code)>=200&&n<300?t.resolve(e):(t.reject(new a.TwilsockReplyError("Transport failure: "+e.status.status,e)),r.log.trace("message rejected")))}storeRequest(e,t,n){let i={resolve:t,reject:n,timeout:setTimeout(()=>{r.log.trace("request",e,"is timed out"),n(new s.TwilsockError("Twilsock: request timeout: "+e))},3e4)};this.activeRequests.set(e,i)}shutdown(){this.activeRequests.forEach(e=>{clearTimeout(e.timeout),e.reject(new s.TwilsockError("Twilsock: request cancelled by user"))}),this.activeRequests.clear()}async sendInit(){r.log.trace("sendInit");let e=c.Metadata.getMetadata(this.config),t=new u.Init(this.config.token,this.config.continuationToken,e,this.config.initRegistrations,this.config.tweaks),n=await this.sendWithReply(t);return new u.InitReply(n.id,n.header.continuation_token,n.header.continuation_token_status,n.header.offline_storage,n.header.init_registrations,n.header.debug_info)}sendClose(){let e=new u.Close;this.send(e)}sendWithReply(e,t){return new Promise((n,r)=>{let i=this.send(e,t);this.storeRequest(i,n,r)})}send(e,t){e.id=e.id||`TM${i.v4()}`;let n=o.Parser.createPacket(e,function(e){switch(typeof e){case"undefined":return"";case"object":return JSON.stringify(e);default:return e}}(t));try{return this.channel.send(n),e.id}catch(s){throw r.log.debug("failed to send ",e,s),r.log.trace(s.stack),s}}}},UtsQ:function(e,t){e.exports=!0},UuY1:function(e,t,n){"use strict";var r=o(n("tgXR")),i=o(n("IhEH")),s=o(n("aq5/")),a=o(n("4Mt5"));function o(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var u=n("RtQP"),c=n("ZYEu"),l=n("Xfc8"),d=function(){function e(t,n,r){(0,s.default)(this,e),this.client=t,this.services=n,this.url=r}var t;return(0,a.default)(e,[{key:"getChannels",value:(t=(0,i.default)(r.default.mark((function e(){var t,n,i=this,s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new u.UriBuilder(this.url).arg("PageToken",s.pageToken).build(),e.next=3,this.services.network.get(t);case 3:return e.abrupt("return",new c.RestPaginator((n=e.sent).body.channels.map((function(e){return new l.ChannelDescriptor(i.client,e)})),(function(e){return i.getChannels({pageToken:e})}),n.body.meta.previous_token,n.body.meta.next_token));case 5:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),e}();t.UserChannels=d},UusA:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n("2CE9"),i=global.XMLHttpRequest||n(5).XMLHttpRequest;class s{constructor(){}static request(e,t,n,s){return new Promise((a,o)=>{let u=new i;u.open(e,t,!0),u.onreadystatechange=function(){if(4!==u.readyState)return;const e=(t=u.getAllResponseHeaders())?t.split("\r\n").map(e=>e.split(": ")).filter(e=>2===e.length&&e[1].length>0).reduce((e,t)=>(e[t[0]]=t[1],e),{}):{};var t;const n=function(e){const t=e.getResponseHeader("Content-Type");if(!t||0!==t.indexOf("application/json")||0===e.responseText.length)return e.responseText;try{return JSON.parse(e.responseText)}catch(n){return e.responseText}}(u);if(200<=u.status&&u.status<300)a({status:u.status,headers:e,body:n});else{const t=u.statusText&&u.statusText.code?u.statusText.code:"NONE";let i;i="string"==typeof n?n&&1===n.split("\n",2).length?n:"":JSON.stringify(n),o(new r.TransportError(`${u.status}: [${t}] ${i}`,u.status,n,t,e))}};for(let e in n)u.setRequestHeader(e,n[e]),"Content-Type"===e&&"application/json"===n[e]&&(s=JSON.stringify(s));u.send(s)})}get(e,t){return s.request("GET",e,t)}post(e,t,n){return s.request("POST",e,t,n)}}t.Transport=s},UwCj:function(e,t,n){var r=n("8fQz"),i=n("LMaB"),s=n("Kc1g"),a=Object.defineProperty;t.f=n("ObEa")?Object.defineProperty:function(e,t,n){if(r(e),t=s(t,!0),r(n),i)try{return a(e,t,n)}catch(o){}if("get"in n||"set"in n)throw TypeError("Accessors not supported!");return"value"in n&&(e[t]=n.value),e}},"V/GX":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n("r2q8"),i=n("nzL3"),s=n("ypPR");t.Registrar=class extends r.EventEmitter{constructor(e,t,n,r){super(),this.config=r,this.connectors=new Map;const a=this.detectPlatform();this.connectors.set("gcm",new i.RegistrarConnector("gcm",{protocolVersion:3,productId:e,platform:a},t,r)),this.connectors.set("fcm",new i.RegistrarConnector("fcm",{protocolVersion:3,productId:e,platform:a},t,r)),this.connectors.set("apn",new i.RegistrarConnector("apn",{protocolVersion:4,productId:e,platform:a},t,r)),this.connectors.set("twilsock",new s.TwilsockConnector({productId:e,platform:a},n,r)),this.connectors.get("twilsock").on("transportReady",e=>this.emit("transportReady",e))}setNotificationId(e,t){this.connector(e).setNotificationId(t)}subscribe(e,t){return this.connector(t).subscribe(e)}unsubscribe(e,t){return this.connector(t).unsubscribe(e)}updateToken(e){this.connectors.forEach(t=>t.updateToken(e))}connector(e){let t=this.connectors.get(e);if(!t)throw new Error(`Unknown channel type: ${e}`);return t}detectPlatform(){let e="";return"undefined"!=typeof navigator?(e="unknown",void 0!==navigator.product&&(e=navigator.product),void 0!==navigator.userAgent&&(e=navigator.userAgent)):e="web",e.substring(0,128)}}},VAi2:function(e,t,n){n("Fk9O"),n("/r3m"),e.exports=n("R6fH")},VeTy:function(e,t,n){var r=n("DIWJ"),i=n("jHgz"),s=n("Hs7Z"),a=n("Kc1g"),o=n("YVtA"),u=n("LMaB"),c=Object.getOwnPropertyDescriptor;t.f=n("ObEa")?c:function(e,t){if(e=s(e),t=a(t,!0),u)try{return c(e,t)}catch(n){}if(o(e,t))return i(!r.f.call(e,t),e[t])}},ViZE:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n("BHqR");t.Reply=class extends r.AbstractMessage{constructor(e){super(e),this.method="reply",this.payload_type="application/json",this.status={code:200,status:"OK"}}}},Vzpu:function(e,t){e.exports=function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!");return e}},W27V:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n("lKIr"),i=n("qlDM"),s=n("sc67"),a=n("LYxL"),o=n("yURk"),u=n("+fds"),c=n("L760"),l=n("QvZc"),d=n("wiho"),h=n("e/PS");class f extends o.SyncEntity{constructor(e,t,n){super(e,n),this.updateMergingQueue=new d.NamespacedMergingQueue((e,t)=>"number"==typeof t.ttl?{ttl:t.ttl}:e),this.cache=new l.Cache,this.descriptor=t,this.descriptor.date_updated=new Date(this.descriptor.date_updated)}get uri(){return this.descriptor.url}get revision(){return this.descriptor.revision}get lastEventId(){return this.descriptor.last_event_id}get links(){return this.descriptor.links}get dateExpires(){return this.descriptor.date_expires}static get type(){return"list"}get type(){return"list"}get indexName(){}get queryString(){}get sid(){return this.descriptor.sid}get uniqueName(){return this.descriptor.unique_name||null}get dateUpdated(){return this.descriptor.date_updated}async _addOrUpdateItemOnServer(e,t,n,r){let i={data:t};"number"==typeof r&&(i.ttl=r);let s=await this.services.network.post(e,i,n);return s.body.data=t,s.body.date_updated=new Date(s.body.date_updated),s.body}async push(e,t){let n=(t||{}).ttl;r.validateOptionalTtl(n);let i=await this._addOrUpdateItemOnServer(this.links.items,e,void 0,n),s=Number(i.index);return this._handleItemMutated(s,i.url,i.last_event_id,i.revision,e,i.date_updated,i.date_expires,!0,!1),this.cache.get(s)}async set(e,t,n){const i=n||{};return r.validateOptionalTtl(i.ttl),this.updateMergingQueue.squashAndAdd(e,i,n=>this._updateItemUnconditionally(e,t,n.ttl))}async _updateItemUnconditionally(e,t,n){let r=await this.get(e);const i=await this._addOrUpdateItemOnServer(r.uri,t,void 0,n);return this._handleItemMutated(e,i.url,i.last_event_id,i.revision,i.data,i.date_updated,i.date_expires,!1,!1),this.cache.get(e)}async _updateItemWithIfMatch(e,t,n){const i=await this.get(e),s=t(r.deepClone(i.value));if(!s)return i;{const r=i.revision;try{const t=await this._addOrUpdateItemOnServer(i.uri,s,r,n);return this._handleItemMutated(e,t.url,t.last_event_id,t.revision,t.data,t.date_updated,t.date_expires,!1,!1),this.cache.get(e)}catch(a){if(412===a.status)return await this._getItemFromServer(e),this._updateItemWithIfMatch(e,t,n);throw a}}}async mutate(e,t,n){const i=n||{};return r.validateOptionalTtl(i.ttl),this.updateMergingQueue.add(e,i,n=>this._updateItemWithIfMatch(e,t,n.ttl))}async update(e,t,n){return this.mutate(e,e=>Object.assign(e,t),n)}async remove(e){let t=await this.get(e),n=await this.services.network.delete(t.uri);this._handleItemRemoved(e,n.body.last_event_id,void 0,new Date(n.body.date_updated),!1)}async get(e){return this.cache.get(e)||this._getItemFromServer(e)}async _getItemFromServer(e){let t=await this.queryItems({index:e});if(t.items.length<1)throw new s.SyncError(`No item with index ${e} found`,404,54151);return t.items[0]}async queryItems(e){e=e||{};const t=new i.UriBuilder(this.links.items).queryParam("From",e.from).queryParam("PageSize",e.limit).queryParam("Index",e.index).queryParam("PageToken",e.pageToken).queryParam("Order",e.order).build();let n=await this.services.network.get(t),r=n.body.items.map(e=>(e.date_updated=new Date(e.date_updated),this.cache.get(e.index)?this._handleItemMutated(e.index,e.url,e.last_event_id,e.revision,e.data,e.date_updated,e.date_expires,!1,!0):this.cache.store(Number(e.index),new u.ListItem({index:Number(e.index),uri:e.url,revision:e.revision,lastEventId:e.last_event_id,dateUpdated:e.date_updated,dateExpires:e.date_expires,value:e.data}),e.last_event_id),this.cache.get(e.index))),s=n.body.meta;return new c.Paginator(r,e=>this.queryItems({pageToken:e}),s.previous_token,s.next_token)}async getItems(e){return r.validatePageSize((e=e||{}).pageSize),e.limit=e.pageSize||e.limit||50,e.order=e.order||"asc",this.queryItems(e)}async getContext(){if(!this.context){let e=await this.services.network.get(this.links.context);this._updateContextIfRequired(e.body.data,e.body.last_event_id)}return this.context}async setTtl(e){r.validateMandatoryTtl(e);try{const t={ttl:e},n=await this.services.network.post(this.uri,t);this.descriptor.date_expires=n.body.date_expires}catch(t){throw 404===t.status&&this.onRemoved(!1),t}}async setItemTtl(e,t){r.validateMandatoryTtl(t);let n=await this.get(e);const i={ttl:t},s=await this.services.network.post(n.uri,i);n.updateDateExpires(s.body.date_expires)}async removeList(){await this.services.network.delete(this.uri),this.onRemoved(!0)}onRemoved(e){this._unsubscribe(),this.removalHandler(this.type,this.sid,this.uniqueName),this.broadcastEventToListeners("removed",{isLocal:e})}shouldIgnoreEvent(e,t){return this.cache.isKnown(e,t)}_update(e,t){const n=Number(e.item_index);switch(e.date_created=new Date(e.date_created),e.type){case"list_item_added":case"list_item_updated":this._handleItemMutated(n,e.item_url,e.id,e.item_revision,e.item_data,e.date_created,void 0,"list_item_added"===e.type,!0);break;case"list_item_removed":this._handleItemRemoved(n,e.id,e.item_data,e.date_created,!0);break;case"list_context_updated":this._handleContextUpdate(e.context_data,e.id,e.date_created);break;case"list_removed":this.onRemoved(!1)}t&&this._advanceLastEventId(e.id,e.list_revision)}_advanceLastEventId(e,t){this.lastEventId<e&&(this.descriptor.last_event_id=e,t&&(this.descriptor.revision=t))}_updateRootDateUpdated(e){(!this.descriptor.date_updated||e.getTime()>this.descriptor.date_updated.getTime())&&(this.descriptor.date_updated=e,this.services.storage.update(this.type,this.sid,this.uniqueName,{date_updated:e}))}_handleItemMutated(e,t,n,r,i,s,o,c,l){if(this.shouldIgnoreEvent(e,n))a.default.trace("Item ",e," update skipped, current:",this.lastEventId,", remote:",n);else{this._updateRootDateUpdated(s);let a=this.cache.get(e);if(a)a.update(n,r,i,s),this.cache.store(e,a,n),void 0!==o&&a.updateDateExpires(o),this.emitItemMutationEvent(a,l,!1);else{let a=new u.ListItem({index:e,uri:t,lastEventId:n,revision:r,value:i,dateUpdated:s,dateExpires:o});this.cache.store(e,a,n),this.emitItemMutationEvent(a,l,c)}}}emitItemMutationEvent(e,t,n){this.broadcastEventToListeners(n?"itemAdded":"itemUpdated",{item:e,isLocal:!t})}_handleItemRemoved(e,t,n,r,i){this._updateRootDateUpdated(r),this.cache.delete(e,t),this.broadcastEventToListeners("itemRemoved",{index:e,isLocal:!i,value:n})}_handleContextUpdate(e,t,n){this._updateRootDateUpdated(n),this._updateContextIfRequired(e,t)&&this.broadcastEventToListeners("contextUpdated",{context:e,isLocal:!1})}_updateContextIfRequired(e,t){return!this.contextEventId||t>this.contextEventId?(this.context=e,this.contextEventId=t,!0):(a.default.trace("Context update skipped, current:",this.lastEventId,", remote:",t),!1)}}t.SyncListImpl=f;class p extends h.default{constructor(e){super(),this.syncListImpl=e,this.syncListImpl.attach(this)}get uri(){return this.syncListImpl.uri}get revision(){return this.syncListImpl.revision}get lastEventId(){return this.syncListImpl.lastEventId}get links(){return this.syncListImpl.links}get dateExpires(){return this.syncListImpl.dateExpires}static get type(){return f.type}get type(){return f.type}get sid(){return this.syncListImpl.sid}get uniqueName(){return this.syncListImpl.uniqueName}get dateUpdated(){return this.syncListImpl.dateUpdated}async push(e,t){return this.ensureNotClosed(),this.syncListImpl.push(e,t)}async set(e,t,n){return this.ensureNotClosed(),this.syncListImpl.set(e,t,n)}async mutate(e,t,n){return this.ensureNotClosed(),this.syncListImpl.mutate(e,t,n)}async update(e,t,n){return this.ensureNotClosed(),this.syncListImpl.update(e,t,n)}async remove(e){return this.ensureNotClosed(),this.syncListImpl.remove(e)}async get(e){return this.ensureNotClosed(),this.syncListImpl.get(e)}async getContext(){return this.ensureNotClosed(),this.syncListImpl.getContext()}async getItems(e){return this.ensureNotClosed(),this.syncListImpl.getItems(e)}async setTtl(e){return this.ensureNotClosed(),this.syncListImpl.setTtl(e)}async setItemTtl(e,t){return this.ensureNotClosed(),this.syncListImpl.setItemTtl(e,t)}async removeList(){return this.ensureNotClosed(),this.syncListImpl.removeList()}close(){super.close(),this.syncListImpl.detach(this.listenerUuid)}}t.SyncList=p,t.default=p},WLcV:function(e,t,n){var r=n("nwbp"),i=n("KQtV");e.exports=function(e,t,n){var s=t&&n||0;"string"==typeof e&&(t="binary"===e?new Array(16):null,e=null);var a=(e=e||{}).random||(e.rng||r)();if(a[6]=15&a[6]|64,a[8]=63&a[8]|128,t)for(var o=0;o<16;++o)t[s+o]=a[o];return t||i(a)}},WOjp:function(e,t,n){"use strict";var r=n("Vzpu");function i(e){var t,n;this.promise=new e((function(e,r){if(void 0!==t||void 0!==n)throw TypeError("Bad Promise constructor");t=e,n=r})),this.resolve=r(t),this.reject=r(n)}e.exports.f=function(e){return new i(e)}},Wnek:function(e,t,n){var r=n("wGyb");e.exports=function(e,t){return new(r(e))(t)}},XUND:function(e,t,n){e.exports={default:n("HoF5"),__esModule:!0}},XWhX:function(e,t,n){"use strict";var r=n("ObEa"),i=n("ApsS"),s=n("dptC"),a=n("DIWJ"),o=n("MrWc"),u=n("aAA+"),c=Object.assign;e.exports=!c||n("7S/a")((function(){var e={},t={},n=Symbol(),r="abcdefghijklmnopqrst";return e[n]=7,r.split("").forEach((function(e){t[e]=e})),7!=c({},e)[n]||Object.keys(c({},t)).join("")!=r}))?function(e,t){for(var n=o(e),c=arguments.length,l=1,d=s.f,h=a.f;c>l;)for(var f,p=u(arguments[l++]),m=d?i(p).concat(d(p)):i(p),y=m.length,v=0;y>v;)f=m[v++],r&&!h.call(p,f)||(n[f]=p[f]);return n}:c},XXPQ:function(e,t,n){"use strict";var r,i=(r=n("aq5/"))&&r.__esModule?r:{default:r};Object.defineProperty(t,"__esModule",{value:!0}),t.SyncListDescriptor=function e(t){(0,i.default)(this,e),this.descriptor=t,this.channel_sid=t.channel_sid,this.status=t.status,this.channel=t.channel,this.messages=t.messages,this.roster=t.roster,this.lastConsumedMessageIndex=t.last_consumed_message_index,this.notificationLevel=t.notification_level,this.status=t.status}},XaWT:function(e,t,n){e.exports={default:n("4iaB"),__esModule:!0}},XdyU:function(e,t,n){var r,i;!function(s,a){"use strict";void 0===(i="function"==typeof(r=function(){var e=function(){},t="undefined"!=typeof window&&void 0!==window.navigator&&/Trident\/|MSIE /.test(window.navigator.userAgent),n=["trace","debug","info","warn","error"];function r(e,t){var n=e[t];if("function"==typeof n.bind)return n.bind(e);try{return Function.prototype.bind.call(n,e)}catch(r){return function(){return Function.prototype.apply.apply(n,[e,arguments])}}}function i(){console.log&&(console.log.apply?console.log.apply(console,arguments):Function.prototype.apply.apply(console.log,[console,arguments])),console.trace&&console.trace()}function s(n){return"debug"===n&&(n="log"),"undefined"!=typeof console&&("trace"===n&&t?i:void 0!==console[n]?r(console,n):void 0!==console.log?r(console,"log"):e)}function a(t,r){for(var i=0;i<n.length;i++){var s=n[i];this[s]=i<t?e:this.methodFactory(s,t,r)}this.log=this.debug}function o(e,t,n){return function(){"undefined"!=typeof console&&(a.call(this,t,n),this[e].apply(this,arguments))}}function u(e,t,n){return s(e)||o.apply(this,arguments)}function c(e,t,r){var i,s=this,o="loglevel";function c(){var e;if("undefined"!=typeof window){try{e=window.localStorage[o]}catch(r){}if(void 0===e)try{var t=window.document.cookie,n=t.indexOf(encodeURIComponent(o)+"=");-1!==n&&(e=/^([^;]+)/.exec(t.slice(n))[1])}catch(r){}return void 0===s.levels[e]&&(e=void 0),e}}e&&(o+=":"+e),s.name=e,s.levels={TRACE:0,DEBUG:1,INFO:2,WARN:3,ERROR:4,SILENT:5},s.methodFactory=r||u,s.getLevel=function(){return i},s.setLevel=function(t,r){if("string"==typeof t&&void 0!==s.levels[t.toUpperCase()]&&(t=s.levels[t.toUpperCase()]),!("number"==typeof t&&t>=0&&t<=s.levels.SILENT))throw"log.setLevel() called with invalid level: "+t;if(i=t,!1!==r&&function(e){var t=(n[e]||"silent").toUpperCase();if("undefined"!=typeof window){try{return void(window.localStorage[o]=t)}catch(r){}try{window.document.cookie=encodeURIComponent(o)+"="+t+";"}catch(r){}}}(t),a.call(s,t,e),"undefined"==typeof console&&t<s.levels.SILENT)return"No console available for logging"},s.setDefaultLevel=function(e){c()||s.setLevel(e,!1)},s.enableAll=function(e){s.setLevel(s.levels.TRACE,e)},s.disableAll=function(e){s.setLevel(s.levels.SILENT,e)};var l=c();null==l&&(l=null==t?"WARN":t),s.setLevel(l,!1)}var l=new c,d={};l.getLogger=function(e){if("string"!=typeof e||""===e)throw new TypeError("You must supply a name when creating a logger.");var t=d[e];return t||(t=d[e]=new c(e,l.getLevel(),l.methodFactory)),t};var h="undefined"!=typeof window?window.log:void 0;return l.noConflict=function(){return"undefined"!=typeof window&&window.log===l&&(window.log=h),l},l.getLoggers=function(){return d},l})?r.call(t,n,t,e):r)||(e.exports=i)}()},Xfc8:function(e,t,n){"use strict";var r=s(n("aq5/")),i=s(n("4Mt5"));function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var a=n("CPx3"),o=n("cDQD"),u=a.Logger.scope("ChannelDescriptor");function c(e){try{return new Date(e)}catch(t){return null}}var l=function(){function e(t,n){(0,r.default)(this,e),this.client=t,this.descriptor=n,n.sid?(this.sid=n.sid,this.channel=n.sid+".channel"):(this.sid=n.channel_sid,this.channel=n.channel_sid+".channel"),this.uniqueName=n.unique_name,this.friendlyName=n.friendly_name,this.attributes=function(e){try{return JSON.parse(e)}catch(t){u.warn("Failed to parse channel attributes",t)}return{}}(n.attributes),this.createdBy=n.created_by,this.dateCreated=c(n.date_created),this.dateUpdated=c(n.date_updated),this.messagesCount=n.messages_count,this.membersCount=n.members_count,this.type=n.type,this.isPrivate="private"==n.type,this.lastConsumedMessageIndex=n.last_consumed_message_index,n.notification_level&&(this.notificationLevel=n.notification_level),this.status=n.status?o.filterStatus(n.status):"unknown"}return(0,i.default)(e,[{key:"getChannel",value:function(){return this.client.getChannelBySid(this.sid)}}]),e}();t.ChannelDescriptor=l},Xmnl:function(e,t,n){"use strict";var r=f(n("XUND")),i=f(n("qCKU")),s=f(n("tgXR")),a=f(n("IhEH")),o=f(n("u2rs")),u=f(n("Rhu4")),c=f(n("aq5/")),l=f(n("4Mt5")),d=f(n("7xyS")),h=f(n("k2Qk"));function f(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var p=n("r2q8"),m=n("CPx3"),y=n("Y5Gq"),v=m.Logger.scope("Messages"),g=function(e){function t(e,n){(0,c.default)(this,t);var r=(0,d.default)(this,(t.__proto__||(0,u.default)(t)).call(this));return r.channel=e,r.services=n,r.messagesByIndex=new o.default,r.messagesListPromise=null,r}var n,f,p;return(0,h.default)(t,e),(0,l.default)(t,[{key:"subscribe",value:function(e){var t=this;return this.messagesListPromise=this.messagesListPromise||this.services.syncClient.list({id:e,mode:"open_existing"}).then((function(e){return e.on("itemAdded",(function(e){v.debug(t.channel.sid+" itemAdded: "+e.item.index);var n=new y.Message(t.channel,t.services,e.item.index,e.item.value);t.messagesByIndex.has(n.index)?v.debug("Message arrived, but already known and ignored",t.channel.sid,n.index):(t.messagesByIndex.set(n.index,n),n.on("updated",(function(e){return t.emit("messageUpdated",e)})),t.emit("messageAdded",n))})),e.on("itemRemoved",(function(e){v.debug(t.channel.sid+" itemRemoved: "+e.index);var n=e.index;if(t.messagesByIndex.has(n)){var r=t.messagesByIndex.get(n);t.messagesByIndex.delete(r.index),r.removeAllListeners("updated"),t.emit("messageRemoved",r)}})),e.on("itemUpdated",(function(e){v.debug(t.channel.sid+" itemUpdated: "+e.item.index);var n=t.messagesByIndex.get(e.item.index);n&&n._update(e.item.value)})),e})).catch((function(e){throw t.messagesListPromise=null,"disconnected"!=t.services.syncClient.connectionState&&v.error("Failed to get messages object for channel",t.channel.sid,e),v.debug("ERROR: Failed to get messages object for channel",t.channel.sid,e),e}))}},{key:"unsubscribe",value:(p=(0,a.default)(s.default.mark((function e(){return s.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.messagesListPromise){e.next=6;break}return e.next=3,this.messagesListPromise;case 3:e.sent.close(),this.messagesListPromise=null;case 6:case"end":return e.stop()}}),e,this)}))),function(){return p.apply(this,arguments)})},{key:"send",value:(f=(0,a.default)(s.default.mark((function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return s.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(v.debug("Sending text message",t,n),null!==n){e.next=3;break}throw new Error("Attributes can't be null");case 3:if(n.constructor===Object){e.next=5;break}throw new Error("Attributes must be a valid JSON object");case 5:return e.abrupt("return",this.services.session.addCommand("sendMessage",{channelSid:this.channel.sid,text:t,attributes:(0,i.default)(n)}));case 6:case"end":return e.stop()}}),e,this)}))),function(e){return f.apply(this,arguments)})},{key:"sendMedia",value:(n=(0,a.default)(s.default.mark((function e(t){var n,r,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return s.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(v.debug("Sending media message",t,a),a.constructor===Object){e.next=3;break}throw new Error("Attributes must be a valid JSON object");case 3:if(n=void 0,!("undefined"!=typeof FormData&&t instanceof FormData)){e.next=11;break}return v.debug("Sending media message as FormData",t,a),e.next=8,this.services.mcsClient.postFormData(t);case 8:n=e.sent,e.next=18;break;case 11:if(v.debug("Sending media message as SendMediaOptions",t,a),(r=t).contentType&&r.media){e.next=15;break}throw new Error("Media content <Channel#SendMediaOptions> must contain non-empty contentType and media");case 15:return e.next=17,this.services.mcsClient.post(r.contentType,r.media);case 17:n=e.sent;case 18:return e.abrupt("return",this.services.session.addCommand("sendMediaMessage",{channelSid:this.channel.sid,mediaSid:n.sid,attributes:(0,i.default)(a)}));case 19:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"getMessages",value:function(e,t,n){return this._getMessages(e,t=void 0!==t?t:"end",n=n||"backwards")}},{key:"wrapPaginator",value:function(e,t,n){var r=this,i="desc"===e,s=function(){return t.nextPage().then((function(t){return r.wrapPaginator(e,t,n)}))},a=function(){return t.prevPage().then((function(t){return r.wrapPaginator(e,t,n)}))};return n(t.items).then((function(e){return{items:e.sort((function(e,t){return e.index-t.index})),hasPrevPage:i?t.hasNextPage:t.hasPrevPage,hasNextPage:i?t.hasPrevPage:t.hasNextPage,prevPage:i?s:a,nextPage:i?a:s}}))}},{key:"_upsertMessage",value:function(e,t){var n=this,r=this.messagesByIndex.get(e);if(r)return r;var i=new y.Message(this.channel,this.services,e,t);return this.messagesByIndex.set(i.index,i),i.on("updated",(function(e){return n.emit("messageUpdated",e)})),i}},{key:"_getMessages",value:function(e,t,n){var i=this;t=void 0!==t?t:"end",e=e||30;var s="backwards"===n?"desc":"asc";return this.messagesListPromise.then((function(n){return n.getItems({from:"end"!==t?t:void 0,pageSize:e,order:s})})).then((function(e){return i.wrapPaginator(s,e,(function(e){return r.default.all(e.map((function(e){return i._upsertMessage(e.index,e.value)})))}))}))}}]),t}(p.EventEmitter);t.Messages=g},Xs3C:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n("CmQt");t.Metadata=class{static getMetadata(e){"undefined"!=typeof navigator&&r.parse(navigator.userAgent);let t=e&&e.clientMetadata?e.clientMetadata:{};const n={env:r.name,envv:r.version,os:r.os.family,osv:r.os.version,osa:r.os.architecture,sdk:"js-default"};let i={};return["ver","env","envv","os","osv","osa","type","sdk","sdkv","dev","devv","devt","app","appv"].filter(e=>e in t||e in n).forEach(e=>i[e]=e in t?t[e]:n[e]),i}}},"Y+Rv":function(e,t,n){"use strict";var r,i,s,a,o=n("UtsQ"),u=n("hR4s"),c=n("dWRk"),l=n("M25K"),d=n("IFjL"),h=n("vbc5"),f=n("Vzpu"),p=n("s0lH"),m=n("9v8s"),y=n("SmK6"),v=n("CmYO").set,g=n("6YAS")(),b=n("WOjp"),w=n("y7sZ"),_=n("QwS4"),k=n("Y0Jp"),x=u.TypeError,S=u.process,C=S&&S.versions,M=C&&C.v8||"",E=u.Promise,T="process"==l(S),I=function(){},P=i=b.f,O=!!function(){try{var e=E.resolve(1),t=(e.constructor={})[n("eD9m")("species")]=function(e){e(I,I)};return(T||"function"==typeof PromiseRejectionEvent)&&e.then(I)instanceof t&&0!==M.indexOf("6.6")&&-1===_.indexOf("Chrome/66")}catch(r){}}(),R=function(e){var t;return!(!h(e)||"function"!=typeof(t=e.then))&&t},N=function(e,t){if(!e._n){e._n=!0;var n=e._c;g((function(){for(var r=e._v,i=1==e._s,s=0,a=function(t){var n,s,a,o=i?t.ok:t.fail,u=t.resolve,c=t.reject,l=t.domain;try{o?(i||(2==e._h&&L(e),e._h=1),!0===o?n=r:(l&&l.enter(),n=o(r),l&&(l.exit(),a=!0)),n===t.promise?c(x("Promise-chain cycle")):(s=R(n))?s.call(n,u,c):u(n)):c(r)}catch(d){l&&!a&&l.exit(),c(d)}};n.length>s;)a(n[s++]);e._c=[],e._n=!1,t&&!e._h&&j(e)}))}},j=function(e){v.call(u,(function(){var t,n,r,i=e._v,s=U(e);if(s&&(t=w((function(){T?S.emit("unhandledRejection",i,e):(n=u.onunhandledrejection)?n({promise:e,reason:i}):(r=u.console)&&r.error&&r.error("Unhandled promise rejection",i)})),e._h=T||U(e)?2:1),e._a=void 0,s&&t.e)throw t.v}))},U=function(e){return 1!==e._h&&0===(e._a||e._c).length},L=function(e){v.call(u,(function(){var t;T?S.emit("rejectionHandled",e):(t=u.onrejectionhandled)&&t({promise:e,reason:e._v})}))},D=function(e){var t=this;t._d||(t._d=!0,(t=t._w||t)._v=e,t._s=2,t._a||(t._a=t._c.slice()),N(t,!0))},q=function(e){var t,n=this;if(!n._d){n._d=!0,n=n._w||n;try{if(n===e)throw x("Promise can't be resolved itself");(t=R(e))?g((function(){var r={_w:n,_d:!1};try{t.call(e,c(q,r,1),c(D,r,1))}catch(i){D.call(r,i)}})):(n._v=e,n._s=1,N(n,!1))}catch(r){D.call({_w:n,_d:!1},r)}}};O||(E=function(e){p(this,E,"Promise","_h"),f(e),r.call(this);try{e(c(q,this,1),c(D,this,1))}catch(t){D.call(this,t)}},(r=function(e){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1}).prototype=n("qa3O")(E.prototype,{then:function(e,t){var n=P(y(this,E));return n.ok="function"!=typeof e||e,n.fail="function"==typeof t&&t,n.domain=T?S.domain:void 0,this._c.push(n),this._a&&this._a.push(n),this._s&&N(this,!1),n.promise},catch:function(e){return this.then(void 0,e)}}),s=function(){var e=new r;this.promise=e,this.resolve=c(q,e,1),this.reject=c(D,e,1)},b.f=P=function(e){return e===E||e===a?new s(e):i(e)}),d(d.G+d.W+d.F*!O,{Promise:E}),n("KnMe")(E,"Promise"),n("Jn7W")("Promise"),a=n("rFq9").Promise,d(d.S+d.F*!O,"Promise",{reject:function(e){var t=P(this);return(0,t.reject)(e),t.promise}}),d(d.S+d.F*(o||!O),"Promise",{resolve:function(e){return k(o&&this===a?E:this,e)}}),d(d.S+d.F*!(O&&n("EWHn")((function(e){E.all(e).catch(I)}))),"Promise",{all:function(e){var t=this,n=P(t),r=n.resolve,i=n.reject,s=w((function(){var n=[],s=0,a=1;m(e,!1,(function(e){var o=s++,u=!1;n.push(void 0),a++,t.resolve(e).then((function(e){u||(u=!0,n[o]=e,--a||r(n))}),i)})),--a||r(n)}));return s.e&&i(s.v),n.promise},race:function(e){var t=this,n=P(t),r=n.reject,i=w((function(){m(e,!1,(function(e){t.resolve(e).then(n.resolve,r)}))}));return i.e&&r(i.v),n.promise}})},Y0Jp:function(e,t,n){var r=n("8fQz"),i=n("vbc5"),s=n("WOjp");e.exports=function(e,t){if(r(e),i(t)&&t.constructor===e)return t;var n=s.f(e);return(0,n.resolve)(t),n.promise}},Y5Gq:function(e,t,n){"use strict";var r=d(n("qCKU")),i=d(n("tgXR")),s=d(n("IhEH")),a=d(n("Rhu4")),o=d(n("aq5/")),u=d(n("4Mt5")),c=d(n("7xyS")),l=d(n("k2Qk"));function d(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var h=n("r2q8"),f=n("RtQP"),p=n("CPx3"),m=n("qPgj"),y=p.Logger.scope("Message");function v(e,t){try{return t?JSON.parse(t):{}}catch(n){return y.warn("Got malformed attributes for the message",e),{}}}var g=function(e){function t(e,n,r,i){(0,o.default)(this,t);var s=(0,c.default)(this,(t.__proto__||(0,a.default)(t)).call(this));return s.channel=e,s.services=n,s.state={sid:i.sid,index:r,author:null==i.author?null:i.author,body:i.text,timestamp:i.timestamp?new Date(i.timestamp):null,dateUpdated:i.dateUpdated?new Date(i.dateUpdated):null,lastUpdatedBy:i.lastUpdatedBy?i.lastUpdatedBy:null,attributes:v(i.sid,i.attributes),type:i.type?i.type:"text",media:i.type&&"media"===i.type&&i.media?new m.Media(i.media,s.services):null,memberSid:null==i.memberSid?null:i.memberSid},s}var n,d,h,p;return(0,l.default)(t,e),(0,u.default)(t,[{key:"_update",value:function(e){var t=[];!e.text&&"string"!=typeof e.text||e.text===this.state.body||(this.state.body=e.text,t.push("body")),e.lastUpdatedBy&&e.lastUpdatedBy!==this.state.lastUpdatedBy&&(this.state.lastUpdatedBy=e.lastUpdatedBy,t.push("lastUpdatedBy")),e.author&&e.author!==this.state.author&&(this.state.author=e.author,t.push("author")),e.dateUpdated&&new Date(e.dateUpdated).getTime()!==(this.state.dateUpdated&&this.state.dateUpdated.getTime())&&(this.state.dateUpdated=new Date(e.dateUpdated),t.push("dateUpdated")),e.timestamp&&new Date(e.timestamp).getTime()!==(this.state.timestamp&&this.state.timestamp.getTime())&&(this.state.timestamp=new Date(e.timestamp),t.push("timestamp"));var n=v(this.sid,e.attributes);f.isDeepEqual(this.state.attributes,n)||(this.state.attributes=n,t.push("attributes")),t.length>0&&this.emit("updated",{message:this,updateReasons:t})}},{key:"getMember",value:(p=(0,s.default)(i.default.mark((function e(){var t,n,r=this;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=null,!this.state.memberSid){e.next=5;break}return e.next=4,this.channel.getMemberBySid(this.memberSid).catch((function(){return y.debug('Member with sid "'+r.memberSid+'" not found for message '+r.sid),null}));case 4:t=e.sent;case 5:if(t||!this.state.author){e.next=9;break}return e.next=8,this.channel.getMemberByIdentity(this.state.author).catch((function(){return y.debug('Member with identity "'+r.author+'" not found for message '+r.sid),null}));case 8:t=e.sent;case 9:if(!t){e.next=11;break}return e.abrupt("return",t);case 11:throw n="Member with ",this.state.memberSid&&(n+="SID '"+this.state.memberSid+"' "),this.state.author&&(this.state.memberSid&&(n+="or "),n+="identity '"+this.state.author+"' "),"Member with "===n&&(n="Member "),n+="was not found",new Error(n);case 17:case"end":return e.stop()}}),e,this)}))),function(){return p.apply(this,arguments)})},{key:"remove",value:(h=(0,s.default)(i.default.mark((function e(){return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.session.addCommand("deleteMessage",{channelSid:this.channel.sid,messageIdx:this.index.toString()});case 2:return e.abrupt("return",this);case 3:case"end":return e.stop()}}),e,this)}))),function(){return h.apply(this,arguments)})},{key:"updateBody",value:(d=(0,s.default)(i.default.mark((function e(t){return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t){e.next=2;break}throw new Error("Body <String> is a required parameter for updateBody");case 2:return e.next=4,this.services.session.addCommand("editMessage",{channelSid:this.channel.sid,messageIdx:this.index.toString(),text:t});case 4:return e.abrupt("return",this);case 5:case"end":return e.stop()}}),e,this)}))),function(e){return d.apply(this,arguments)})},{key:"updateAttributes",value:(n=(0,s.default)(i.default.mark((function e(t){return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==t){e.next=4;break}throw new Error("Attributes is required parameter");case 4:if(null!==t){e.next=8;break}throw new Error("Attributes can't be null");case 8:if(t.constructor===Object){e.next=10;break}throw new Error("Attributes must be a valid JSON object");case 10:return e.next=12,this.services.session.addCommand("editMessageAttributes",{channelSid:this.channel.sid,messageIdx:this.index,attributes:(0,r.default)(t)});case 12:return e.abrupt("return",this);case 13:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"sid",get:function(){return this.state.sid}},{key:"author",get:function(){return this.state.author}},{key:"body",get:function(){return"media"===this.type?null:this.state.body}},{key:"dateUpdated",get:function(){return this.state.dateUpdated}},{key:"index",get:function(){return this.state.index}},{key:"lastUpdatedBy",get:function(){return this.state.lastUpdatedBy}},{key:"timestamp",get:function(){return this.state.timestamp}},{key:"attributes",get:function(){return this.state.attributes}},{key:"type",get:function(){return this.state.type}},{key:"media",get:function(){return this.state.media}},{key:"memberSid",get:function(){return this.state.memberSid}}]),t}(h.EventEmitter);t.Message=g},"YR+c":function(e,t,n){"use strict";var r=n("IFjL"),i=n("WOjp"),s=n("y7sZ");r(r.S,"Promise",{try:function(e){var t=i.f(this),n=s(e);return(n.e?t.reject:t.resolve)(n.v),t.promise}})},YVtA:function(e,t){var n={}.hasOwnProperty;e.exports=function(e,t){return n.call(e,t)}},Yquk:function(e,t,n){"use strict";var r=s(n("aq5/")),i=s(n("4Mt5"));function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var a=n("CPx3").Logger.scope("UserDescriptor"),o=function(){function e(t,n){(0,r.default)(this,e),this.services=t,this.descriptor=n,this.identity=n.identity,this.friendlyName=n.friendly_name,this.attributes=function(e){try{return JSON.parse(e)}catch(t){a.warn("Failed to parse user attributes",t)}return{}}(n.attributes),this.online=n.is_online,this.notifiable=n.is_notifiable}return(0,i.default)(e,[{key:"subscribe",value:function(){return this.services.users.getUser(this.identity,this.descriptor.sync_unique_name)}},{key:"_getDescriptor",value:function(){return this.descriptor}}]),e}();t.UserDescriptor=o},ZYEu:function(e,t,n){"use strict";var r=a(n("XUND")),i=a(n("aq5/")),s=a(n("4Mt5"));function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(t,n,r,s){(0,i.default)(this,e),this.state={prevToken:r,nextToken:s,source:n,items:t}}return(0,s.default)(e,[{key:"nextPage",value:function(){return this.hasNextPage?this.state.source(this.state.nextToken):r.default.reject(new Error("No next page"))}},{key:"prevPage",value:function(){return this.hasPrevPage?this.state.source(this.state.prevToken):r.default.reject(new Error("No previous page"))}},{key:"hasNextPage",get:function(){return!!this.state.nextToken}},{key:"hasPrevPage",get:function(){return!!this.state.prevToken}},{key:"items",get:function(){return this.state.items}}]),e}();t.RestPaginator=o},ZvXT:function(e,t,n){"use strict";var r=h(n("tgXR")),i=h(n("IhEH")),s=h(n("XUND")),a=h(n("QDM+")),o=h(n("B3Ab")),u=h(n("CafK")),c=h(n("u2rs")),l=h(n("aq5/")),d=h(n("4Mt5"));function h(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var f=n("qXWz"),p=function(){function e(t,n){var r=this;(0,l.default)(this,e),this.config=t,this.services=n,this.cache=new c.default,this.cacheLifetime=0,this.services.session.getHttpCacheInterval().then((function(e){r.cacheLifetime=1e3*e,r.cleanupCache()}))}var t;return(0,d.default)(e,[{key:"backoffConfig",value:function(){return(0,u.default)(this.config.backoffConfigDefault,this.config.backoffConfigOverride)}},{key:"retryWhenThrottled",value:function(){return void 0!==this.config.retryWhenThrottledOverride?this.config.retryWhenThrottledOverride:void 0!==this.config.retryWhenThrottledDefault&&this.config.retryWhenThrottledDefault}},{key:"isExpired",value:function(e){return!this.cacheLifetime||Date.now()-e>this.cacheLifetime}},{key:"cleanupCache",value:function(){var e=!0,t=!1,n=void 0;try{for(var r,i=(0,a.default)(this.cache);!(e=(r=i.next()).done);e=!0){var s=(0,o.default)(r.value,2),u=s[0];this.isExpired(s[1].timestamp)&&this.cache.delete(u)}}catch(c){t=!0,n=c}finally{try{!e&&i.return&&i.return()}finally{if(t)throw n}}0===this.cache.size&&clearInterval(this.timer)}},{key:"pokeTimer",value:function(){var e=this;this.timer=this.timer||setInterval((function(){return e.cleanupCache()}),2*this.cacheLifetime)}},{key:"executeWithRetry",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return new s.default((function(r,i){var s=[502,503,504];n&&s.push(429);var a=new f.Retrier(t.backoffConfig());a.on("attempt",(function(){e().then((function(e){return a.succeeded(e)})).catch((function(e){s.indexOf(e.status)>-1||"Twilsock disconnected"===e.message?a.failed(e):(a.removeAllListeners(),a.cancel(),i(e))}))})),a.on("succeeded",(function(e){r(e)})),a.on("cancelled",(function(e){return i(e)})),a.on("failed",(function(e){return i(e)})),a.start()}))}},{key:"get",value:(t=(0,i.default)(r.default.mark((function e(t){var n,i,s,a=this;return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(n=this.cache.get(t))||this.isExpired(n.timestamp)){e.next=3;break}return e.abrupt("return",n.response);case 3:return i={},e.next=6,this.executeWithRetry((function(){return a.services.transport.get(t,i)}),this.retryWhenThrottled());case 6:return this.cache.set(t,{response:s=e.sent,timestamp:Date.now()}),this.pokeTimer(),e.abrupt("return",s);case 10:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})}]),e}();t.Network=p},a4io:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Media=class{constructor(e,t,n){this.config=e,this.network=t,this._update(n)}get sid(){return this.state.sid}get serviceSid(){return this.state.serviceSid}get dateCreated(){return this.state.dateCreated}get dateUpdated(){return this.state.dateUpdated}get contentType(){return this.state.contentType}get size(){return this.state.size}get fileName(){return this.state.filename}async getContentUrl(){let e=await this.network.get(`${this.config.baseUrl}/${this.sid}`);return this._update(e.body),Promise.resolve(this.state.contentDirectUrl)}_update(e){this.state={sid:e.sid,serviceSid:e.service_sid,channelSid:e.channel_sid,messageSid:e.message_sid,dateCreated:e.date_created?new Date(e.date_created):null,dateUpdated:e.date_updated?new Date(e.date_updated):null,size:e.size,contentType:e.content_type,url:e.url,contentUrl:e.links.content,contentDirectUrl:e.links.content_direct_temporary,filename:e.filename?e.filename:null}}}},"aAA+":function(e,t,n){var r=n("e7fL");e.exports=Object("z").propertyIsEnumerable(0)?Object:function(e){return"String"==r(e)?e.split(""):Object(e)}},aMvW:function(e,t,n){var r=n("JId3"),i=n("n40k"),s=i;s.v1=r,s.v4=i,e.exports=s},aRFn:function(e,t,n){var r=n("b1KM")("meta"),i=n("vbc5"),s=n("YVtA"),a=n("UwCj").f,o=0,u=Object.isExtensible||function(){return!0},c=!n("7S/a")((function(){return u(Object.preventExtensions({}))})),l=function(e){a(e,r,{value:{i:"O"+ ++o,w:{}}})},d=e.exports={KEY:r,NEED:!1,fastKey:function(e,t){if(!i(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!s(e,r)){if(!u(e))return"F";if(!t)return"E";l(e)}return e[r].i},getWeak:function(e,t){if(!s(e,r)){if(!u(e))return!0;if(!t)return!1;l(e)}return e[r].w},onFreeze:function(e){return c&&d.NEED&&u(e)&&!s(e,r)&&l(e),e}}},aSQu:function(e,t,n){"use strict";var r=n("IFjL"),i=n("rFq9"),s=n("hR4s"),a=n("SmK6"),o=n("Y0Jp");r(r.P+r.R,"Promise",{finally:function(e){var t=a(this,i.Promise||s.Promise),n="function"==typeof e;return this.then(n?function(n){return o(t,e()).then((function(){return n}))}:e,n?function(n){return o(t,e()).then((function(){throw n}))}:e)}})},aYSr:function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},"aq5/":function(e,t,n){"use strict";t.__esModule=!0,t.default=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}},ax0Y:function(e,t,n){var r=n("YVtA"),i=n("MrWc"),s=n("ubhL")("IE_PROTO"),a=Object.prototype;e.exports=Object.getPrototypeOf||function(e){return e=i(e),r(e,s)?e[s]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?a:null}},b1KM:function(e,t){var n=0,r=Math.random();e.exports=function(e){return"Symbol(".concat(void 0===e?"":e,")_",(++n+r).toString(36))}},b95h:function(e,t,n){var r=n("UwCj"),i=n("jHgz");e.exports=n("ObEa")?function(e,t,n){return r.f(e,t,i(1,n))}:function(e,t,n){return e[t]=n,e}},bDMy:function(e,t,n){var r;r=function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.i=function(e){return e},n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:r})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=5)}([function(e,t,n){"use strict";e.exports=function(e,t){var n,r,i;for(n=1;n<arguments.length;n++)for(i in r=arguments[n])r.hasOwnProperty(i)&&(e[i]=r[i]);return e}},function(e,t,n){"use strict";var r=n(0);e.exports={build:function(e,t){var n,i,s,a=t.plugins;for(n=0,i=a.length;n<i;n++)(s=a[n]).methods&&r(e,s.methods),s.properties&&Object.defineProperties(e,s.properties)},hook:function(e,t,n){var r,i,s,a=e.config.plugins,o=[e.context];for(n&&(o=o.concat(n)),r=0,i=a.length;r<i;r++)(s=a[r][t])&&s.apply(a[r],o)}}},function(e,t,n){"use strict";function r(e){if(0===e.length)return e;var t,n,r=e.split(/[_-]/);if(1===r.length&&r[0][0].toLowerCase()===r[0][0])return e;for(n=r[0].toLowerCase(),t=1;t<r.length;t++)n=n+r[t].charAt(0).toUpperCase()+r[t].substring(1).toLowerCase();return n}r.prepended=function(e,t){return e+(t=r(t))[0].toUpperCase()+t.substring(1)},e.exports=r},function(e,t,n){"use strict";var r=n(0),i=n(2);function s(e,t){this.options=e=e||{},this.defaults=t.defaults,this.states=[],this.transitions=[],this.map={},this.lifecycle=this.configureLifecycle(),this.init=this.configureInitTransition(e.init),this.data=this.configureData(e.data),this.methods=this.configureMethods(e.methods),this.map[this.defaults.wildcard]={},this.configureTransitions(e.transitions||[]),this.plugins=this.configurePlugins(e.plugins,t.plugin)}r(s.prototype,{addState:function(e){this.map[e]||(this.states.push(e),this.addStateLifecycleNames(e),this.map[e]={})},addStateLifecycleNames:function(e){this.lifecycle.onEnter[e]=i.prepended("onEnter",e),this.lifecycle.onLeave[e]=i.prepended("onLeave",e),this.lifecycle.on[e]=i.prepended("on",e)},addTransition:function(e){this.transitions.indexOf(e)<0&&(this.transitions.push(e),this.addTransitionLifecycleNames(e))},addTransitionLifecycleNames:function(e){this.lifecycle.onBefore[e]=i.prepended("onBefore",e),this.lifecycle.onAfter[e]=i.prepended("onAfter",e),this.lifecycle.on[e]=i.prepended("on",e)},mapTransition:function(e){var t=e.name,n=e.from,r=e.to;return this.addState(n),"function"!=typeof r&&this.addState(r),this.addTransition(t),this.map[n][t]=e,e},configureLifecycle:function(){return{onBefore:{transition:"onBeforeTransition"},onAfter:{transition:"onAfterTransition"},onEnter:{state:"onEnterState"},onLeave:{state:"onLeaveState"},on:{transition:"onTransition"}}},configureInitTransition:function(e){return"string"==typeof e?this.mapTransition(r({},this.defaults.init,{to:e,active:!0})):"object"==typeof e?this.mapTransition(r({},this.defaults.init,e,{active:!0})):(this.addState(this.defaults.init.from),this.defaults.init)},configureData:function(e){return"function"==typeof e?e:"object"==typeof e?function(){return e}:function(){return{}}},configureMethods:function(e){return e||{}},configurePlugins:function(e,t){var n,r,i;for(n=0,r=(e=e||[]).length;n<r;n++)"function"==typeof(i=e[n])&&(e[n]=i=i()),i.configure&&i.configure(this);return e},configureTransitions:function(e){var t,n,r,i,s,a=this.defaults.wildcard;for(n=0;n<e.length;n++)for(r=e[n],i=Array.isArray(r.from)?r.from:[r.from||a],s=r.to||a,t=0;t<i.length;t++)this.mapTransition({name:r.name,from:i[t],to:s})},transitionFor:function(e,t){return this.map[e][t]||this.map[this.defaults.wildcard][t]},transitionsFor:function(e){var t=this.defaults.wildcard;return Object.keys(this.map[e]).concat(Object.keys(this.map[t]))},allStates:function(){return this.states},allTransitions:function(){return this.transitions}}),e.exports=s},function(e,t,n){var r=n(0),i=n(6),s=n(1),a=[null,[]];function o(e,t){this.context=e,this.config=t,this.state=t.init.from,this.observers=[e]}r(o.prototype,{init:function(e){if(r(this.context,this.config.data.apply(this.context,e)),s.hook(this,"init"),this.config.init.active)return this.fire(this.config.init.name,[])},is:function(e){return Array.isArray(e)?e.indexOf(this.state)>=0:this.state===e},isPending:function(){return this.pending},can:function(e){return!this.isPending()&&!!this.seek(e)},cannot:function(e){return!this.can(e)},allStates:function(){return this.config.allStates()},allTransitions:function(){return this.config.allTransitions()},transitions:function(){return this.config.transitionsFor(this.state)},seek:function(e,t){var n=this.config.defaults.wildcard,r=this.config.transitionFor(this.state,e),i=r&&r.to;return"function"==typeof i?i.apply(this.context,t):i===n?this.state:i},fire:function(e,t){return this.transit(e,this.state,this.seek(e,t),t)},transit:function(e,t,n,r){var i=this.config.lifecycle,s=this.config.options.observeUnchangedState||t!==n;return n?this.isPending()?this.context.onPendingTransition(e,t,n):(this.config.addState(n),this.beginTransit(),r.unshift({transition:e,from:t,to:n,fsm:this.context}),this.observeEvents([this.observersForEvent(i.onBefore.transition),this.observersForEvent(i.onBefore[e]),s?this.observersForEvent(i.onLeave.state):a,s?this.observersForEvent(i.onLeave[t]):a,this.observersForEvent(i.on.transition),s?["doTransit",[this]]:a,s?this.observersForEvent(i.onEnter.state):a,s?this.observersForEvent(i.onEnter[n]):a,s?this.observersForEvent(i.on[n]):a,this.observersForEvent(i.onAfter.transition),this.observersForEvent(i.onAfter[e]),this.observersForEvent(i.on[e])],r)):this.context.onInvalidTransition(e,t,n)},beginTransit:function(){this.pending=!0},endTransit:function(e){return this.pending=!1,e},failTransit:function(e){throw this.pending=!1,e},doTransit:function(e){this.state=e.to},observe:function(e){if(2===e.length){var t={};t[e[0]]=e[1],this.observers.push(t)}else this.observers.push(e[0])},observersForEvent:function(e){for(var t,n=0,r=this.observers.length,i=[];n<r;n++)(t=this.observers[n])[e]&&i.push(t);return[e,i,!0]},observeEvents:function(e,t,n,r){if(0===e.length)return this.endTransit(void 0===r||r);var i=e[0][0],a=e[0][1],o=e[0][2];if(t[0].event=i,i&&o&&i!==n&&s.hook(this,"lifecycle",t),0===a.length)return e.shift(),this.observeEvents(e,t,i,r);var u=a.shift(),c=u[i].apply(u,t);return c&&"function"==typeof c.then?c.then(this.observeEvents.bind(this,e,t,i)).catch(this.failTransit.bind(this)):!1===c?this.endTransit(!1):this.observeEvents(e,t,i,c)},onInvalidTransition:function(e,t,n){throw new i("transition is invalid in current state",e,t,n,this.state)},onPendingTransition:function(e,t,n){throw new i("transition is invalid while previous transition is still in progress",e,t,n,this.state)}}),e.exports=o},function(e,t,n){"use strict";var r=n(0),i=n(2),s=n(1),a=n(3),o=n(4),u={is:function(e){return this._fsm.is(e)},can:function(e){return this._fsm.can(e)},cannot:function(e){return this._fsm.cannot(e)},observe:function(){return this._fsm.observe(arguments)},transitions:function(){return this._fsm.transitions()},allTransitions:function(){return this._fsm.allTransitions()},allStates:function(){return this._fsm.allStates()},onInvalidTransition:function(e,t,n){return this._fsm.onInvalidTransition(e,t,n)},onPendingTransition:function(e,t,n){return this._fsm.onPendingTransition(e,t,n)}},c={state:{configurable:!1,enumerable:!0,get:function(){return this._fsm.state},set:function(e){throw Error("use transitions to change state")}}};function l(e){return d(this||{},e)}function d(e,t){return h(e,new a(t,l)),e._fsm(),e}function h(e,t){if("object"!=typeof e||Array.isArray(e))throw Error("StateMachine can only be applied to objects");s.build(e,t),Object.defineProperties(e,c),r(e,u),r(e,t.methods),t.allTransitions().forEach((function(t){e[i(t)]=function(){return this._fsm.fire(t,[].slice.call(arguments))}})),e._fsm=function(){this._fsm=new o(this,t),this._fsm.init(arguments)}}l.version="3.0.1",l.factory=function(){var e,t;"function"==typeof arguments[0]?(e=arguments[0],t=arguments[1]||{}):(e=function(){this._fsm.apply(this,arguments)},t=arguments[0]||{});var n=new a(t,l);return h(e.prototype,n),e.prototype._fsm.config=n,e},l.apply=d,l.defaults={wildcard:"*",init:{name:"init",from:"none"}},e.exports=l},function(e,t,n){"use strict";e.exports=function(e,t,n,r,i){this.message=e,this.transition=t,this.from=n,this.to=r,this.current=i}}])},e.exports=r()},"c/HT":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n("SbVi");t.TransportUnavailableError=class extends r.TwilsockError{constructor(e){super(e)}}},cDQD:function(e,t,n){"use strict";var r=m(n("QDM+")),i=m(n("tgXR")),s=m(n("XUND")),a=m(n("IhEH")),o=m(n("u2rs")),u=m(n("qCKU")),c=m(n("hjYm")),l=m(n("Rhu4")),d=m(n("aq5/")),h=m(n("4Mt5")),f=m(n("7xyS")),p=m(n("k2Qk"));function m(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var y=n("r2q8"),v=n("CPx3"),g=n("qRjN"),b=n("s5eF"),w=n("Xmnl"),_=n("RtQP"),k=v.Logger.scope("Channel"),x={lastMessage:"lastMessage",attributes:"attributes",createdBy:"createdBy",dateCreated:"dateCreated",dateUpdated:"dateUpdated",friendlyName:"friendlyName",lastConsumedMessageIndex:"lastConsumedMessageIndex",notificationLevel:"notificationLevel",sid:"sid",status:"status",type:"type",uniqueName:"uniqueName"};function S(e){try{return new Date(e)}catch(t){return null}}function C(e){switch(e){case"notParticipating":return"known";default:return e}}t.filterStatus=C;var M=function(e){function t(e,n,r){(0,d.default)(this,t);var i=(0,f.default)(this,(t.__proto__||(0,l.default)(t)).call(this)),s=n.attributes||{},a=n.createdBy,h=S(n.dateCreated),p=S(n.dateUpdated),m=n.friendlyName||null,y=(0,c.default)(n.lastConsumedMessageIndex)?n.lastConsumedMessageIndex:null,v=n.uniqueName||null;try{(0,u.default)(s)}catch(b){throw new Error("Attributes must be a valid JSON object.")}return i.services=e,i.sid=r,i.entityName=n.channel,i.state={uniqueName:v,status:"known",type:n.type,attributes:s,createdBy:a,dateCreated:h,dateUpdated:p,friendlyName:m,lastConsumedMessageIndex:y},n.notificationLevel&&(i.state.notificationLevel=n.notificationLevel),i.members=new o.default,i.membersEntity=new g.Members(i,i.services,i.members),i.membersEntity.on("memberJoined",i.emit.bind(i,"memberJoined")),i.membersEntity.on("memberLeft",i.emit.bind(i,"memberLeft")),i.membersEntity.on("memberUpdated",(function(e){return i.emit("memberUpdated",e)})),i.messagesEntity=new w.Messages(i,e),i.messagesEntity.on("messageAdded",(function(e){return i._onMessageAdded(e)})),i.messagesEntity.on("messageUpdated",(function(e){return i.emit("messageUpdated",e)})),i.messagesEntity.on("messageRemoved",i.emit.bind(i,"messageRemoved")),i}var n,m,y,v,M,E,T,I,P,O,R,N,j,U,L,D,q,A,F,B,W,z,H,Q,X,J,K;return(0,p.default)(t,e),(0,h.default)(t,[{key:"_subscribe",value:function(){var e=this;return this.entityPromise?this.entityPromise:this.entityPromise=this.entityPromise||this.services.syncClient.document({id:this.entityName,mode:"open_existing"}).then((function(t){return e.entity=t,e.entity.on("updated",(function(t){e._update(t.value)})),e.entity.on("removed",(function(){return e.emit("removed",e)})),e._update(e.entity.value),t})).catch((function(t){throw e.entity=null,e.entityPromise=null,"disconnected"!=e.services.syncClient.connectionState&&k.error("Failed to get channel object",t),k.debug("ERROR: Failed to get channel object",t),t}))}},{key:"_subscribeStreams",value:(K=(0,a.default)(i.default.mark((function e(){var t,n;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this._subscribe();case 3:return k.trace("_subscribeStreams, this.entity.value=",this.entity.value),t=this.entity.value.messages,n=this.entity.value.roster,e.next=8,s.default.all([this.messagesEntity.subscribe(t),this.membersEntity.subscribe(n)]);case 8:e.next=15;break;case 10:throw e.prev=10,e.t0=e.catch(0),"disconnected"!==this.services.syncClient.connectionState&&k.error("Failed to subscribe on channel objects",this.sid,e.t0),k.debug("ERROR: Failed to subscribe on channel objects",this.sid,e.t0),e.t0;case 15:case"end":return e.stop()}}),e,this,[[0,10]])}))),function(){return K.apply(this,arguments)})},{key:"_unsubscribe",value:(J=(0,a.default)(i.default.mark((function e(){return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isPrivate||!this.entity){e.next=5;break}return e.next=3,this.entity.close();case 3:this.entity=null,this.entityPromise=null;case 5:return e.abrupt("return",s.default.all([this.membersEntity.unsubscribe(),this.messagesEntity.unsubscribe()]));case 6:case"end":return e.stop()}}),e,this)}))),function(){return J.apply(this,arguments)})},{key:"_setStatus",value:function(e,t){var n=this;this.statusSource=t,this.state.status!==e&&(this.state.status=e,"joined"===e?this._subscribeStreams().catch((function(t){if(k.debug("ERROR while setting channel status "+e,t),"disconnected"!==n.services.syncClient.connectionState)throw t})):"invited"===e?this._subscribe().catch((function(t){if(k.debug("ERROR while setting channel status "+e,t),"disconnected"!==n.services.syncClient.connectionState)throw t})):this.entityPromise&&this._unsubscribe().catch((function(t){if(k.debug("ERROR while setting channel status "+e,t),"disconnected"!==n.services.syncClient.connectionState)throw t})))}},{key:"_statusSource",value:function(){return this.statusSource}},{key:"_update",value:function(e){k.trace("_update",e);var n=[];for(var r in t.preprocessUpdate(e,this.sid),e){var i=x[r];if(i)if(i===x.status)e.status&&"unknown"!=e.status&&this.state.status!==C(e.status)&&(this.state.status=C(e.status),n.push(i));else if(i===x.attributes)_.isDeepEqual(this.state.attributes,e.attributes)||(this.state.attributes=e.attributes,n.push(i));else if(i===x.lastConsumedMessageIndex)void 0!==e.lastConsumedMessageIndex&&e.lastConsumedMessageIndex!==this.state.lastConsumedMessageIndex&&(this.state.lastConsumedMessageIndex=e.lastConsumedMessageIndex,n.push(i));else if(i===x.lastMessage){var s=!1;this.state.lastMessage&&!e.lastMessage?(delete this.state.lastMessage,s=!0):(this.state.lastMessage||(this.state.lastMessage={}),e.lastMessage&&void 0!==e.lastMessage.index&&e.lastMessage.index!==this.state.lastMessage.index&&(this.state.lastMessage.index=e.lastMessage.index,s=!0),!e.lastMessage||!e.lastMessage.timestamp||this.state.lastMessage.timestamp&&this.state.lastMessage.timestamp.getTime()===e.lastMessage.timestamp.getTime()||(this.state.lastMessage.timestamp=e.lastMessage.timestamp,s=!0),_.isDeepEqual(this.state.lastMessage,{})&&delete this.state.lastMessage),s&&n.push(i)}else e[r]instanceof Date?this.state[i]&&this.state[i].getTime()===e[r].getTime()||(this.state[i]=e[r],n.push(i)):this[i]!==e[r]&&(this.state[i]=e[r],n.push(i))}n.length>0&&this.emit("updated",{channel:this,updateReasons:n})}},{key:"_onMessageAdded",value:function(e){var t=!0,n=!1,i=void 0;try{for(var s,a=(0,r.default)(this.members.values());!(t=(s=a.next()).done);t=!0){var o=s.value;if(o.identity===e.author){o._endTyping();break}}}catch(u){n=!0,i=u}finally{try{!t&&a.return&&a.return()}finally{if(n)throw i}}this.emit("messageAdded",e)}},{key:"add",value:(X=(0,a.default)(i.default.mark((function e(t){return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t&&"string"==typeof t){e.next=2;break}throw new Error("Channel.add requires an <String>identity parameter");case 2:return e.abrupt("return",this.membersEntity.add(t));case 3:case"end":return e.stop()}}),e,this)}))),function(e){return X.apply(this,arguments)})},{key:"advanceLastConsumedMessageIndex",value:(Q=(0,a.default)(i.default.mark((function e(t){return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((0,c.default)(t)){e.next=2;break}throw new Error("Channel.advanceLastConsumedMessageIndex requires an integral <Number>index parameter");case 2:return e.next=4,this._subscribeStreams();case 4:return e.abrupt("return",this.services.consumptionHorizon.advanceLastConsumedMessageIndexForChannel(this.sid,t,this.lastConsumedMessageIndex));case 5:case"end":return e.stop()}}),e,this)}))),function(e){return Q.apply(this,arguments)})},{key:"decline",value:(H=(0,a.default)(i.default.mark((function e(){return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.session.addCommand("declineInvitation",{channelSid:this.sid});case 2:return e.abrupt("return",this);case 3:case"end":return e.stop()}}),e,this)}))),function(){return H.apply(this,arguments)})},{key:"delete",value:(z=(0,a.default)(i.default.mark((function e(){return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.session.addCommand("destroyChannel",{channelSid:this.sid});case 2:return e.abrupt("return",this);case 3:case"end":return e.stop()}}),e,this)}))),function(){return z.apply(this,arguments)})},{key:"getAttributes",value:(W=(0,a.default)(i.default.mark((function e(){return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._subscribe();case 2:return e.abrupt("return",this.attributes);case 3:case"end":return e.stop()}}),e,this)}))),function(){return W.apply(this,arguments)})},{key:"getMessages",value:(B=(0,a.default)(i.default.mark((function e(t,n,r){return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0===n||(0,c.default)(n)){e.next=2;break}throw new Error("Anchor should be a valid message index");case 2:return e.next=4,this._subscribeStreams();case 4:return e.abrupt("return",this.messagesEntity.getMessages(t,n,r));case 5:case"end":return e.stop()}}),e,this)}))),function(e,t,n){return B.apply(this,arguments)})},{key:"getMembers",value:(F=(0,a.default)(i.default.mark((function e(){return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._subscribeStreams();case 2:return e.abrupt("return",this.membersEntity.getMembers());case 3:case"end":return e.stop()}}),e,this)}))),function(){return F.apply(this,arguments)})},{key:"getMembersCount",value:(A=(0,a.default)(i.default.mark((function e(){var t;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.session.getSessionLinks();case 2:return t=new _.UriBuilder(e.sent.publicChannelsUrl).path(this.sid).build(),e.next=6,this.services.network.get(t);case 6:return e.abrupt("return",e.sent.body.members_count);case 8:case"end":return e.stop()}}),e,this)}))),function(){return A.apply(this,arguments)})},{key:"getMemberBySid",value:(q=(0,a.default)(i.default.mark((function e(t){return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t&&"string"==typeof t){e.next=2;break}throw new Error("Channel.getMemberBySid requires a <String>memberSid parameter");case 2:return e.abrupt("return",this.membersEntity.getMemberBySid(t));case 3:case"end":return e.stop()}}),e,this)}))),function(e){return q.apply(this,arguments)})},{key:"getMemberByIdentity",value:(D=(0,a.default)(i.default.mark((function e(t){return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t&&"string"==typeof t){e.next=2;break}throw new Error("Channel.getMemberByIdentity requires a <String>identity parameter");case 2:return e.abrupt("return",this.membersEntity.getMemberByIdentity(t));case 3:case"end":return e.stop()}}),e,this)}))),function(e){return D.apply(this,arguments)})},{key:"getMessagesCount",value:(L=(0,a.default)(i.default.mark((function e(){var t;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.session.getSessionLinks();case 2:return t=new _.UriBuilder(e.sent.publicChannelsUrl).path(this.sid).build(),e.next=6,this.services.network.get(t);case 6:return e.abrupt("return",e.sent.body.messages_count);case 8:case"end":return e.stop()}}),e,this)}))),function(){return L.apply(this,arguments)})},{key:"getUnconsumedMessagesCount",value:(U=(0,a.default)(i.default.mark((function e(){var t,n;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.session.getSessionLinks();case 2:return t=new _.UriBuilder(e.sent.myChannelsUrl).arg("ChannelSid",this.sid).build(),e.next=6,this.services.network.get(t);case 6:if(!(n=e.sent).body.channels.length||n.body.channels[0].channel_sid!=this.sid){e.next=11;break}if(void 0===n.body.channels[0].unread_messages_count||null==n.body.channels[0].unread_messages_count){e.next=10;break}return e.abrupt("return",n.body.channels[0].unread_messages_count);case 10:return e.abrupt("return",null);case 11:throw new Error("Channel is not in user channels list");case 12:case"end":return e.stop()}}),e,this)}))),function(){return U.apply(this,arguments)})},{key:"invite",value:(j=(0,a.default)(i.default.mark((function e(t){return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("string"==typeof t&&t.length){e.next=2;break}throw new Error("Channel.invite requires an <String>identity parameter");case 2:return e.next=4,this.membersEntity.invite(t);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return j.apply(this,arguments)})},{key:"join",value:(N=(0,a.default)(i.default.mark((function e(){return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.services.session.addCommand("joinChannelV2",{channelSid:this.sid});case 2:return e.abrupt("return",this);case 3:case"end":return e.stop()}}),e,this)}))),function(){return N.apply(this,arguments)})},{key:"leave",value:(R=(0,a.default)(i.default.mark((function e(){return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("joined"!==this.state.status){e.next=3;break}return e.next=3,this.services.session.addCommand("leaveChannel",{channelSid:this.sid});case 3:return e.abrupt("return",this);case 4:case"end":return e.stop()}}),e,this)}))),function(){return R.apply(this,arguments)})},{key:"removeMember",value:(O=(0,a.default)(i.default.mark((function e(t){return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t&&("string"==typeof t||t instanceof b.Member)){e.next=2;break}throw new Error("Channel.removeMember requires a <String|Member>member parameter.");case 2:if(!(t instanceof b.Member)){e.next=7;break}return e.next=5,this.membersEntity.removeBySid(t.sid);case 5:e.next=9;break;case 7:return e.next=9,this.membersEntity.removeByIdentity(t);case 9:case"end":return e.stop()}}),e,this)}))),function(e){return O.apply(this,arguments)})},{key:"sendMessage",value:(P=(0,a.default)(i.default.mark((function e(t,n){return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==t){e.next=2;break}throw new Error("Message is required parameter");case 2:if("string"!=typeof t&&null!==t){e.next=9;break}return e.next=5,this.messagesEntity.send(t,n);case 5:return e.abrupt("return",_.parseToNumber(e.sent.messageId));case 9:return e.next=11,this.messagesEntity.sendMedia(t,n);case 11:return e.abrupt("return",_.parseToNumber(e.sent.messageId));case 13:case"end":return e.stop()}}),e,this)}))),function(e,t){return P.apply(this,arguments)})},{key:"setAllMessagesConsumed",value:(I=(0,a.default)(i.default.mark((function e(){var t;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._subscribeStreams();case 2:return e.next=4,this.getMessages(1);case 4:if(!((t=e.sent).items.length>0)){e.next=7;break}return e.abrupt("return",this.advanceLastConsumedMessageIndex(t.items[0].index));case 7:return e.abrupt("return",s.default.resolve(0));case 8:case"end":return e.stop()}}),e,this)}))),function(){return I.apply(this,arguments)})},{key:"setNoMessagesConsumed",value:(T=(0,a.default)(i.default.mark((function e(){return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._subscribeStreams();case 2:return e.abrupt("return",this.services.consumptionHorizon.updateLastConsumedMessageIndexForChannel(this.sid,null));case 3:case"end":return e.stop()}}),e,this)}))),function(){return T.apply(this,arguments)})},{key:"setUserNotificationLevel",value:(E=(0,a.default)(i.default.mark((function e(t){return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}throw new Error("notificationLevel can't be null");case 2:return e.next=4,this.services.session.addCommand("editNotificationLevel",{channelSid:this.sid,notificationLevel:t});case 4:case"end":return e.stop()}}),e,this)}))),function(e){return E.apply(this,arguments)})},{key:"typing",value:function(){return this.services.typingIndicator.send(this.sid)}},{key:"updateAttributes",value:(M=(0,a.default)(i.default.mark((function e(t){return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==t){e.next=4;break}throw new Error("Attributes is required parameter");case 4:if(null!==t){e.next=8;break}throw new Error("Attributes can't be null");case 8:if(t.constructor===Object){e.next=10;break}throw new Error("Attributes must be a valid JSON object.");case 10:return e.next=12,this.services.session.addCommand("editAttributes",{channelSid:this.sid,attributes:(0,u.default)(t)});case 12:return e.abrupt("return",this);case 13:case"end":return e.stop()}}),e,this)}))),function(e){return M.apply(this,arguments)})},{key:"updateFriendlyName",value:(v=(0,a.default)(i.default.mark((function e(t){return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.state.friendlyName===t){e.next=3;break}return e.next=3,this.services.session.addCommand("editFriendlyName",{channelSid:this.sid,friendlyName:t});case 3:return e.abrupt("return",this);case 4:case"end":return e.stop()}}),e,this)}))),function(e){return v.apply(this,arguments)})},{key:"updateLastConsumedMessageIndex",value:(y=(0,a.default)(i.default.mark((function e(t){return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((0,c.default)(t)||null===t){e.next=2;break}throw new Error('Incorrect argument "index": integer number or null expected');case 2:return e.next=4,this._subscribeStreams();case 4:return e.abrupt("return",this.services.consumptionHorizon.updateLastConsumedMessageIndexForChannel(this.sid,t));case 5:case"end":return e.stop()}}),e,this)}))),function(e){return y.apply(this,arguments)})},{key:"updateUniqueName",value:(m=(0,a.default)(i.default.mark((function e(t){return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.state.uniqueName===t){e.next=4;break}return t||(t=""),e.next=4,this.services.session.addCommand("editUniqueName",{channelSid:this.sid,uniqueName:t});case 4:return e.abrupt("return",this);case 5:case"end":return e.stop()}}),e,this)}))),function(e){return m.apply(this,arguments)})},{key:"getUserDescriptors",value:(n=(0,a.default)(i.default.mark((function e(){return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.services.users.getChannelUserDescriptors(this.sid));case 1:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"status",get:function(){return this.state.status}},{key:"type",get:function(){return this.state.type}},{key:"uniqueName",get:function(){return this.state.uniqueName}},{key:"isPrivate",get:function(){return"private"===this.state.type}},{key:"friendlyName",get:function(){return this.state.friendlyName}},{key:"dateUpdated",get:function(){return this.state.dateUpdated}},{key:"dateCreated",get:function(){return this.state.dateCreated}},{key:"createdBy",get:function(){return this.state.createdBy}},{key:"attributes",get:function(){return this.state.attributes}},{key:"lastConsumedMessageIndex",get:function(){return this.state.lastConsumedMessageIndex}},{key:"lastMessage",get:function(){return this.state.lastMessage}},{key:"notificationLevel",get:function(){return this.state.notificationLevel}}],[{key:"preprocessUpdate",value:function(e,t){try{"string"==typeof e.attributes?e.attributes=JSON.parse(e.attributes):e.attributes&&(0,u.default)(e.attributes)}catch(n){k.warn("Retrieved malformed attributes from the server for channel: "+t),e.attributes={}}try{e.dateCreated&&(e.dateCreated=new Date(e.dateCreated))}catch(n){k.warn("Retrieved malformed dateCreated from the server for channel: "+t),delete e.dateCreated}try{e.dateUpdated&&(e.dateUpdated=new Date(e.dateUpdated))}catch(n){k.warn("Retrieved malformed dateUpdated from the server for channel: "+t),delete e.dateUpdated}try{e.lastMessage&&e.lastMessage.timestamp&&(e.lastMessage.timestamp=new Date(e.lastMessage.timestamp))}catch(n){k.warn("Retrieved malformed lastMessage.timestamp from the server for channel: "+t),delete e.lastMessage.timestamp}}}]),t}(y.EventEmitter);t.Channel=M},cvX4:function(e,t,n){var r=n("IFjL");r(r.P+r.R,"Set",{toJSON:n("KIy9")("Set")})},d5Ah:function(e,t,n){n("/r3m"),n("qqHg"),e.exports=n("rFq9").Array.from},dSFd:function(e,t,n){"use strict";var r=o(n("XUND")),i=o(n("u2rs")),s=o(n("4Mt5")),a=o(n("aq5/"));function o(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var u=n("dWBN"),c=function(){function e(t){(0,a.default)(this,e),this.services=t,this.consumptionHorizonRequests=new i.default,this.consumptionHorizonUpdateTimer=null}return(0,s.default)(e,[{key:"getReportInterval",value:function(){return this.services.session.getConsumptionReportInterval().then((function(e){return 1e3*e}))}},{key:"delayedSendConsumptionHorizon",value:function(e){var t=this;null===this.consumptionHorizonUpdateTimer&&(this.sendConsumptionReport(!0),this.consumptionHorizonUpdateTimer=setTimeout((function(){t.sendConsumptionReport(!1)}),e))}},{key:"sendConsumptionReport",value:function(e){var t=this,n=[],r=new i.default;this.consumptionHorizonRequests.forEach((function(e,t){n.push(e.entry),r.set(t,e.promises)})),n.length>0&&this.services.session.addCommand("consumptionReportV2",{report:n}).then((function(e){return t.processConsumptionReportResponse(e,r)})).catch((function(e){return t.processConsumptionReportError(e,r)})),e||(this.consumptionHorizonUpdateTimer=null),this.consumptionHorizonRequests.clear()}},{key:"processConsumptionReportResponse",value:function(e,t){e&&e.report&&Array.isArray(e.report)&&e.report.length>0&&e.report.forEach((function(e){var n=e;if(t.has(n.channelSid)){var r=null;void 0!==n.unreadMessagesCount&&null!=n.unreadMessagesCount&&(r=n.unreadMessagesCount),t.get(n.channelSid).forEach((function(e){return e.resolve(r)})),t.delete(n.channelSid)}})),this.processConsumptionReportError(new u.SessionError("Error while setting LastConsumedMessageIndex",null),t)}},{key:"processConsumptionReportError",value:function(e,t){t.forEach((function(t){return t.forEach((function(t){return t.reject(e)}))}))}},{key:"updateLastConsumedMessageIndexForChannel",value:function(e,t){var n=this;return new r.default((function(r,i){n.addPendingConsumptionHorizonRequest(e,{channelSid:e,messageIdx:t},{resolve:r,reject:i}),n.getReportInterval().then((function(e){return n.delayedSendConsumptionHorizon(e)}))}))}},{key:"advanceLastConsumedMessageIndexForChannel",value:function(e,t,n){var i=this,s=this.consumptionHorizonRequests.get(e);return new r.default((function(r,a){i.addPendingConsumptionHorizonRequest(e,s&&s.entry?s.entry.messageIdx>=t?s.entry:{channelSid:e,messageIdx:t}:null!==n&&t<n?{channelSid:e,messageIdx:n}:{channelSid:e,messageIdx:t},{resolve:r,reject:a}),i.getReportInterval().then((function(e){return i.delayedSendConsumptionHorizon(e)}))}))}},{key:"addPendingConsumptionHorizonRequest",value:function(e,t,n){if(this.consumptionHorizonRequests.has(e)){var r=this.consumptionHorizonRequests.get(e);r.entry=t,r.promises.push(n)}else this.consumptionHorizonRequests.set(e,{entry:t,promises:[n]})}}]),e}();t.ConsumptionHorizon=c},dUHx:function(e,t){},dWBN:function(e,t,n){"use strict";var r=d(n("XaWT")),i=d(n("p2b6")),s=d(n("oPEB")),a=d(n("5JVr")),o=d(n("Rhu4")),u=d(n("aq5/")),c=d(n("7xyS")),l=d(n("k2Qk"));function d(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var h=function(e){function t(e,n){(0,u.default)(this,t);var r=(0,c.default)(this,(t.__proto__||(0,o.default)(t)).call(this));return r.name=r.constructor.name,r.message=e,r.code=n,Error.captureStackTrace?Error.captureStackTrace(r,r.constructor):r.stack=(new Error).stack,r}return(0,l.default)(t,e),t}(function(e){function t(){var t=(0,a.default)(e,(0,s.default)(arguments));return(0,i.default)(t,(0,o.default)(this)),t}return t.prototype=(0,r.default)(e.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),i.default?(0,i.default)(t,e):t.__proto__=e,t}(Error));t.SessionError=h},dWRk:function(e,t,n){var r=n("Vzpu");e.exports=function(e,t,n){if(r(e),void 0===t)return e;switch(n){case 1:return function(n){return e.call(t,n)};case 2:return function(n,r){return e.call(t,n,r)};case 3:return function(n,r,i){return e.call(t,n,r,i)}}return function(){return e.apply(t,arguments)}}},dWcX:function(e,t,n){t.f=n("eD9m")},dptC:function(e,t){t.f=Object.getOwnPropertySymbols},"e/PS":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n("r2q8"),i=n("Sqfg");class s extends r.EventEmitter{constructor(){super(),this.closed=!1,this.uuid=i()}get listenerUuid(){return this.uuid}close(){this.removeAllListeners(),this.closed=!0}ensureNotClosed(){if(this.closed)throw new Error("Invalid operation on closed object")}}t.Closeable=s,t.default=s},e5bQ:function(e,t,n){e.exports={default:n("CHRr"),__esModule:!0}},e7fL:function(e,t){var n={}.toString;e.exports=function(e){return n.call(e).slice(8,-1)}},eD9m:function(e,t,n){var r=n("kz3d")("wks"),i=n("b1KM"),s=n("hR4s").Symbol,a="function"==typeof s;(e.exports=function(e){return r[e]||(r[e]=a&&s[e]||(a?s:i)("Symbol."+e))}).store=r},fawX:function(e,t,n){var r=n("tReM"),i=n("eD9m")("iterator"),s=Array.prototype;e.exports=function(e){return void 0!==e&&(r.Array===e||s[i]===e)}},fquK:function(e,t,n){"use strict";var r=n("Vzpu"),i=n("vbc5"),s=n("IAQa"),a=[].slice,o={},u=function(e,t,n){if(!(t in o)){for(var r=[],i=0;i<t;i++)r[i]="a["+i+"]";o[t]=Function("F,a","return new F("+r.join(",")+")")}return o[t](e,n)};e.exports=Function.bind||function(e){var t=r(this),n=a.call(arguments,1),o=function(){var r=n.concat(a.call(arguments));return this instanceof o?u(t,r.length,r):s(t,r,e)};return i(t.prototype)&&(o.prototype=t.prototype),o}},"gNE/":function(e,t,n){var r=n("e7fL");e.exports=Array.isArray||function(e){return"Array"==r(e)}},gSK9:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n("SbVi");t.TwilsockReplyError=class extends r.TwilsockError{constructor(e,t){super(e),this.reply=t}}},"gm/K":function(e,t){var n="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(n){var r=new Uint8Array(16);e.exports=function(){return n(r),r}}else{var i=new Array(16);e.exports=function(){for(var e,t=0;t<16;t++)0==(3&t)&&(e=4294967296*Math.random()),i[t]=e>>>((3&t)<<3)&255;return i}}},grU3:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Configuration=class{constructor(e,t={}){let n=t.notifications||{};this.registrarUrl=n.ersUrl||`https://ers.${n.region||t.region||"us1"}.twilio.com/v1/registrations`,this._token=e}updateToken(e){this._token=e}get token(){return this._token}}},guEv:function(e,t){e.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},hR4s:function(e,t){var n=e.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=n)},hjYm:function(e,t,n){e.exports={default:n("P0Gn"),__esModule:!0}},hoXw:function(e,t){var n="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(n){var r=new Uint8Array(16);e.exports=function(){return n(r),r}}else{var i=new Array(16);e.exports=function(){for(var e,t=0;t<16;t++)0==(3&t)&&(e=4294967296*Math.random()),i[t]=e>>>((3&t)<<3)&255;return i}}},hsRX:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n("BHqR");t.Message=class extends r.AbstractMessage{constructor(e,t,n){super(),this.method="message",this.active_grant=e,this.payload_type=t,this.http_request=n}}},iBdP:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n("r2q8"),i=n("N8HJ");t.WebSocketChannel=class extends r.EventEmitter{constructor(e){super(),this.url=e,this.WebSocket=global.WebSocket||global.MozWebSocket||n(4)}get isConnected(){return this.socket&&1===this.socket.readyState}connect(){i.log.trace("connecting to socket");let e=new this.WebSocket(this.url);e.binaryType="arraybuffer",e.onopen=()=>{i.log.debug(`socket opened ${this.url}`),this.emit("connected")},e.onclose=e=>{i.log.debug("socket closed",e),this.emit("disconnected",e)},e.onerror=e=>{i.log.debug("error:",e),this.emit("socketError",e)},e.onmessage=e=>{this.emit("message",e.data)},this.socket=e}send(e){this.socket.send(e)}close(){if(i.log.trace("closing socket"),this.socket){this.socket.onopen=null,this.socket.onclose=null,this.socket.onerror=null,this.socket.onmessage=null;try{this.socket.close()}finally{}}}}},iaOj:function(e,t,n){"use strict";var r=n("IFjL");e.exports=function(e){r(r.S,e,{of:function(){for(var e=arguments.length,t=new Array(e);e--;)t[e]=arguments[e];return new this(t)}})}},ihyG:function(e,t,n){"use strict";function r(e){return e.replace(/~1/g,"/").replace(/~0/g,"~")}function i(e){return e.replace(/~/g,"~0").replace(/\//g,"~1")}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e){void 0===e&&(e=[""]),this.tokens=e}return e.fromJSON=function(t){var n=t.split("/").map(r);if(""!==n[0])throw new Error("Invalid JSON Pointer: "+t);return new e(n)},e.prototype.toString=function(){return this.tokens.map(i).join("/")},e.prototype.evaluate=function(e){for(var t=null,n="",r=e,i=1,s=this.tokens.length;i<s;i++)r=((t=r)||{})[n=this.tokens[i]];return{parent:t,key:n,value:r}},e.prototype.get=function(e){return this.evaluate(e).value},e.prototype.set=function(e,t){for(var n=e,r=1,i=this.tokens.length-1,s=this.tokens[r];r<i;r++)n=(n||{})[s];n&&(n[this.tokens[this.tokens.length-1]]=t)},e.prototype.push=function(e){this.tokens.push(e)},e.prototype.add=function(t){return new e(this.tokens.concat(String(t)))},e}();t.Pointer=s},"j/aJ":function(e,t,n){"use strict";var r=n("wOJj"),i=n("MIMp"),s=n("tReM"),a=n("Hs7Z");e.exports=n("S49y")(Array,"Array",(function(e,t){this._t=a(e),this._i=0,this._k=t}),(function(){var e=this._t,t=this._k,n=this._i++;return!e||n>=e.length?(this._t=void 0,i(1)):i(0,"keys"==t?n:"values"==t?e[n]:[n,e[n]])}),"values"),s.Arguments=s.Array,r("keys"),r("values"),r("entries")},jHgz:function(e,t){e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},jIkG:function(e,t,n){var r,i,s=n("nwbp"),a=n("KQtV"),o=0,u=0;e.exports=function(e,t,n){var c=t&&n||0,l=t||[],d=(e=e||{}).node||r,h=void 0!==e.clockseq?e.clockseq:i;if(null==d||null==h){var f=s();null==d&&(d=r=[1|f[0],f[1],f[2],f[3],f[4],f[5]]),null==h&&(h=i=16383&(f[6]<<8|f[7]))}var p=void 0!==e.msecs?e.msecs:(new Date).getTime(),m=void 0!==e.nsecs?e.nsecs:u+1,y=p-o+(m-u)/1e4;if(y<0&&void 0===e.clockseq&&(h=h+1&16383),(y<0||p>o)&&void 0===e.nsecs&&(m=0),m>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");o=p,u=m,i=h;var v=(1e4*(268435455&(p+=122192928e5))+m)%4294967296;l[c++]=v>>>24&255,l[c++]=v>>>16&255,l[c++]=v>>>8&255,l[c++]=255&v;var g=p/4294967296*1e4&268435455;l[c++]=g>>>8&255,l[c++]=255&g,l[c++]=g>>>24&15|16,l[c++]=g>>>16&255,l[c++]=h>>>8|128,l[c++]=255&h;for(var b=0;b<6;++b)l[c+b]=d[b];return t||a(l)}},jJPU:function(e,t,n){var r=n("hoXw"),i=n("5YqI");e.exports=function(e,t,n){var s=t&&n||0;"string"==typeof e&&(t="binary"===e?new Array(16):null,e=null);var a=(e=e||{}).random||(e.rng||r)();if(a[6]=15&a[6]|64,a[8]=63&a[8]|128,t)for(var o=0;o<16;++o)t[s+o]=a[o];return t||i(a)}},k2Qk:function(e,t,n){"use strict";t.__esModule=!0;var r=a(n("p2b6")),i=a(n("XaWT")),s=a(n("2tcU"));function a(e){return e&&e.__esModule?e:{default:e}}t.default=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+(void 0===t?"undefined":(0,s.default)(t)));e.prototype=(0,i.default)(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(r.default?(0,r.default)(e,t):e.__proto__=t)}},kGNy:function(e,t,n){e.exports={default:n("Rk1W"),__esModule:!0}},kcEc:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n("BHqR");t.Update=class extends r.AbstractMessage{constructor(e){super(),this.method="update",this.token=e}}},kz3d:function(e,t,n){var r=n("rFq9"),i=n("hR4s"),s=i["__core-js_shared__"]||(i["__core-js_shared__"]={});(e.exports=function(e,t){return s[e]||(s[e]=void 0!==t?t:{})})("versions",[]).push({version:r.version,mode:n("UtsQ")?"pure":"global",copyright:"\xa9 2019 Denis Pushkarev (zloirock.ru)"})},l9m5:function(e,t,n){"use strict";var r=c(n("tgXR")),i=c(n("IhEH")),s=c(n("XUND")),a=c(n("u2rs")),o=c(n("4Mt5")),u=c(n("aq5/"));function c(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var l=n("aMvW"),d=n("CmQt"),h=n("3eIt"),f=n("CPx3"),p=n("dWBN"),m=n("9F0I"),y=n("7ae9"),v=n("G1hA").version,g=f.Logger.scope("Session"),b=function e(){(0,u.default)(this,e)},w=function(){function e(t,n){(0,u.default)(this,e);var r="undefined"!=typeof navigator?d.parse(navigator.userAgent):d;this.services=t,this.config=n,this.sessionInfo=new m.Deferred,this.currentContext={},this.pendingCommands=new a.default,this.sessionStreamPromise=null,this.endpointPlatform=["js",v,r.os,r.name,r.version].join("|")}var t,n,c,f,w,_;return(0,o.default)(e,[{key:"handleContextUpdate",value:function(e){var t;g.info("Session context updated"),g.debug("new session context:",e),this.currentContext=e,t=e,["identity","userInfo","links","myChannels","channels"].some((function(e){return!t.hasOwnProperty(e)}))||(g.info("new session context accepted"),this.sessionInfo.set(e))}},{key:"initialize",value:function(){var e=this;return this.sessionStreamPromise=this.services.syncClient.list({purpose:"com.twilio.rtd.ipmsg",context:{type:"IpMsgSession",apiVersion:"3",endpointPlatform:this.endpointPlatform}}).then((function(t){return g.info("Session created",t.sid),t.on("itemAdded",(function(t){return e.processCommandResponse(t.item)})),t.on("itemUpdated",(function(t){return e.processCommandResponse(t.item)})),t.on("contextUpdated",(function(t){return e.handleContextUpdate(t.context)})),t})).catch((function(e){throw g.error("Failed to create session",e),e})),this.sessionStreamPromise}},{key:"addCommand",value:function(e,t){return this.processCommand(e,t)}},{key:"processCommand",value:function(e,t){var n=this,r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],i=new b;return i.request=t,i.request.action=e,i.commandId=l.v4(),g.info("Adding command: ",e,i.commandId),g.debug("command arguments:",t,r),new s.default((function(s,a){n.sessionStreamPromise.then((function(e){return n.pendingCommands.set(i.commandId,{resolve:s,reject:a,commandId:i.commandId,request:i.request}),e.push(i)})).then((function(){return g.debug("Command accepted by server",i.commandId)})).catch((function(o){n.pendingCommands.delete(i.commandId),g.error("Failed to add a command to the session",o),o.code!=h.ResponseCodes.ACCESS_FORBIDDEN_FOR_IDENTITY&&o.code!==h.ResponseCodes.LIST_NOT_FOUND||!r?a(new Error("Can't add command: "+o.message)):(g.info("recreating session..."),n.initialize(),s(n.processCommand(e,t,!1)))}))}))}},{key:"processCommandResponse",value:function(e){if(e.value.hasOwnProperty("response")&&e.value.hasOwnProperty("commandId")&&this.pendingCommands.has(e.value.commandId)){var t=e.value,n=e.value.commandId;if(t.response.status===h.ResponseCodes.HTTP_200_OK){g.debug("Command succeeded: ",t);var r=this.pendingCommands.get(n).resolve;this.pendingCommands.delete(n),r(t.response)}else{g.error("Command failed: ",t);var i=this.pendingCommands.get(n).reject;this.pendingCommands.delete(n),i(new p.SessionError(t.response.statusText,t.response.status))}}}},{key:"getSessionContext",value:function(){return this.sessionStreamPromise.then((function(e){return e.getContext()}))}},{key:"getSessionLinks",value:(_=(0,i.default)(r.default.mark((function e(){var t;return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.sessionInfo.promise;case 2:return e.abrupt("return",{publicChannelsUrl:this.config.baseUrl+(t=e.sent).links.publicChannelsUrl,myChannelsUrl:this.config.baseUrl+t.links.myChannelsUrl,typingUrl:this.config.baseUrl+t.links.typingUrl,syncListUrl:this.config.baseUrl+t.links.syncListUrl,usersUrl:this.config.baseUrl+t.links.usersUrl,mediaServiceUrl:t.links.mediaServiceUrl});case 4:case"end":return e.stop()}}),e,this)}))),function(){return _.apply(this,arguments)})},{key:"getChannelsId",value:(w=(0,i.default)(r.default.mark((function e(){return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.sessionInfo.promise;case 2:return e.abrupt("return",e.sent.channels);case 4:case"end":return e.stop()}}),e,this)}))),function(){return w.apply(this,arguments)})},{key:"getMyChannelsId",value:(f=(0,i.default)(r.default.mark((function e(){return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.sessionInfo.promise;case 2:return e.abrupt("return",e.sent.myChannels);case 4:case"end":return e.stop()}}),e,this)}))),function(){return f.apply(this,arguments)})},{key:"getMaxUserInfosToSubscribe",value:(c=(0,i.default)(r.default.mark((function e(){var t;return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.sessionInfo.promise;case 2:return t=e.sent,e.abrupt("return",this.config.userInfosToSubscribeOverride||t.userInfosToSubscribe||this.config.userInfosToSubscribeDefault);case 4:case"end":return e.stop()}}),e,this)}))),function(){return c.apply(this,arguments)})},{key:"getUsersData",value:function(){return this.sessionInfo.promise.then((function(e){return{user:e.userInfo,identity:e.identity}}))}},{key:"getConsumptionReportInterval",value:(n=(0,i.default)(r.default.mark((function e(){var t,n;return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getSessionContext();case 2:return t=e.sent,n=this.config.consumptionReportIntervalOverride||t.consumptionReportInterval||this.config.consumptionReportIntervalDefault,e.prev=4,e.abrupt("return",y.toSeconds(y.parse(n)));case 8:return e.prev=8,e.t0=e.catch(4),g.error("Failed to parse consumption report interval",n,"using default value",this.config.consumptionReportIntervalDefault),e.abrupt("return",y.toSeconds(y.parse(this.config.consumptionReportIntervalDefault)));case 12:case"end":return e.stop()}}),e,this,[[4,8]])}))),function(){return n.apply(this,arguments)})},{key:"getHttpCacheInterval",value:(t=(0,i.default)(r.default.mark((function e(){var t,n;return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getSessionContext();case 2:return t=e.sent,n=this.config.httpCacheIntervalOverride||t.httpCacheInterval||this.config.httpCacheIntervalDefault,e.prev=4,e.abrupt("return",y.toSeconds(y.parse(n)));case 8:return e.prev=8,e.t0=e.catch(4),g.error("Failed to parse cache interval",n,"using default value",this.config.httpCacheIntervalDefault),e.abrupt("return",y.toSeconds(y.parse(this.config.httpCacheIntervalDefault)));case 12:case"end":return e.stop()}}),e,this,[[4,8]])}))),function(){return t.apply(this,arguments)})},{key:"identity",get:function(){return this.sessionInfo.current.identity}},{key:"reachabilityEnabled",get:function(){return this.currentContext.reachabilityEnabled}}]),e}();t.Session=w},lKIr:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n("sc67");function i(e){return!isNaN(parseInt(e))&&isFinite(e)}function s(e){return i(e)&&e>=0}t.deepClone=function(e){return JSON.parse(JSON.stringify(e))},t.validateOptionalTtl=function(e){if(void 0!==e&&!s(e))throw new r.default(`Invalid TTL value, expected a positive integer, was '${e}'`,400,54011)},t.validateMandatoryTtl=function(e){if(!s(e))throw new r.default(`Invalid TTL value, expected a positive integer, was '${e}'`,400,54011)},t.validatePageSize=function(e){var t;if(!(void 0===e||i(t=e)&&t>0))throw new r.default(`Invalid pageSize parameter. Expected a positive integer, was '${e}'.`,400,54455)}},lPsM:function(e,t,n){var r=n("jIkG"),i=n("WLcV"),s=i;s.v1=r,s.v4=i,e.exports=s},lgJq:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Configuration=class{constructor(e={}){const t=e.cdsUri||`https://cds.${e.region||"us1"}.twilio.com`;var n,r;this.settings={subscriptionsUri:t+"/v4/Subscriptions",documentsUri:t+"/v3/Documents",listsUri:t+"/v3/Lists",mapsUri:t+"/v3/Maps",streamsUri:t+"/v3/Streams",insightsUri:t+"/v3/Insights",sessionStorageEnabled:(n=e.Sync,r="enableSessionStorage",!n||void 0===n[r]||n[r])}}get subscriptionsUri(){return this.settings.subscriptionsUri}get documentsUri(){return this.settings.documentsUri}get listsUri(){return this.settings.listsUri}get mapsUri(){return this.settings.mapsUri}get streamsUri(){return this.settings.streamsUri}get insightsUri(){return this.settings.insightsUri}get backoffConfig(){return this.settings.backoffConfig||{}}get sessionStorageEnabled(){return this.settings.sessionStorageEnabled}}},lkbt:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n("s23o"),i=n("zaPo"),s=n("a4io");t.Media=s.Media,t.McsMedia=s.Media;const a=n("UusA"),o=n("QyXE"),u=r.Logger.scope(""),c=n("qPqR").version,l="A valid Twilio token should be provided";class d{constructor(e,t,n={}){if(this.options=n,this.options.logLevel=this.options.logLevel||"silent",this.config=new i.Configuration(e,t,this.options),!e)throw new Error(l);u.setLevel(this.options.logLevel),this.options.transport=this.options.transport||new a.Transport,this.transport=this.options.transport,this.network=new o.Network(this.config,this.transport)}updateToken(e){if(u.info("updateToken"),!e)throw new Error(l);this.config.updateToken(e)}async get(e){let t=await this.network.get(`${this.config.baseUrl}/${e}`);return new s.Media(this.config,this.network,t.body)}async post(e,t){let n=await this.network.post(this.config.baseUrl,t,e);return new s.Media(this.config,this.network,n.body)}async postFormData(e){let t=await this.network.post(this.config.baseUrl,e);return new s.Media(this.config,this.network,t.body)}}t.Client=d,t.McsClient=d,d.version=c,t.default=d},llpV:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class r{constructor(e,t){this.balanceFactor=0,this.key=e,this.value=t,this.parent=null,this.left=null,this.right=null}get isRoot(){return null===this.parent}get isLeaf(){return null===this.left&&null===this.right}get isLeftChild(){return this.parent.left===this}update(e){this.value=e}replace(e,t){e&&(this.left===t?this.left=t:this.right===t&&(this.right=t))}}t.TreeMap=class{constructor(e,t){this.isLessThan=e||((e,t)=>e<t),this.isEqual=t||((e,t)=>e===t),this.root=null,this.count=null}get size(){return this.count}clear(){this.root=null,this.count=0}set(e,t){let n=this.getNode(e);n?n.update(t):this.insert(e,t)}insert(e,t){let n=new r(e,t);if(this.count++,!this.root)return void(this.root=n);let i=this.root;for(;;)if(this.isLessThan(e,i.key)){if(!i.left){i.left=n;break}i=i.left}else{if(!i.right){i.right=n;break}i=i.right}for(n.parent=i,i=n;i.parent;){let e=i.parent,t=e.balanceFactor;if(i.isLeftChild?e.balanceFactor++:e.balanceFactor--,Math.abs(e.balanceFactor)<Math.abs(t))break;if(e.balanceFactor<-1||e.balanceFactor>1){this.rebalance(e);break}i=e}}get(e){let t=this.root;for(;t;){if(this.isEqual(e,t.key))return t.value;t=this.isLessThan(e,t.key)?t.left:t.right}return null}delete(e){let t=this.getNode(e);if(!t||t.key!==e)return null;let n=t.parent,r=t.left,i=t.right;if(!!r!=!!i){let e=r||i;n||e?n&&!e?this.root=e:(n.replace(t,null),this.rebalance(n)):this.root=null}else{let e=t.left;for(;e.right;)e=e.right;if(t.left===e)t.isRoot?(this.root=e,e.parent=null):(t.isLeftChild?t.parent.left=e:t.parent.right=e,e.parent=t.parent),e.right=t.right,e.right.parent=e,e.balanceFactor=t.balanceFactor,t={parent:e,isLeftChild:!0};else{let n=e.parent,r=e.left;n.right=r,r&&(r.parent=n),t.isRoot?(this.root=e,e.parent=null):(t.isLeftChild?t.parent.left=e:t.parent.right=e,e.parent=t.parent),e.right=t.right,e.right.parent=e,e.left=t.left,e.left.parent=e,e.balanceFactor=t.balanceFactor,t={parent:n,isLeftChild:!1}}}for(this.count--;t.parent;){let e=t.parent,n=e.balanceFactor;if(t.isLeftChild?e.balanceFactor-=1:e.balanceFactor+=1,Math.abs(e.balanceFactor)>Math.abs(n)){if(!(e.balanceFactor<-1||e.balanceFactor>1))break;if(this.rebalance(e),0!==e.parent.balanceFactor)break;t=e.parent}else t=e}return null}getNode(e){let t=this.root;for(;t;){if(this.isEqual(e,t.key))return t;t=this.isLessThan(e,t.key)?t.left:t.right}return null}rebalance(e){e.balanceFactor<0?e.right.balanceFactor>0?(this.rotateRight(e.right),this.rotateLeft(e)):this.rotateLeft(e):e.balanceFactor>0&&(e.left.balanceFactor<0?(this.rotateLeft(e.left),this.rotateRight(e)):this.rotateRight(e))}rotateLeft(e){let t=e.right;e.right=t.left,null!==t.left&&(t.left.parent=e),t.parent=e.parent,null===t.parent?this.root=t:e.isLeftChild?t.parent.left=t:t.parent.right=t,t.left=e,e.parent=t,e.balanceFactor=e.balanceFactor+1-Math.min(t.balanceFactor,0),t.balanceFactor=t.balanceFactor+1-Math.max(e.balanceFactor,0)}rotateRight(e){let t=e.left;e.left=t.right,null!==t.right&&(t.right.parent=e),t.parent=e.parent,null===t.parent?this.root=t:e.isLeftChild?t.parent.left=t:t.parent.right=t,t.right=e,e.parent=t,e.balanceFactor=e.balanceFactor-1-Math.min(t.balanceFactor,0),t.balanceFactor=t.balanceFactor-1-Math.max(e.balanceFactor,0)}*[Symbol.iterator](){for(let e of this.getIterator())yield e}*getIterator(e=null){let t=this.root;for(;t&&!this.isEqual(e,t.key)&&(null!==e||t.left);)t=this.isLessThan(e,t.key)||null===e?t.left:t.right;if(!t)return null;let n=!0;for(;;)if(n)if(yield[t.key,t.value],n=!1,t.right){for(t=t.right;t.left;)t=t.left;n=!0}else{if(!t.parent)break;n=t.parent.left===t,t=t.parent}else{if(!t.parent)break;n=t.parent.left===t,t=t.parent}return null}*getReverseIterator(e=null){let t=this.root;for(;t&&!this.isEqual(e,t.key)&&(null!==e||t.right);)t=this.isLessThan(e,t.key)&&null!==e?t.left:t.right;if(!t)return null;let n=!0;for(;;)if(n)if(yield[t.key,t.value],n=!1,t.left){for(t=t.left;t.right;)t=t.right;n=!0}else{if(!t.parent)break;n=t.parent.right===t,t=t.parent}else{if(!t.parent)break;n=t.parent.right===t,t=t.parent}return null}}},"m+l7":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=Object.prototype.hasOwnProperty;function i(e){return void 0===e?"undefined":null===e?"null":Array.isArray(e)?"array":typeof e}t.objectType=i,t.compare=function e(t,n){if(t===n)return!0;var s=i(t),a=i(n);return"array"==s&&"array"==a?function(t,n){var r=t.length;if(r!==n.length)return!1;for(var i=0;i<r;i++)if(!e(t[i],n[i]))return!1;return!0}(t,n):"object"==s&&"object"==a&&function(t,n){var i=Object.keys(t),s=Object.keys(n),a=i.length;if(a!==s.length)return!1;for(var o=0;o<a;o++){var u=i[o];if(!r.call(n,u)||!e(t[u],n[u]))return!1}return!0}(t,n)}},mFO2:function(e,t){!function(t){"use strict";var n=Object.prototype,r=n.hasOwnProperty,i="function"==typeof Symbol?Symbol:{},s=i.iterator||"@@iterator",a=i.asyncIterator||"@@asyncIterator",o=i.toStringTag||"@@toStringTag",u="object"==typeof e,c=t.regeneratorRuntime;if(c)u&&(e.exports=c);else{(c=t.regeneratorRuntime=u?e.exports:{}).wrap=m;var l={},d={};d[s]=function(){return this};var h=Object.getPrototypeOf,f=h&&h(h(M([])));f&&f!==n&&r.call(f,s)&&(d=f);var p=b.prototype=v.prototype=Object.create(d);g.prototype=p.constructor=b,b.constructor=g,b[o]=g.displayName="GeneratorFunction",c.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===g||"GeneratorFunction"===(t.displayName||t.name))},c.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,b):(e.__proto__=b,o in e||(e[o]="GeneratorFunction")),e.prototype=Object.create(p),e},c.awrap=function(e){return{__await:e}},w(_.prototype),_.prototype[a]=function(){return this},c.AsyncIterator=_,c.async=function(e,t,n,r){var i=new _(m(e,t,n,r));return c.isGeneratorFunction(t)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},w(p),p[o]="Generator",p[s]=function(){return this},p.toString=function(){return"[object Generator]"},c.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},c.values=M,C.prototype={constructor:C,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(S),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(n,r){return a.type="throw",a.arg=e,t.next=n,r&&(t.method="next",t.arg=void 0),!!r}for(var i=this.tryEntries.length-1;i>=0;--i){var s=this.tryEntries[i],a=s.completion;if("root"===s.tryLoc)return n("end");if(s.tryLoc<=this.prev){var o=r.call(s,"catchLoc"),u=r.call(s,"finallyLoc");if(o&&u){if(this.prev<s.catchLoc)return n(s.catchLoc,!0);if(this.prev<s.finallyLoc)return n(s.finallyLoc)}else if(o){if(this.prev<s.catchLoc)return n(s.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<s.finallyLoc)return n(s.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var s=i;break}}s&&("break"===e||"continue"===e)&&s.tryLoc<=t&&t<=s.finallyLoc&&(s=null);var a=s?s.completion:{};return a.type=e,a.arg=t,s?(this.method="next",this.next=s.finallyLoc,l):this.complete(a)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),l},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),S(n),l}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;S(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:M(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),l}}}function m(e,t,n,r){var i=Object.create((t&&t.prototype instanceof v?t:v).prototype),s=new C(r||[]);return i._invoke=function(e,t,n){var r="suspendedStart";return function(i,s){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===i)throw s;return{value:void 0,done:!0}}for(n.method=i,n.arg=s;;){var a=n.delegate;if(a){var o=k(a,n);if(o){if(o===l)continue;return o}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var u=y(e,t,n);if("normal"===u.type){if(r=n.done?"completed":"suspendedYield",u.arg===l)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(r="completed",n.method="throw",n.arg=u.arg)}}}(e,n,s),i}function y(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(r){return{type:"throw",arg:r}}}function v(){}function g(){}function b(){}function w(e){["next","throw","return"].forEach((function(t){e[t]=function(e){return this._invoke(t,e)}}))}function _(e){var t;this._invoke=function(n,i){function s(){return new Promise((function(t,s){!function t(n,i,s,a){var o=y(e[n],e,i);if("throw"!==o.type){var u=o.arg,c=u.value;return c&&"object"==typeof c&&r.call(c,"__await")?Promise.resolve(c.__await).then((function(e){t("next",e,s,a)}),(function(e){t("throw",e,s,a)})):Promise.resolve(c).then((function(e){u.value=e,s(u)}),a)}a(o.arg)}(n,i,t,s)}))}return t=t?t.then(s,s):s()}}function k(e,t){var n=e.iterator[t.method];if(void 0===n){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,k(e,t),"throw"===t.method))return l;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var r=y(n,e.iterator,t.arg);if("throw"===r.type)return t.method="throw",t.arg=r.arg,t.delegate=null,l;var i=r.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,l):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,l)}function x(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function S(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function C(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(x,this),this.reset(!0)}function M(e){if(e){var t=e[s];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,i=function t(){for(;++n<e.length;)if(r.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return i.next=i}}return{next:E}}function E(){return{value:void 0,done:!0}}}(function(){return this}()||Function("return this")())},mrFV:function(e,t,n){var r=n("vbc5"),i=Math.floor;e.exports=function(e){return!r(e)&&isFinite(e)&&i(e)===e}},n40k:function(e,t,n){var r=n("gm/K"),i=n("1ppQ");e.exports=function(e,t,n){var s=t&&n||0;"string"==typeof e&&(t="binary"===e?new Array(16):null,e=null);var a=(e=e||{}).random||(e.rng||r)();if(a[6]=15&a[6]|64,a[8]=63&a[8]|128,t)for(var o=0;o<16;++o)t[s+o]=a[o];return t||i(a)}},nNrO:function(e,t,n){var r=n("IFjL"),i=n("yew7"),s=n("Vzpu"),a=n("8fQz"),o=n("vbc5"),u=n("7S/a"),c=n("fquK"),l=(n("hR4s").Reflect||{}).construct,d=u((function(){function e(){}return!(l((function(){}),[],e)instanceof e)})),h=!u((function(){l((function(){}))}));r(r.S+r.F*(d||h),"Reflect",{construct:function(e,t){s(e),a(t);var n=arguments.length<3?e:s(arguments[2]);if(h&&!d)return l(e,t,n);if(e==n){switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3])}var r=[null];return r.push.apply(r,t),new(c.apply(e,r))}var u=n.prototype,f=i(o(u)?u:Object.prototype),p=Function.apply.call(e,f,t);return o(p)?p:f}})},nX7j:function(e,t,n){var r=n("IFjL");r(r.S,"Object",{create:n("yew7")})},nwbp:function(e,t){var n="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(n){var r=new Uint8Array(16);e.exports=function(){return n(r),r}}else{var i=new Array(16);e.exports=function(){for(var e,t=0;t<16;t++)0==(3&t)&&(e=4294967296*Math.random()),i[t]=e>>>((3&t)<<3)&255;return i}}},nzL3:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n("qXWz"),i=n("5ZaL"),s=n("EtEV");t.Connector=s.Connector;let a={min:2e3,max:12e4,randomness:.2};t.RegistrarConnector=class extends s.Connector{constructor(e,t,n,r){super(r),this.channelType=e,this.context=t,this.transport=n}async updateRegistration(e,t){return t.has("notificationId")&&await this.removeRegistration(),e.notificationId&&e.notificationId.length?(await this.register(e),e):e}async removeRegistration(){if(!this.registrationId)return;const e=`${this.config.registrarUrl}/${this.registrationId}?productId=${this.context.productId}`,t={"Content-Type":"application/json","X-Twilio-Token":this.config.token};try{i.log.trace("Removing registration for ",this.channelType),await new r.Retrier(Object.assign(a,{maxAttemptsCount:3})).run(()=>this.transport.delete(e,t)),i.log.debug("Registration removed for",this.channelType)}catch(n){throw i.log.error("Failed to remove of registration ",this.channelType,n),n}}async register(e){i.log.trace("Registering",this.channelType,e);let t={endpoint_platform:this.context.platform,channel_type:this.channelType,version:this.context.protocolVersion.toString(),message_types:Array.from(e.messageTypes),data:{registration_id:e.notificationId},ttl:"PT24H"};const n=`${this.config.registrarUrl}?productId=${this.context.productId}`,s={"Content-Type":"application/json","X-Twilio-Token":e.token};i.log.trace("Creating registration for channel ",this.channelType);try{let e=await new r.Retrier(a).run(()=>this.transport.post(n,s,t));this.registrationId=e.body.id,i.log.debug("Registration created: ",e)}catch(o){throw i.log.error("Registration failed: ",o),o}}}},oPEB:function(e,t,n){e.exports={default:n("d5Ah"),__esModule:!0}},oi0w:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n("SbVi");t.TwilsockUpstreamError=class extends r.TwilsockError{constructor(e,t,n){super(t),this.status=e,this.description=t,this.body=n}}},p2b6:function(e,t,n){e.exports={default:n("OoA2"),__esModule:!0}},p87M:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n("+t7B");t.SyncClient=r.SyncClient;const i=n("tcGR");t.SyncDocument=i.SyncDocument;const s=n("W27V");t.SyncList=s.SyncList;const a=n("+fds");t.SyncListItem=a.ListItem;const o=n("B3fw");t.SyncMap=o.SyncMap;const u=n("tTO9");t.SyncMapItem=u.MapItem,t.default=r.SyncClient,e.exports=r.SyncClient,e.exports.SyncClient=r.SyncClient},pagH:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n("BHqR");t.Close=class extends r.AbstractMessage{constructor(){super(),this.method="close"}}},qCKU:function(e,t,n){e.exports={default:n("2YE3"),__esModule:!0}},qPgj:function(e,t,n){"use strict";var r=o(n("tgXR")),i=o(n("IhEH")),s=o(n("aq5/")),a=o(n("4Mt5"));function o(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(t,n){(0,s.default)(this,e),this.mcsMedia=null,this.services=n,this.state={sid:t.sid,filename:t.filename,contentType:t.contentType,size:t.size}}var t;return(0,a.default)(e,[{key:"getContentUrl",value:(t=(0,i.default)(r.default.mark((function e(){return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.mcsMedia){e.next=8;break}if(!this.services.mcsClient){e.next=7;break}return e.next=4,this.services.mcsClient.get(this.state.sid);case 4:this.mcsMedia=e.sent,e.next=8;break;case 7:throw new Error("Media Content Service is unavailable");case 8:return e.abrupt("return",this.mcsMedia.getContentUrl());case 9:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"sid",get:function(){return this.state.sid}},{key:"filename",get:function(){return this.state.filename}},{key:"contentType",get:function(){return this.state.contentType}},{key:"size",get:function(){return this.state.size}}]),e}();t.Media=u},qPqR:function(e){e.exports=JSON.parse('{"_from":"twilio-mcs-client@^0.3.3","_id":"twilio-mcs-client@0.3.3","_inBundle":false,"_integrity":"sha512-lNnVITgLg14HBG2oshnwjAeyBxhuqJeAIQE/KUDCGLHwtA6moE49SE1RRtUr5hhziyDSCTjm5X8YeP0m/lL7QA==","_location":"/twilio-mcs-client","_phantomChildren":{},"_requested":{"type":"range","registry":true,"raw":"twilio-mcs-client@^0.3.3","name":"twilio-mcs-client","escapedName":"twilio-mcs-client","rawSpec":"^0.3.3","saveSpec":null,"fetchSpec":"^0.3.3"},"_requiredBy":["/twilio-chat"],"_resolved":"https://registry.npmjs.org/twilio-mcs-client/-/twilio-mcs-client-0.3.3.tgz","_shasum":"6d4c6ae56af77c0d7631131dac2ce28a33652efc","_spec":"twilio-mcs-client@^0.3.3","_where":"D:\\\\Gabrielle2\\\\Development\\\\Web\\\\cooper-pantry\\\\cooper\\\\node_modules\\\\twilio-chat","author":{"name":"Twilio"},"browser":{"xmlhttprequest":false},"browserify":{"transform":["babelify"]},"bundleDependencies":false,"dependencies":{"loglevel":"^1.6.4","operation-retrier":"^3.0.1","xmlhttprequest":"^1.8.0"},"deprecated":false,"description":"Twilio Media Content Service client library","devDependencies":{"@types/chai":"^4.2.2","@types/chai-as-promised":"^7.1.2","@types/chai-datetime":"0.0.33","@types/chai-string":"^1.4.2","@types/core-js":"^2.5.2","@types/mocha":"^5.2.7","@types/node":"^12.7.4","@types/sinon":"^7.0.13","@types/sinon-chai":"^3.2.3","async":"^3.1.0","async-test-tools":"^1.0.7","babel-core":"^6.26.0","babel-plugin-transform-builtin-extend":"^1.1.2","babel-plugin-transform-runtime":"^6.23.0","babel-preset-env":"^1.6.1","babel-runtime":"^6.26.0","babelify":"^8.0.0","browserify":"^16.0.0","chai":"^4.2.0","chai-as-promised":"^7.1.1","chai-datetime":"^1.5.0","chai-string":"^1.5.0","cheerio":"^1.0.0-rc.2","cross-env":"^5.2.1","del":"^5.1.0","dotenv":"^8.1.0","express":"^4.17.1","gulp":"^4.0.2","gulp-babel":"^7.0.1","gulp-derequire":"^2.1.0","gulp-if":"^3.0.0","gulp-insert":"^0.5.0","gulp-mocha":"^7.0.1","gulp-rename":"^1.4.0","gulp-sourcemaps":"^2.6.5","gulp-tap":"^2.0.0","gulp-tslint":"^8.1.4","gulp-typescript":"^5.0.1","gulp-uglify-es":"^1.0.0","ink-docstrap":"^1.3.2","isomorphic-form-data":"^2.0.0","jsdoc":"~3.5.5","jsdoc-strip-async-await":"^0.1.0","mocha":"^6.2.0","ngrok":"^3.2.5","nyc":"^14.1.1","sinon":"^7.4.2","sinon-chai":"^3.3.0","source-map-explorer":"^2.0.1","ts-node":"^8.3.0","tslint":"^5.19.0","twilio":"^3.34.0","typescript":"^3.6.2","uglify-save-license":"^0.4.1","vinyl-buffer":"^1.0.1","vinyl-source-stream":"^2.0.0"},"engines":{"node":">=6"},"license":"MIT","main":"lib/index.js","name":"twilio-mcs-client","scripts":{},"types":"./lib/client.d.ts","version":"0.3.3"}')},qRjN:function(e,t,n){"use strict";var r=d(n("XUND")),i=d(n("tgXR")),s=d(n("IhEH")),a=d(n("Rhu4")),o=d(n("aq5/")),u=d(n("4Mt5")),c=d(n("7xyS")),l=d(n("k2Qk"));function d(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var h=n("r2q8"),f=n("s5eF"),p=n("CPx3").Logger.scope("Members"),m=function(e){function t(e,n,r){(0,o.default)(this,t);var i=(0,c.default)(this,(t.__proto__||(0,a.default)(t)).call(this));return i.services=n,i.channel=e,i.members=r,i}var n,d,h,m;return(0,l.default)(t,e),(0,u.default)(t,[{key:"unsubscribe",value:(m=(0,s.default)(i.default.mark((function e(){return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.rosterEntityPromise){e.next=6;break}return e.next=3,this.rosterEntityPromise;case 3:e.sent.close(),this.rosterEntityPromise=null;case 6:case"end":return e.stop()}}),e,this)}))),function(){return m.apply(this,arguments)})},{key:"subscribe",value:function(e){var t=this;return this.rosterEntityPromise=this.rosterEntityPromise||this.services.syncClient.map({id:e,mode:"open_existing"}).then((function(e){e.on("itemAdded",(function(e){p.debug(t.channel.sid+" itemAdded: "+e.item.key),t.upsertMember(e.item.key,e.item.value).then((function(e){t.emit("memberJoined",e)}))})),e.on("itemRemoved",(function(e){p.debug(t.channel.sid+" itemRemoved: "+e.key);var n=e.key;if(t.members.has(n)){var r=t.members.get(n);t.members.delete(n),t.emit("memberLeft",r)}})),e.on("itemUpdated",(function(e){p.debug(t.channel.sid+" itemUpdated: "+e.item.key),t.upsertMember(e.item.key,e.item.value)}));var n=[],i=t;return e.getItems().then((function e(t){return t.items.forEach((function(e){n.push(i.upsertMember(e.key,e.value))})),t.hasNextPage?t.nextPage().then(e):null})).then((function(){return r.default.all(n)})).then((function(){return e}))})).catch((function(e){throw t.rosterEntityPromise=null,"disconnected"!=t.services.syncClient.connectionState&&p.error("Failed to get roster object for channel",t.channel.sid,e),p.debug("ERROR: Failed to get roster object for channel",t.channel.sid,e),e}))}},{key:"upsertMember",value:(h=(0,s.default)(i.default.mark((function e(t,n){var r,s=this;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(r=this.members.get(t))){e.next=3;break}return e.abrupt("return",r._update(n));case 3:return r=new f.Member(this.services,this.channel,n,t),this.members.set(t,r),r.on("updated",(function(e){return s.emit("memberUpdated",e)})),e.abrupt("return",r);case 7:case"end":return e.stop()}}),e,this)}))),function(e,t){return h.apply(this,arguments)})},{key:"getMembers",value:function(){var e=this;return this.rosterEntityPromise.then((function(){var t=[];return e.members.forEach((function(e){return t.push(e)})),t}))}},{key:"getMemberBySid",value:(d=(0,s.default)(i.default.mark((function e(t){var n=this;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.rosterEntityPromise.then((function(){var e=n.members.get(t);if(!e)throw new Error("Member with SID "+t+" was not found");return e})));case 1:case"end":return e.stop()}}),e,this)}))),function(e){return d.apply(this,arguments)})},{key:"getMemberByIdentity",value:(n=(0,s.default)(i.default.mark((function e(t){var n,r=this;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=null,e.abrupt("return",this.rosterEntityPromise.then((function(){if(r.members.forEach((function(e){e.identity===t&&(n=e)})),!n)throw new Error("Member with identity "+t+" was not found");return n})));case 2:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"add",value:function(e){return this.services.session.addCommand("addMemberV2",{channelSid:this.channel.sid,username:e})}},{key:"invite",value:function(e){return this.services.session.addCommand("inviteMember",{channelSid:this.channel.sid,username:e})}},{key:"removeByIdentity",value:function(e){return this.services.session.addCommand("removeMember",{channelSid:this.channel.sid,username:e})}},{key:"removeBySid",value:function(e){return this.services.session.addCommand("removeMember",{channelSid:this.channel.sid,memberSid:e})}}]),t}(h.EventEmitter);t.Members=m},qXWz:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n("AKzx");t.Retrier=r.Retrier;const i=n("TkcT");t.Backoff=i.Backoff,t.default=r.Retrier},qa3O:function(e,t,n){var r=n("b95h");e.exports=function(e,t,n){for(var i in t)n&&e[i]?e[i]=t[i]:r(e,i,t[i]);return e}},"qiY+":function(e,t,n){var r=n("9v8s");e.exports=function(e,t){var n=[];return r(e,!1,n.push,n,t),n}},qlDM:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UriBuilder=class{constructor(e){this.base=e,this.args=new Array,this.paths=new Array}pathSegment(e){return this.paths.push(encodeURIComponent(e)),this}queryParam(e,t){return void 0!==t&&this.args.push(encodeURIComponent(e)+"="+encodeURIComponent(t)),this}build(){let e=this.base;return this.paths.length&&(e+="/"+this.paths.join("/")),this.args.length&&(e+="?"+this.args.join("&")),e}}},qqHg:function(e,t,n){"use strict";var r=n("dWRk"),i=n("IFjL"),s=n("MrWc"),a=n("9vFK"),o=n("fawX"),u=n("MPuG"),c=n("9bSt"),l=n("1sfF");i(i.S+i.F*!n("EWHn")((function(e){Array.from(e)})),"Array",{from:function(e){var t,n,i,d,h=s(e),f="function"==typeof this?this:Array,p=arguments.length,m=p>1?arguments[1]:void 0,y=void 0!==m,v=0,g=l(h);if(y&&(m=r(m,p>2?arguments[2]:void 0,2)),null==g||f==Array&&o(g))for(n=new f(t=u(h.length));t>v;v++)c(n,v,y?m(h[v],v):h[v]);else for(d=g.call(h),n=new f;!(i=d.next()).done;v++)c(n,v,y?a(d,m,[i.value,v],!0):i.value);return n.length=v,n}})},r2q8:function(e,t,n){"use strict";var r,i="object"==typeof Reflect?Reflect:null,s=i&&"function"==typeof i.apply?i.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)};r=i&&"function"==typeof i.ownKeys?i.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var a=Number.isNaN||function(e){return e!=e};function o(){o.init.call(this)}e.exports=o,o.EventEmitter=o,o.prototype._events=void 0,o.prototype._eventsCount=0,o.prototype._maxListeners=void 0;var u=10;function c(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function l(e){return void 0===e._maxListeners?o.defaultMaxListeners:e._maxListeners}function d(e,t,n,r){var i,s,a;if(c(n),void 0===(s=e._events)?(s=e._events=Object.create(null),e._eventsCount=0):(void 0!==s.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),s=e._events),a=s[t]),void 0===a)a=s[t]=n,++e._eventsCount;else if("function"==typeof a?a=s[t]=r?[n,a]:[a,n]:r?a.unshift(n):a.push(n),(i=l(e))>0&&a.length>i&&!a.warned){a.warned=!0;var o=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");o.name="MaxListenersExceededWarning",o.emitter=e,o.type=t,o.count=a.length,console&&console.warn&&console.warn(o)}return e}function h(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function f(e,t,n){var r={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},i=h.bind(r);return i.listener=n,r.wrapFn=i,i}function p(e,t,n){var r=e._events;if(void 0===r)return[];var i=r[t];return void 0===i?[]:"function"==typeof i?n?[i.listener||i]:[i]:n?function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(i):y(i,i.length)}function m(e){var t=this._events;if(void 0!==t){var n=t[e];if("function"==typeof n)return 1;if(void 0!==n)return n.length}return 0}function y(e,t){for(var n=new Array(t),r=0;r<t;++r)n[r]=e[r];return n}Object.defineProperty(o,"defaultMaxListeners",{enumerable:!0,get:function(){return u},set:function(e){if("number"!=typeof e||e<0||a(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");u=e}}),o.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},o.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||a(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},o.prototype.getMaxListeners=function(){return l(this)},o.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var r="error"===e,i=this._events;if(void 0!==i)r=r&&void 0===i.error;else if(!r)return!1;if(r){var a;if(t.length>0&&(a=t[0]),a instanceof Error)throw a;var o=new Error("Unhandled error."+(a?" ("+a.message+")":""));throw o.context=a,o}var u=i[e];if(void 0===u)return!1;if("function"==typeof u)s(u,this,t);else{var c=u.length,l=y(u,c);for(n=0;n<c;++n)s(l[n],this,t)}return!0},o.prototype.on=o.prototype.addListener=function(e,t){return d(this,e,t,!1)},o.prototype.prependListener=function(e,t){return d(this,e,t,!0)},o.prototype.once=function(e,t){return c(t),this.on(e,f(this,e,t)),this},o.prototype.prependOnceListener=function(e,t){return c(t),this.prependListener(e,f(this,e,t)),this},o.prototype.off=o.prototype.removeListener=function(e,t){var n,r,i,s,a;if(c(t),void 0===(r=this._events))return this;if(void 0===(n=r[e]))return this;if(n===t||n.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete r[e],r.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(i=-1,s=n.length-1;s>=0;s--)if(n[s]===t||n[s].listener===t){a=n[s].listener,i=s;break}if(i<0)return this;0===i?n.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(n,i),1===n.length&&(r[e]=n[0]),void 0!==r.removeListener&&this.emit("removeListener",e,a||t)}return this},o.prototype.removeAllListeners=function(e){var t,n,r;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete n[e]),this;if(0===arguments.length){var i,s=Object.keys(n);for(r=0;r<s.length;++r)"removeListener"!==(i=s[r])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(void 0!==t)for(r=t.length-1;r>=0;r--)this.removeListener(e,t[r]);return this},o.prototype.listeners=function(e){return p(this,e,!0)},o.prototype.rawListeners=function(e){return p(this,e,!1)},o.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):m.call(e,t)},o.prototype.listenerCount=m,o.prototype.eventNames=function(){return this._eventsCount>0?r(this._events):[]}},rFq9:function(e,t){var n=e.exports={version:"2.6.11"};"number"==typeof __e&&(__e=n)},rU52:function(e,t){e.exports=function(e){if(null==e)throw TypeError("Can't call method on  "+e);return e}},rtEw:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Deferred=class{constructor(){this._promise=new Promise((e,t)=>{this._resolve=e,this._reject=t})}get promise(){return this._promise}update(e){this._resolve(e)}set(e){this.current=e,this._resolve(e)}fail(e){this._reject(e)}}},s0lH:function(e,t){e.exports=function(e,t,n,r){if(!(e instanceof t)||void 0!==r&&r in e)throw TypeError(n+": incorrect invocation!");return e}},s0uK:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n("N8HJ"),i=n("r2q8"),s=n("TkJz"),a=n("SbVi");t.Registrations=class extends i.EventEmitter{constructor(e){super(),this.transport=e,this.registrations=new Map,this.registrationsInProgress=new Map}async putNotificationContext(e,t){const n={method:"put_notification_ctx",notification_ctx_id:e};await this.transport.sendWithReply(n,t)}async deleteNotificationContext(e){let t={method:"delete_notification_ctx",notification_ctx_id:e};await this.transport.sendWithReply(t)}async updateRegistration(e,t){r.log.debug("update registration for context",e);let n=this.registrationsInProgress.get(e);n||(n=new Set,this.registrationsInProgress.set(e,n));const i=s.v4();n.add(i);try{await this.putNotificationContext(e,t),r.log.debug("registration attempt succeeded for context",t),n.delete(i),0===n.size&&(this.registrationsInProgress.delete(e),this.emit("registered",e))}catch(a){r.log.warn("registration attempt failed for context",t),r.log.debug(a),n.delete(i),0===n.size&&(this.registrationsInProgress.delete(e),this.emit("registrationFailed",e,a))}}updateRegistrations(){r.log.trace(`refreshing ${this.registrations.size} registrations`),this.registrations.forEach((e,t)=>{this.updateRegistration(t,e)})}setNotificationsContext(e,t){if(!e||!t)throw new a.TwilsockError("Invalid arguments provided");this.registrations.set(e,t),this.transport.isConnected&&this.updateRegistration(e,t)}async removeNotificationsContext(e){this.registrations.has(e)&&(await this.deleteNotificationContext(e),this.transport.isConnected&&this.registrations.delete(e))}}},s23o:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n("XdyU");function i(e,t){return[`${(new Date).toISOString()} MCS Client ${e}:`].concat(Array.from(t))}class s{constructor(e){this.prefix="",this.prefix=null!=e&&e.length>0?e+" ":""}static scope(e){return new s(e)}setLevel(e){r.setLevel(e)}static setLevel(e){r.setLevel(e)}trace(...e){r.trace.apply(null,i(this.prefix+"T",e))}debug(...e){r.debug.apply(null,i(this.prefix+"D",e))}info(...e){r.info.apply(null,i(this.prefix+"I",e))}warn(...e){r.warn.apply(null,i(this.prefix+"W",e))}error(...e){r.error.apply(null,i(this.prefix+"E",e))}static trace(...e){r.trace.apply(null,i("T",e))}static debug(...e){r.debug.apply(null,i("D",e))}static info(...e){r.info.apply(null,i("I",e))}static warn(...e){r.warn.apply(null,i("W",e))}static error(...e){r.error.apply(null,i("E",e))}}t.Logger=s},s5eF:function(e,t,n){"use strict";var r=h(n("qCKU")),i=h(n("tgXR")),s=h(n("IhEH")),a=h(n("hjYm")),o=h(n("Rhu4")),u=h(n("aq5/")),c=h(n("4Mt5")),l=h(n("7xyS")),d=h(n("k2Qk"));function h(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var f=n("r2q8"),p=n("RtQP"),m=n("CPx3").Logger.scope("Member"),y=function(e){function t(e,n,r,i){(0,u.default)(this,t);var s=(0,l.default)(this,(t.__proto__||(0,o.default)(t)).call(this));if(s.channel=n,s.services=e,s.state={attributes:p.parseAttributes(r.attributes,"Retrieved malformed attributes from the server for member: "+i,m),dateCreated:r.dateCreated?p.parseTime(r.dateCreated):null,dateUpdated:r.dateCreated?p.parseTime(r.dateUpdated):null,sid:i,typingTimeout:null,isTyping:!1,identity:r.identity||null,roleSid:r.roleSid||null,lastConsumedMessageIndex:(0,a.default)(r.lastConsumedMessageIndex)?r.lastConsumedMessageIndex:null,lastConsumptionTimestamp:r.lastConsumptionTimestamp?p.parseTime(r.lastConsumptionTimestamp):null,type:r.type||"chat",userInfo:r.userInfo},!r.identity&&!r.type)throw new Error("Received invalid Member object from server: Missing identity or type of Member.");return s}var n,h,f,y;return(0,d.default)(t,e),(0,c.default)(t,[{key:"_startTyping",value:function(e){var t=this;return clearTimeout(this.state.typingTimeout),this.state.isTyping=!0,this.emit("typingStarted",this),this.channel.emit("typingStarted",this),this.state.typingTimeout=setTimeout((function(){return t._endTyping()}),e),this}},{key:"_endTyping",value:function(){this.state.typingTimeout&&(this.state.isTyping=!1,this.emit("typingEnded",this),this.channel.emit("typingEnded",this),clearInterval(this.state.typingTimeout),this.state.typingTimeout=null)}},{key:"_update",value:function(e){var t=[],n=p.parseAttributes(e.attributes,"Retrieved malformed attributes from the server for member: "+this.state.sid,m);e.attributes&&!p.isDeepEqual(this.state.attributes,n)&&(this.state.attributes=n,t.push("attributes"));var r=p.parseTime(e.dateUpdated);e.dateUpdated&&r.getTime()!==(this.state.dateUpdated&&this.state.dateUpdated.getTime())&&(this.state.dateUpdated=r,t.push("dateUpdated"));var i=p.parseTime(e.dateCreated);if(e.dateCreated&&i.getTime()!==(this.state.dateCreated&&this.state.dateCreated.getTime())&&(this.state.dateCreated=i,t.push("dateCreated")),e.roleSid&&this.state.roleSid!==e.roleSid&&(this.state.roleSid=e.roleSid,t.push("roleSid")),!(0,a.default)(e.lastConsumedMessageIndex)&&null!==e.lastConsumedMessageIndex||this.state.lastConsumedMessageIndex===e.lastConsumedMessageIndex||(this.state.lastConsumedMessageIndex=e.lastConsumedMessageIndex,t.push("lastConsumedMessageIndex")),e.lastConsumptionTimestamp){var s=new Date(e.lastConsumptionTimestamp);this.state.lastConsumptionTimestamp&&this.state.lastConsumptionTimestamp.getTime()===s.getTime()||(this.state.lastConsumptionTimestamp=s,t.push("lastConsumptionTimestamp"))}return t.length>0&&this.emit("updated",{member:this,updateReasons:t}),this}},{key:"getUserDescriptor",value:(y=(0,s.default)(i.default.mark((function e(){return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("chat"==this.type){e.next=2;break}throw new Error("Getting User Descriptor is not supported for this Member type: "+this.type);case 2:return e.abrupt("return",this.services.users.getUserDescriptor(this.state.identity));case 3:case"end":return e.stop()}}),e,this)}))),function(){return y.apply(this,arguments)})},{key:"getUser",value:(f=(0,s.default)(i.default.mark((function e(){return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("chat"==this.type){e.next=2;break}throw new Error("Getting User is not supported for this Member type: "+this.type);case 2:return e.abrupt("return",this.services.users.getUser(this.state.identity,this.state.userInfo));case 3:case"end":return e.stop()}}),e,this)}))),function(){return f.apply(this,arguments)})},{key:"remove",value:(h=(0,s.default)(i.default.mark((function e(){return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.channel.removeMember(this));case 1:case"end":return e.stop()}}),e,this)}))),function(){return h.apply(this,arguments)})},{key:"updateAttributes",value:(n=(0,s.default)(i.default.mark((function e(t){return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(void 0!==t){e.next=4;break}throw new Error("Attributes is required parameter");case 4:if(null!==t){e.next=8;break}throw new Error("Attributes can't be null");case 8:if(t.constructor===Object){e.next=10;break}throw new Error("Attributes must be a valid JSON object");case 10:return e.next=12,this.services.session.addCommand("editMemberAttributes",{channelSid:this.channel.sid,memberSid:this.sid,attributes:(0,r.default)(t)});case 12:return e.abrupt("return",this);case 13:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"sid",get:function(){return this.state.sid}},{key:"attributes",get:function(){return this.state.attributes}},{key:"dateCreated",get:function(){return this.state.dateCreated}},{key:"dateUpdated",get:function(){return this.state.dateUpdated}},{key:"identity",get:function(){return this.state.identity}},{key:"isTyping",get:function(){return this.state.isTyping}},{key:"lastConsumedMessageIndex",get:function(){return this.state.lastConsumedMessageIndex}},{key:"lastConsumptionTimestamp",get:function(){return this.state.lastConsumptionTimestamp}},{key:"roleSid",get:function(){return this.state.roleSid}},{key:"type",get:function(){return this.state.type}}]),t}(f.EventEmitter);t.Member=y},sRV3:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n("qXWz"),i=n("sc67"),s=n("LYxL"),a=n("F8DB");class o{constructor(e){this.localObject=e,this.pendingCorrelationId=null,this.pendingAction=null,this.established=!1,this.retryCount=0}get sid(){return this.localObject.sid}get type(){return this.localObject.type}get lastEventId(){return this.localObject.lastEventId}get indexName(){return this.localObject.indexName}get queryString(){return this.localObject.queryString}get isEstablished(){return this.established}update(e,t){this.localObject._update(e,t)}updatePending(e,t){this.pendingAction=e,this.pendingCorrelationId=t}reset(){this.updatePending(null,null),this.retryCount=0,this.established=!1,this.setSubscriptionState("none")}markAsFailed(e){this.rejectedWithError=e.error,this.updatePending(null,null),this.localObject.reportFailure(new i.SyncError(`Failed to subscribe on service events: ${e.error.message}`,e.error.status,e.error.code))}complete(e){this.updatePending(null,null),this.established=!0,this.localObject._advanceLastEventId(e)}setSubscriptionState(e){this.localObject._setSubscriptionState(e)}}t.Subscriptions=class{constructor(e){this.isConnected=!1,this.maxBatchSize=100,this.subscriptionTtlTimer=null,this.pendingPokeReason=null,this.services=e,this.subscriptions=new Map,this.persisted=new Map,this.latestPokeResponseArrivalTimestampByCorrelationId=new Map,this.backoff=r.Backoff.exponential(Object.assign({randomisationFactor:.2,initialDelay:100,maxDelay:12e4},this.services.config.backoffConfig)),this.backoff.on("ready",()=>{let{action:e,subscriptions:t}=this.getSubscriptionUpdateBatch();e?this.applyNewSubscriptionUpdateBatch(e,t):(this.backoff.reset(),s.default.debug("All subscriptions resolved."))})}getSubscriptionUpdateBatch(){function e(e,t,n,r){let i=[];for(let[s,a]of e)if(!t.get(s)&&n!==a.pendingAction&&!a.rejectedWithError&&(i.push(a),r&&i.length>=r))break;return i}let t=e(this.subscriptions,this.persisted,"establish",this.maxBatchSize);if(t.length>0)return{action:"establish",subscriptions:t};let n=e(this.persisted,this.subscriptions,"cancel",this.maxBatchSize);return n.length>0?{action:"cancel",subscriptions:n}:{action:null,subscriptions:null}}persist(){this.backoff.backoff()}async applyNewSubscriptionUpdateBatch(e,t){if(!this.isConnected)return s.default.debug("Twilsock connection (required for subscription) not ready; waiting\u2026"),void this.backoff.reset();t=this.processLocalActions(e,t);const n=(new Date).getTime();for(const s of t)this.recordActionAttemptOn(s,e,n);let r=this.pendingPokeReason;this.pendingPokeReason=null;try{let i=await this.request(e,n,r,t),a=i.body.max_batch_size;if(!isNaN(parseInt(a))&&isFinite(a)&&a>0&&(this.maxBatchSize=a),!this.subscriptionTtlTimer){let e=i.body.ttl_in_s;!isNaN(parseFloat(e))&&isFinite(e)&&e>0&&(this.subscriptionTtlTimer=setTimeout(()=>this.onSubscriptionTtlElapsed(),1e3*e))}if("establish"===e){const e=i.body.estimated_delivery_in_ms;!isNaN(parseFloat(e))&&isFinite(e)&&e>0?setTimeout(()=>this.verifyPokeDelivery(n,e,t),e):s.default.error(`Invalid timeout: ${e}`),t.filter(e=>e.pendingCorrelationId===n).forEach(e=>e.setSubscriptionState("response_in_flight"))}this.backoff.reset()}catch(i){for(const n of t)this.recordActionFailureOn(n,e);i instanceof a.TransportUnavailableError?(s.default.debug(`Twilsock connection (required for subscription) not ready (c:${n}); waiting\u2026`),this.backoff.reset()):(s.default.debug(`Failed an attempt to ${e} subscriptions (c:${n}); retrying`,i),this.persist())}}verifyPokeDelivery(e,t,n){const r=this.latestPokeResponseArrivalTimestampByCorrelationId.get(e),i=r?(new Date).getTime()-r:t;i>=t?(n.filter(t=>t.pendingCorrelationId===e).forEach(e=>{e.updatePending(null,null),e.retryCount++,this.persisted.delete(e.sid)}),this.persist(),this.latestPokeResponseArrivalTimestampByCorrelationId.delete(e)):setTimeout(()=>this.verifyPokeDelivery(e,t,n),t-i)}processLocalActions(e,t){return"cancel"===e?t.filter(e=>!e.rejectedWithError):t}recordActionAttemptOn(e,t,n){if(e.setSubscriptionState("request_in_flight"),"establish"===t)this.persisted.set(e.sid,e),e.updatePending(t,n);else{let r=this.persisted.get(e.sid);r&&r.updatePending(t,n)}}recordActionFailureOn(e,t){e.setSubscriptionState("none"),e.updatePending(null,null),"establish"===t&&this.persisted.delete(e.sid)}request(e,t,n,r){let i=r.map(t=>({object_sid:t.sid,object_type:t.type,last_event_id:"establish"===e?t.lastEventId:void 0,index_name:"establish"===e?t.indexName:void 0,query_string:"establish"===e?t.queryString:void 0})),a=r.filter(e=>e.retryCount>0).length;s.default.debug(`Attempting '${e}' request (c:${t}):`,i);const o={event_protocol_version:3,action:e,correlation_id:t,retried_requests:a,ttl_in_s:-1,requests:i};return"ttl"===n&&(o.reason=n),this.services.network.post(this.services.config.subscriptionsUri,o)}add(e,t){s.default.debug(`Establishing intent to subscribe to ${e}`);const n=this.subscriptions.get(e);n&&t&&n.lastEventId===t.lastEventId||(this.persisted.delete(e),this.subscriptions.set(e,new o(t)),this.persist())}remove(e){s.default.debug(`Establishing intent to unsubscribe from ${e}`),this.subscriptions.delete(e)&&this.persist()}acceptMessage(e,t){switch(s.default.trace("Subscriptions received",e),e.correlation_id&&this.latestPokeResponseArrivalTimestampByCorrelationId.set(e.correlation_id,(new Date).getTime()),e.event_type){case"subscription_established":this.applySubscriptionEstablishedMessage(e.event,e.correlation_id);break;case"subscription_canceled":this.applySubscriptionCancelledMessage(e.event,e.correlation_id);break;case"subscription_failed":this.applySubscriptionFailedMessage(e.event,e.correlation_id);break;case(e.event_type.match(/^(?:map|list|document|stream|live_query)_/)||{}).input:this.applyEventToSubscribedEntity(e.event_type.match(/^map_/)?e.event.map_sid:e.event_type.match(/^list_/)?e.event.list_sid:e.event_type.match(/^document_/)?e.event.document_sid:e.event_type.match(/^stream_/)?e.event.stream_sid:e.event_type.match(/^live_query/)?e.event.query_id:void 0,e,t);break;default:s.default.debug(`Dropping unknown message type ${e.event_type}`)}}applySubscriptionEstablishedMessage(e,t){const n=e.object_sid;let r=this.persisted.get(e.object_sid);r&&r.pendingCorrelationId===t?"interrupted"===e.replay_status?(s.default.debug(`Event Replay for subscription to ${n} (c:${t}) interrupted; continuing eagerly.`),r.updatePending(null,null),this.persisted.delete(r.sid),this.backoff.reset()):"completed"===e.replay_status&&(s.default.debug(`Event Replay for subscription to ${n} (c:${t}) completed. Subscription is ready.`),r.complete(e.last_event_id),this.persisted.set(e.object_sid,r),r.setSubscriptionState("established"),this.backoff.reset()):s.default.debug(`Late message for ${e.object_sid} (c:${t}) dropped.`),this.persist()}applySubscriptionCancelledMessage(e,t){let n=this.persisted.get(e.object_sid);n&&n.pendingCorrelationId===t?(n.updatePending(null,null),n.setSubscriptionState("none"),this.persisted.delete(e.object_sid)):s.default.debug(`Late message for ${e.object_sid} (c:${t}) dropped.`),this.persist()}applySubscriptionFailedMessage(e,t){const n=e.object_sid;let r=this.subscriptions.get(n),i=this.persisted.get(n);r&&i?i.pendingCorrelationId===t&&(s.default.error(`Failed to subscribe on ${i.sid}`,e.error),i.markAsFailed(e),i.setSubscriptionState("none")):!r&&i&&(this.persisted.delete(n),i.setSubscriptionState("none")),this.persist()}applyEventToSubscribedEntity(e,t,n){if(!e)return;n=n||(()=>{let t=this.persisted.get(e);return t&&t.isEstablished})();let r=this.subscriptions.get(e);r?(t.event.type=t.event_type,r.update(t.event,n)):s.default.debug(`Message dropped for SID '${e}', for which there is no subscription.`)}onConnectionStateChanged(e){this.isConnected=e,e&&this.poke("reconnect")}onSubscriptionTtlElapsed(){this.isConnected&&this.poke("ttl")}poke(e){s.default.debug(`Triggering event replay for all subscriptions, reason=${e}`),this.pendingPokeReason=e,this.subscriptionTtlTimer&&(clearTimeout(this.subscriptionTtlTimer),this.subscriptionTtlTimer=null);let t=[];for(let n of this.persisted.values())n.reset(),n.rejectedWithError&&t.push(n);this.persisted.clear();for(let n of t)this.persisted.set(n.sid,n);this.persist()}shutdown(){this.backoff.reset(),this.subscriptions.clear()}}},sc67:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class r extends Error{constructor(e,t=0,n=0){super(),this.name=this.constructor.name,this.message=`${e} (status: ${t}, code: ${n})`,this.status=t,this.code=n}}t.SyncError=r,t.SyncNetworkError=class extends r{constructor(e,t=0,n=0,r){super(e,t,n),this.body=r}},t.default=r},sqYj:function(e,t,n){"use strict";var r,i=this&&this.__extends||(r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)});Object.defineProperty(t,"__esModule",{value:!0});var s=n("ihyG"),a=n("TkXn"),o=n("m+l7"),u=function(e){function t(t){var n=e.call(this,"Value required at path: "+t)||this;return n.path=t,n.name="MissingError",n}return i(t,e),t}(Error);t.MissingError=u;var c=function(e){function t(t,n){var r=e.call(this,"Test failed: "+t+" != "+n)||this;return r.actual=t,r.expected=n,r.name="TestError",r.actual=t,r.expected=n,r}return i(t,e),t}(Error);function l(e,t,n){if(Array.isArray(e))if("-"==t)e.push(n);else{var r=parseInt(t,10);e.splice(r,0,n)}else e[t]=n}function d(e,t){if(Array.isArray(e)){var n=parseInt(t,10);e.splice(n,1)}else delete e[t]}function h(e,t){var n=s.Pointer.fromJSON(t.path).evaluate(e);return void 0===n.parent?new u(t.path):(l(n.parent,n.key,a.clone(t.value)),null)}function f(e,t){var n=s.Pointer.fromJSON(t.path).evaluate(e);return void 0===n.value?new u(t.path):(d(n.parent,n.key),null)}function p(e,t){var n=s.Pointer.fromJSON(t.path).evaluate(e);if(null===n.parent)return new u(t.path);if(Array.isArray(n.parent)){if(parseInt(n.key,10)>=n.parent.length)return new u(t.path)}else if(void 0===n.value)return new u(t.path);return n.parent[n.key]=t.value,null}function m(e,t){var n=s.Pointer.fromJSON(t.from).evaluate(e);if(void 0===n.value)return new u(t.from);var r=s.Pointer.fromJSON(t.path).evaluate(e);return void 0===r.parent?new u(t.path):(d(n.parent,n.key),l(r.parent,r.key,n.value),null)}function y(e,t){var n=s.Pointer.fromJSON(t.from).evaluate(e);if(void 0===n.value)return new u(t.from);var r=s.Pointer.fromJSON(t.path).evaluate(e);return void 0===r.parent?new u(t.path):(l(r.parent,r.key,a.clone(n.value)),null)}function v(e,t){var n=s.Pointer.fromJSON(t.path).evaluate(e);return o.compare(n.value,t.value)?null:new c(n.value,t.value)}t.TestError=c,t.add=h,t.remove=f,t.replace=p,t.move=m,t.copy=y,t.test=v;var g=function(e){function t(t){var n=e.call(this,"Invalid operation: "+t.op)||this;return n.operation=t,n.name="InvalidOperationError",n}return i(t,e),t}(Error);t.InvalidOperationError=g,t.apply=function(e,t){switch(t.op){case"add":return h(e,t);case"remove":return f(e,t);case"replace":return p(e,t);case"move":return m(e,t);case"copy":return y(e,t);case"test":return v(e,t)}return new g(t)}},tReM:function(e,t){e.exports={}},tTO9:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MapItem=class{constructor(e){this.descriptor=e}get uri(){return this.descriptor.url}get revision(){return this.descriptor.revision}get lastEventId(){return this.descriptor.last_event_id}get dateExpires(){return this.descriptor.date_expires}get key(){return this.descriptor.key}get value(){return this.descriptor.data}get dateUpdated(){return this.descriptor.date_updated}update(e,t,n,r){return this.descriptor.last_event_id=e,this.descriptor.revision=t,this.descriptor.data=n,this.descriptor.date_updated=r,this}updateDateExpires(e){this.descriptor.date_expires=e}}},tcGR:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n("sc67"),i=n("lKIr"),s=n("LYxL"),a=n("yURk"),o=n("wiho"),u=n("e/PS");class c extends a.SyncEntity{constructor(e,t,n){super(e,n),this.isDeleted=!1,this.updateMergingQueue=new o.MergingQueue((e,t)=>"number"==typeof t.ttl?{ttl:t.ttl}:e),this.descriptor=t,this.descriptor.data=this.descriptor.data||{},this.descriptor.date_updated=new Date(this.descriptor.date_updated)}get uri(){return this.descriptor.url}get revision(){return this.descriptor.revision}get lastEventId(){return this.descriptor.last_event_id}get dateExpires(){return this.descriptor.date_expires}static get type(){return"document"}get type(){return"document"}get indexName(){}get queryString(){}get sid(){return this.descriptor.sid}get value(){return this.descriptor.data}get dateUpdated(){return this.descriptor.date_updated}get uniqueName(){return this.descriptor.unique_name||null}_update(e){switch(e.date_created=new Date(e.date_created),e.type){case"document_updated":e.id>this.lastEventId?(this.descriptor.last_event_id=e.id,this.descriptor.revision=e.document_revision,this.descriptor.date_updated=e.date_created,this.descriptor.data=e.document_data,this.broadcastEventToListeners("updated",{value:e.document_data,isLocal:!1}),this.services.storage.update(this.type,this.sid,this.uniqueName,{last_event_id:e.id,revision:e.document_revision,date_updated:e.date_created,data:e.document_data})):s.default.trace("Document update skipped, current:",this.lastEventId,", remote:",e.id);break;case"document_removed":this.onRemoved(!1)}}async set(e,t){const n=t||{};return i.validateOptionalTtl(n.ttl),this.updateMergingQueue.squashAndAdd(n,t=>this._setUnconditionally(e,t.ttl))}async mutate(e,t){const n=t||{};return i.validateOptionalTtl(n.ttl),this.updateMergingQueue.add(n,t=>this._setWithIfMatch(e,t.ttl))}async update(e,t){return this.mutate(t=>Object.assign(t,e),t)}async setTtl(e){i.validateMandatoryTtl(e);const t=await this._postUpdateToServer({ttl:e});this.descriptor.date_expires=t.date_expires}async _setUnconditionally(e,t){let n=await this._postUpdateToServer({data:e,revision:void 0,ttl:t});return this._handleSuccessfulUpdateResult(n),this.value}async _setWithIfMatch(e,t){let n=e(i.deepClone(this.value));if(!n)return this.value;{let i=this.revision;try{let e=await this._postUpdateToServer({data:n,revision:i,ttl:t});return this._handleSuccessfulUpdateResult(e),this.value}catch(r){if(412===r.status)return await this._softSync(),this._setWithIfMatch(e);throw r}}}_handleSuccessfulUpdateResult(e){e.last_event_id>this.descriptor.last_event_id&&(this.descriptor.revision=e.revision,this.descriptor.data=e.data,this.descriptor.last_event_id=e.last_event_id,this.descriptor.date_expires=e.date_expires,this.descriptor.date_updated=new Date(e.date_updated),this.services.storage.update(this.type,this.sid,this.uniqueName,{last_event_id:e.last_event_id,revision:e.revision,date_updated:e.date_updated,data:e.data}),this.broadcastEventToListeners("updated",{value:this.value,isLocal:!0}))}async _postUpdateToServer(e){if(this.isDeleted)return Promise.reject(new r.SyncError("The Document has been removed",404,54100));{const n={data:e.data};"number"==typeof e.ttl&&(n.ttl=e.ttl);const r=e.revision;try{const t=await this.services.network.post(this.uri,n,r);return{revision:t.body.revision,data:e.data,last_event_id:t.body.last_event_id,date_updated:t.body.date_updated,date_expires:t.body.date_expires}}catch(t){throw 404===t.status&&this.onRemoved(!1),t}}}async _softSync(){return this.services.network.get(this.uri).then(e=>(this._update({type:"document_updated",id:e.body.last_event_id,document_revision:e.body.revision,document_data:e.body.data,date_created:e.body.date_updated}),this)).catch(e=>{404===e.status?this.onRemoved(!1):s.default.error(`Can't get updates for ${this.sid}:`,e)})}onRemoved(e){this.isDeleted||(this.isDeleted=!0,this._unsubscribe(),this.removalHandler(this.type,this.sid,this.uniqueName),this.broadcastEventToListeners("removed",{isLocal:e}))}async removeDocument(){if(this.isDeleted)return Promise.reject(new r.SyncError("The Document has been removed",404,54100));await this.services.network.delete(this.uri),this.onRemoved(!0)}}t.SyncDocumentImpl=c;class l extends u.default{constructor(e){super(),this.syncDocumentImpl=e,this.syncDocumentImpl.attach(this)}get uri(){return this.syncDocumentImpl.uri}get revision(){return this.syncDocumentImpl.revision}get lastEventId(){return this.syncDocumentImpl.lastEventId}get dateExpires(){return this.syncDocumentImpl.dateExpires}static get type(){return c.type}get type(){return c.type}get sid(){return this.syncDocumentImpl.sid}get value(){return this.syncDocumentImpl.value}get dateUpdated(){return this.syncDocumentImpl.dateUpdated}get uniqueName(){return this.syncDocumentImpl.uniqueName}async set(e,t){return this.ensureNotClosed(),this.syncDocumentImpl.set(e,t)}async mutate(e,t){return this.ensureNotClosed(),this.syncDocumentImpl.mutate(e,t)}async update(e,t){return this.ensureNotClosed(),this.syncDocumentImpl.update(e,t)}async setTtl(e){return this.ensureNotClosed(),this.syncDocumentImpl.setTtl(e)}async removeDocument(){return this.ensureNotClosed(),this.syncDocumentImpl.removeDocument()}close(){super.close(),this.syncDocumentImpl.detach(this.listenerUuid)}}t.SyncDocument=l,t.default=l},tgXR:function(e,t,n){e.exports=n("G+rG")},tqb5:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n("r2q8"),i=n("N8HJ"),s=n("Cf4i"),a=n("MC8q"),o=n("TsN3"),u=n("iBdP"),c=n("s0uK"),l=n("O3kU"),d=n("rtEw"),h=n("F8DB"),f=n("2NA7"),p=n("uthQ");class m extends r.EventEmitter{constructor(e,t,n={}){super(),this.offlineStorageDeferred=new d.Deferred,n.continuationToken=n.continuationToken?n.continuationToken:p.TokenStorage.getStoredToken(t);let r=this.config=new s.Configuration(e,t,n);i.log.setLevel(r.logLevel);let f=new u.WebSocketChannel(r.url),m=n.transport?n.transport:new o.PacketInterface(f,r);this.channel=n.channel?n.channel:new a.TwilsockImpl(f,m,r),this.registrations=n.registrations?n.registrations:new c.Registrations(m),this.upstream=new l.Upstream(m,this.channel,r),this.registrations.on("registered",e=>this.emit("registered",e)),this.channel.on("message",(e,t)=>setTimeout(()=>this.emit("message",e,t),0)),this.channel.on("stateChanged",e=>setTimeout(()=>this.emit("stateChanged",e),0)),this.channel.on("connectionError",e=>setTimeout(()=>this.emit("connectionError",e),0)),this.channel.on("tokenAboutToExpire",()=>setTimeout(()=>this.emit("tokenAboutToExpire"),0)),this.channel.on("tokenExpired",()=>setTimeout(()=>this.emit("tokenExpired"),0)),this.channel.on("connected",()=>this.registrations.updateRegistrations()),this.channel.on("connected",()=>this.upstream.sendPendingMessages()),this.channel.on("connected",()=>setTimeout(()=>this.emit("connected"),0)),this.channel.on("initialized",e=>{this.handleStorageId(t,e),p.TokenStorage.storeToken(e.continuationToken,t),setTimeout(()=>this.emit("initialized",e),0)}),this.channel.on("disconnected",()=>setTimeout(()=>this.emit("disconnected"),0)),this.channel.on("disconnected",()=>this.upstream.rejectPendingMessages()),this.channel.on("disconnected",()=>this.offlineStorageDeferred.fail(new h.TwilsockError("Client disconnected"))),this.offlineStorageDeferred.promise.catch(()=>{})}emit(e,...t){return i.log.debug(`Emitting ${e.toString()}(${t.map(e=>JSON.stringify(e)).join(", ")})`),super.emit(e,...t)}handleStorageId(e,t){if(t.offlineStorage)if(t.offlineStorage.hasOwnProperty(e))try{this.offlineStorageDeferred.set(f.OfflineProductStorage.create(t.offlineStorage[e])),i.log.debug(`Offline storage for '${e}' product: ${JSON.stringify(t.offlineStorage[e])}.`)}catch(n){this.offlineStorageDeferred.fail(new h.TwilsockError(`Failed to parse offline storage for ${e} ${JSON.stringify(t.offlineStorage[e])}. ${n}.`))}else this.offlineStorageDeferred.fail(new h.TwilsockError(`No offline storage id for '${e}' product: ${JSON.stringify(t.offlineStorage)}`));else this.offlineStorageDeferred.fail(new h.TwilsockError("No offline storage id"))}storageId(){return this.offlineStorageDeferred.promise}get isConnected(){return this.channel.isConnected}get state(){return this.channel.state}async updateToken(e){if(i.log.trace(`updating token '${e}'`),this.config.token!==e)return this.config.updateToken(e),this.channel.updateToken(e)}setNotificationsContext(e,t){this.registrations.setNotificationsContext(e,t)}removeNotificationsContext(e){this.registrations.removeNotificationsContext(e)}connect(){return this.channel.connect()}disconnect(){return this.channel.disconnect()}get(e,t){return this.upstream.send("GET",e,t)}post(e,t,n){return this.upstream.send("POST",e,t,n)}put(e,t,n){return this.upstream.send("PUT",e,t,n)}delete(e,t){return this.upstream.send("DELETE",e,t)}}t.TwilsockClient=m,t.Twilsock=m},u2rs:function(e,t,n){e.exports={default:n("F//K"),__esModule:!0}},uBMx:function(e,t,n){n("zJWi"),e.exports=n("rFq9").Object.getPrototypeOf},uXIA:function(e,t,n){var r,i,s=n("6XaB"),a=n("NkxH"),o=0,u=0;e.exports=function(e,t,n){var c=t&&n||0,l=t||[],d=(e=e||{}).node||r,h=void 0!==e.clockseq?e.clockseq:i;if(null==d||null==h){var f=s();null==d&&(d=r=[1|f[0],f[1],f[2],f[3],f[4],f[5]]),null==h&&(h=i=16383&(f[6]<<8|f[7]))}var p=void 0!==e.msecs?e.msecs:(new Date).getTime(),m=void 0!==e.nsecs?e.nsecs:u+1,y=p-o+(m-u)/1e4;if(y<0&&void 0===e.clockseq&&(h=h+1&16383),(y<0||p>o)&&void 0===e.nsecs&&(m=0),m>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");o=p,u=m,i=h;var v=(1e4*(268435455&(p+=122192928e5))+m)%4294967296;l[c++]=v>>>24&255,l[c++]=v>>>16&255,l[c++]=v>>>8&255,l[c++]=255&v;var g=p/4294967296*1e4&268435455;l[c++]=g>>>8&255,l[c++]=255&g,l[c++]=g>>>24&15|16,l[c++]=g>>>16&255,l[c++]=h>>>8|128,l[c++]=255&h;for(var b=0;b<6;++b)l[c+b]=d[b];return t||a(l)}},ubhL:function(e,t,n){var r=n("kz3d")("keys"),i=n("b1KM");e.exports=function(e){return r[e]||(r[e]=i(e))}},"upa/":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n("yURk"),i=n("lKIr"),s=n("e/PS");class a extends r.SyncEntity{constructor(e,t,n){super(e,n),this.descriptor=t}get uri(){return this.descriptor.url}get links(){return this.descriptor.links}static get type(){return"stream"}get dateExpires(){return this.descriptor.date_expires}get type(){return"stream"}get lastEventId(){return null}get indexName(){}get queryString(){}get sid(){return this.descriptor.sid}get uniqueName(){return this.descriptor.unique_name||null}async publishMessage(e){const t={data:e},n=await this.services.network.post(this.links.messages,t);return this._handleMessagePublished(n.body.sid,e,!1)}async setTtl(e){i.validateMandatoryTtl(e);try{const t={ttl:e},n=await this.services.network.post(this.uri,t);this.descriptor.date_expires=n.body.date_expires}catch(t){throw 404===t.status&&this.onRemoved(!1),t}}async removeStream(){await this.services.network.delete(this.uri),this.onRemoved(!0)}_update(e){switch(e.type){case"stream_message_published":this._handleMessagePublished(e.message_sid,e.message_data,!0);break;case"stream_removed":this.onRemoved(!1)}}_handleMessagePublished(e,t,n){const r={sid:e,value:t};return this.broadcastEventToListeners("messagePublished",{message:r,isLocal:!n}),r}onRemoved(e){this._unsubscribe(),this.removalHandler(this.type,this.sid,this.uniqueName),this.broadcastEventToListeners("removed",{isLocal:e})}}t.SyncStreamImpl=a;class o extends s.default{constructor(e){super(),this.syncStreamImpl=e,this.syncStreamImpl.attach(this)}get uri(){return this.syncStreamImpl.uri}get links(){return this.syncStreamImpl.links}static get type(){return a.type}get dateExpires(){return this.syncStreamImpl.dateExpires}get type(){return a.type}get lastEventId(){return null}get sid(){return this.syncStreamImpl.sid}get uniqueName(){return this.syncStreamImpl.uniqueName}async publishMessage(e){return this.ensureNotClosed(),this.syncStreamImpl.publishMessage(e)}async setTtl(e){return this.ensureNotClosed(),this.syncStreamImpl.setTtl(e)}async removeStream(){return this.ensureNotClosed(),this.syncStreamImpl.removeStream()}close(){super.close(),this.syncStreamImpl.detach(this.listenerUuid)}}t.SyncStream=o,t.default=o},uthQ:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class r{static get sessionStorage(){try{return global.sessionStorage}catch(e){return null}}static get window(){try{return global.window}catch(e){return null}}static storeToken(e,t){r.canStore&&r.sessionStorage.setItem(r.getKeyName(t),e)}static getStoredToken(e){return r.canStore?r.sessionStorage.getItem(r.getKeyName(e)):null}static initialize(){r.canStore&&(r.sessionStorage.getItem(r.initializedFlag)&&this.clear(),r.sessionStorage.setItem(r.initializedFlag,"true"),r.window.addEventListener("unload",()=>{r.sessionStorage.removeItem(r.initializedFlag)}))}static clear(){if(r.canStore){let e=[];for(let t=0;t<r.sessionStorage.length;t++){const n=r.sessionStorage.key(t);n.startsWith(r.tokenStoragePrefix)&&e.push(n)}e.forEach(e=>r.sessionStorage.removeItem(e)),r.sessionStorage.removeItem(r.initializedFlag)}}static getKeyName(e){return`${r.tokenStoragePrefix}${e}`}static get canStore(){return r.sessionStorage&&r.window}}r.initializedFlag="twilio_twilsock_token_storage",r.tokenStoragePrefix="twilio_continuation_token_",t.TokenStorage=r,r.initialize()},v9mA:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n("8lcS");t.Notifications=r.Client},vOBy:function(e,t,n){"use strict";const r=n("lkbt");e.exports=r},vZMe:function(e,t,n){"use strict";var r,i=(r=n("aq5/"))&&r.__esModule?r:{default:r};Object.defineProperty(t,"__esModule",{value:!0}),t.PushNotification=function e(t){(0,i.default)(this,e),this.title=t.title||null,this.body=t.body||null,this.sound=t.sound||null,this.badge=t.badge||null,this.action=t.action||null,this.type=t.type||null,this.data=t.data||{}}},vbc5:function(e,t){e.exports=function(e){return"object"==typeof e?null!==e:"function"==typeof e}},"vsn+":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n("BHqR");t.ContinuationTokenStatus=class{},t.InitReply=class extends r.AbstractMessage{constructor(e,t,n,r,i,s){super(e),this.continuationToken=t,this.continuationTokenStatus=n,this.offlineStorage=r,this.initRegistrations=i,this.debugInfo=s}}},wGyb:function(e,t,n){var r=n("vbc5"),i=n("gNE/"),s=n("eD9m")("species");e.exports=function(e){var t;return i(e)&&("function"!=typeof(t=e.constructor)||t!==Array&&!i(t.prototype)||(t=void 0),r(t)&&null===(t=t[s])&&(t=void 0)),void 0===t?Array:t}},wHU4:function(e,t,n){var r=n("hR4s").document;e.exports=r&&r.documentElement},wOJj:function(e,t){e.exports=function(){}},wiho:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class r{constructor(e){this.queuedRequests=[],this.isRequestInFlight=!1,this.inputMergingFunction=e}add(e,t){let n=new Promise((n,r)=>this.queuedRequests.push({input:e,requestFunction:t,resolve:n,reject:r}));return this.wakeupQueue(),n}squashAndAdd(e,t){let n,r=this.queuedRequests;this.queuedRequests=[],r.length>0?(n=r.map(e=>e.input).reduce(this.inputMergingFunction),n=this.inputMergingFunction(n,e)):n=e;let i=this.add(n,t);return r.forEach(e=>i.then(e.resolve,e.reject)),i}isEmpty(){return 0===this.queuedRequests.length&&!this.isRequestInFlight}wakeupQueue(){if(0!==this.queuedRequests.length&&!this.isRequestInFlight){let e=this.queuedRequests.shift();this.isRequestInFlight=!0,e.requestFunction(e.input).then(e.resolve,e.reject).then(e=>{this.isRequestInFlight=!1,this.wakeupQueue()})}}}t.MergingQueue=r,t.NamespacedMergingQueue=class{constructor(e){this.queueByNamespaceKey=new Map,this.inputReducer=e}async add(e,t,n){return this.invokeQueueMethod(e,e=>e.add(t,n))}async squashAndAdd(e,t,n){return this.invokeQueueMethod(e,e=>e.squashAndAdd(t,n))}async invokeQueueMethod(e,t){this.queueByNamespaceKey.has(e)||this.queueByNamespaceKey.set(e,new r(this.inputReducer));const n=t(this.queueByNamespaceKey.get(e));return this.queueByNamespaceKey.get(e).isEmpty()&&this.queueByNamespaceKey.delete(e),n}}},wlIO:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EntitiesCache=class{constructor(){this.names=new Map,this.entities=new Map}store(e){return this.entities.get(e.sid)||(this.entities.set(e.sid,e),e.uniqueName&&this.names.set(e.type+"::"+e.uniqueName,e.sid),e)}getResolved(e,t){let n=this.names.get(t+"::"+e);return n?this.entities.get(n):null}get(e,t){return this.entities.get(e)||this.getResolved(e,t)||null}remove(e){let t=this.entities.get(e);t&&(this.entities.delete(e),t.uniqueName&&this.names.delete(t.type+"::"+t.uniqueName))}}},xLJM:function(e,t,n){n("Fk9O"),n("/r3m"),e.exports=n("Bkdt")},y51I:function(e,t,n){"use strict";var r=n("/hF+");e.exports=r},y7sZ:function(e,t){e.exports=function(e){try{return{e:!1,v:e()}}catch(t){return{e:!0,v:t}}}},yDbV:function(e,t,n){"use strict";var r,i=(r=n("aq5/"))&&r.__esModule?r:{default:r};Object.defineProperty(t,"__esModule",{value:!0});var s=function e(){(0,i.default)(this,e)};t.NotificationTypes=s,s.TYPING_INDICATOR="twilio.ipmsg.typing_indicator",s.NEW_MESSAGE="twilio.channel.new_message",s.ADDED_TO_CHANNEL="twilio.channel.added_to_channel",s.INVITED_TO_CHANNEL="twilio.channel.invited_to_channel",s.REMOVED_FROM_CHANNEL="twilio.channel.removed_from_channel",s.CONSUMPTION_UPDATE="twilio.channel.consumption_update"},yURk:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class r{constructor(e,t){this.services=e,this.removalHandler=t,this.subscriptionState="none",this._attachedListeners=new Map}_advanceLastEventId(e,t){}reportFailure(e){404===e.status?this.onRemoved(!1):this.broadcastEventToListeners("failure",e)}_subscribe(){this.services.router.subscribe(this.sid,this)}_unsubscribe(){this.services.router.unsubscribe(this.sid)}_setSubscriptionState(e){this.subscriptionState=e,this.broadcastEventToListeners("_subscriptionStateChanged",e)}close(){this._unsubscribe(),null!=this.removalHandler&&this.removalHandler(this.type,this.sid,this.uniqueName)}attach(e){const t=e.listenerUuid;this._attachedListeners.get(t)||(this._attachedListeners.size||this._subscribe(),this._attachedListeners.set(t,e))}detach(e){this._attachedListeners.delete(e),this._attachedListeners.size||this.close()}broadcastEventToListeners(e,t){for(let n of this._attachedListeners.values())n.emit(e,t)}}t.SyncEntity=r,t.default=r},yWtm:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n("r2q8"),i=n("qXWz");t.BackoffRetrier=class extends r.EventEmitter{get inProgress(){return!!this.retrier}constructor(e){super(),this.options=e?Object.assign({},e):{}}start(){if(this.inProgress)throw new Error("Already waiting for next attempt, call finishAttempt(success : boolean) to finish it");this.createRetrier()}stop(){this.cleanRetrier(),this.newBackoff=null,this.usedBackoff=null}modifyBackoff(e){this.newBackoff=e}attemptFailed(){if(!this.inProgress)throw new Error("No attempt is in progress");this.newBackoff&&(!this.usedBackoff||this.usedBackoff<this.newBackoff)?this.createRetrier():this.retrier.failed(new Error)}cancel(){this.retrier&&this.retrier.cancel()}cleanRetrier(){this.retrier&&(this.retrier.removeAllListeners(),this.retrier.cancel(),this.retrier=null)}getRetryPolicy(){const e=Object.assign({},this.options);return this.newBackoff&&(e.min=this.newBackoff,e.max=this.options.max&&this.options.max>this.newBackoff?this.options.max:this.newBackoff),e.maxAttemptsCount=this.options.maxAttemptsCount?this.options.maxAttemptsCount+1:void 0,e}createRetrier(){this.cleanRetrier();const e=this.getRetryPolicy();this.retrier=new i.Retrier(e),this.retrier.once("attempt",()=>{this.retrier.on("attempt",()=>this.emit("attempt")),this.retrier.failed(new Error("Skipping first attempt"))}),this.retrier.on("failed",e=>this.emit("failed",e)),this.usedBackoff=this.newBackoff,this.newBackoff=null,this.retrier.start().catch(e=>{})}}},yew7:function(e,t,n){var r=n("8fQz"),i=n("3555"),s=n("guEv"),a=n("ubhL")("IE_PROTO"),o=function(){},u=function(){var e,t=n("1bLK")("iframe"),r=s.length;for(t.style.display="none",n("wHU4").appendChild(t),t.src="javascript:",(e=t.contentWindow.document).open(),e.write("<script>document.F=Object<\/script>"),e.close(),u=e.F;r--;)delete u.prototype[s[r]];return u()};e.exports=Object.create||function(e,t){var n;return null!==e?(o.prototype=r(e),n=new o,o.prototype=null,n[a]=e):n=u(),void 0===t?n:i(n,t)}},ypPR:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n("lPsM"),i=n("EtEV");t.TwilsockConnector=class extends i.Connector{constructor(e,t,n){super(n),this.twilsock=t,this.context=e,e.id=r.v4(),this.twilsock.on("stateChanged",e=>{"connected"!==e&&this.emit("transportReady",!1)}),this.twilsock.on("registered",n=>{e&&n===e.id&&"connected"===t.state&&this.emit("transportReady",!0)})}setNotificationId(...e){}updateToken(e){}async updateContextRequest(e){let t={product_id:this.context.productId,notification_protocol_version:4,endpoint_platform:this.context.platform,message_types:e};this.emit("transportReady",!1),await this.twilsock.setNotificationsContext(this.context.id,t)}async updateRegistration(e,t){if(t.has("messageType"))return await this.updateContextRequest(Array.from(e.messageTypes)),e}removeRegistration(){return this.twilsock.removeNotificationsContext(this.context.id)}}},z7HR:function(e,t,n){var r=n("J0XI"),i=n("guEv").concat("length","prototype");t.f=Object.getOwnPropertyNames||function(e){return r(e,i)}},zCrM:function(e,t,n){"use strict";var r=n("UwCj").f,i=n("yew7"),s=n("qa3O"),a=n("dWRk"),o=n("s0lH"),u=n("9v8s"),c=n("S49y"),l=n("MIMp"),d=n("Jn7W"),h=n("ObEa"),f=n("aRFn").fastKey,p=n("S5Zg"),m=h?"_s":"size",y=function(e,t){var n,r=f(t);if("F"!==r)return e._i[r];for(n=e._f;n;n=n.n)if(n.k==t)return n};e.exports={getConstructor:function(e,t,n,c){var l=e((function(e,r){o(e,l,t,"_i"),e._t=t,e._i=i(null),e._f=void 0,e._l=void 0,e[m]=0,null!=r&&u(r,n,e[c],e)}));return s(l.prototype,{clear:function(){for(var e=p(this,t),n=e._i,r=e._f;r;r=r.n)r.r=!0,r.p&&(r.p=r.p.n=void 0),delete n[r.i];e._f=e._l=void 0,e[m]=0},delete:function(e){var n=p(this,t),r=y(n,e);if(r){var i=r.n,s=r.p;delete n._i[r.i],r.r=!0,s&&(s.n=i),i&&(i.p=s),n._f==r&&(n._f=i),n._l==r&&(n._l=s),n[m]--}return!!r},forEach:function(e){p(this,t);for(var n,r=a(e,arguments.length>1?arguments[1]:void 0,3);n=n?n.n:this._f;)for(r(n.v,n.k,this);n&&n.r;)n=n.p},has:function(e){return!!y(p(this,t),e)}}),h&&r(l.prototype,"size",{get:function(){return p(this,t)[m]}}),l},def:function(e,t,n){var r,i,s=y(e,t);return s?s.v=n:(e._l=s={i:i=f(t,!0),k:t,v:n,p:r=e._l,n:void 0,r:!1},e._f||(e._f=s),r&&(r.n=s),e[m]++,"F"!==i&&(e._i[i]=s)),e},getEntry:y,setStrong:function(e,t,n){c(e,t,(function(e,n){this._t=p(e,t),this._k=n,this._l=void 0}),(function(){for(var e=this._k,t=this._l;t&&t.r;)t=t.p;return this._t&&(this._l=t=t?t.n:this._t._f)?l(0,"keys"==e?t.k:"values"==e?t.v:[t.k,t.v]):(this._t=void 0,l(1))}),n?"entries":"values",!n,!0),d(t)}}},zJWi:function(e,t,n){var r=n("MrWc"),i=n("ax0Y");n("2qJG")("getPrototypeOf",(function(){return function(e){return i(r(e))}}))},zZTv:function(e,t,n){n("9YHp")("observable")},zaPo:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Configuration=class{constructor(e,t,n){let r=n.MCS||n||{};this.region=r.region||n.region,this.baseUrl=(void 0===this.region?"https://mcs.us1.twilio.com":`https://mcs.${this.region}.twilio.com`)+t,this.token=e,this.retryWhenThrottledOverride=r.retryWhenThrottledOverride,this.backoffConfigOverride=r.backoffConfigOverride}static get backoffConfigDefault(){return{min:1e3,max:4e3,maxAttemptsCount:3}}static get retryWhenThrottledDefault(){return!0}updateToken(e){this.token=e}}},zjfI:function(e,t,n){"use strict";var r=n("yew7"),i=n("jHgz"),s=n("KnMe"),a={};n("b95h")(a,n("eD9m")("iterator"),(function(){return this})),e.exports=function(e,t,n){e.prototype=r(a,{next:i(1,n)}),s(e,t+" Iterator")}},zjhQ:function(e,t,n){"use strict";var r=n("IFjL"),i=n("Vzpu"),s=n("dWRk"),a=n("9v8s");e.exports=function(e){r(r.S,e,{from:function(e){var t,n,r,o,u=arguments[1];return i(this),(t=void 0!==u)&&i(u),null==e?new this:(n=[],t?(r=0,o=s(u,arguments[2],2),a(e,!1,(function(e){n.push(o(e,r++))}))):a(e,!1,n.push,n),new this(n))}})}}}]);